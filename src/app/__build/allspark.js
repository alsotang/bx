function timestamps(a){typeof a=="string"&&(a=parseInt(a));var b=1e3,c=b*60,d=c*60,e=d*24,f=null,g=new Date,h=g.getTime(),i="";typeof a=="number"?f=a:typeof a=="object"&&a.getTime&&(f=a.getTime());if(f!=NaN){var j=new Date;j.setTime(f)}var k=j.getMinutes();return k<10&&(k="0"+k),f==NaN?i="-":f>h?i="刚刚":f>h-b*10?i="刚刚":f>h-c?i=parseInt((h-f)/b/10).toString()+"0秒前":f>h-d?i=parseInt((h-f)/c)+"分钟前":j.getDate()==g.getDate()?i="今天"+j.getHours()+":"+k:g.getDate()-j.getDate()==1?i="昨天"+j.getHours()+":"+k:j.getYear()==g.getYear()?i=j.getMonth()+1+"月"+j.getDate()+"日 "+j.getHours()+":"+k:i=j.getFullYear()+"年"+(j.getMonth()+1)+"月"+j.getDate()+"日 "+j.getHours()+":"+k,i}function numToBinary(a){var b="",c=a,d;do d=c%2,b=d+b,c=Math.floor(c/2);while(c!=0);return b}function noHelper(a){var b=numToBinary(a),c=!1;return b="0000"+b,b.substring(b.length-4,b.length-3)!="1"}function feedImageSizeStyle(a,b){var c=parseInt(a),d=parseInt(b),e=window.innerWidth-30,f=0;return c<d?c<e?(f=e/c*d,f>e&&(f=e)):f=e:c<e?f=e/c*d:f=d/(c/e),f?"width: "+e+"px; "+"height: "+f+"px;":"width: 100%"}function detailImageSizeStyle(a,b){var c=parseInt(a),d=parseInt(b),e=window.innerWidth-30,f=0;return c<e?f=e/c*d:f=d/(c/e),f?"width: "+e+"px; "+"height: "+f+"px;":"width: 100%"}seajs.config({alias:{backbone:"http://a.tbcdn.cn/mw/base/libs/backbone/0.9.2/backbone",underscore:"http://a.tbcdn.cn/mw/base/libs/underscore/1.3.3/underscore",zepto:"http://a.tbcdn.cn/mw/base/libs/zepto/1.0.0/zepto",mustache:"http://a.tbcdn.cn/mw/base/libs/mustache/0.5.0/mustache",linkfocus:"../../../../base/modules/linkfocus/linkfocus",uriBroker:"../../../../base/utils/server/uriBroker",h5_mtop:"../../../../base/utils/server/mtop_h5api",h5_events:"../../../../base/utils/server/h5_events",h5_comm:"../../../../base/utils/server/h5_common",h5_base:"../../../../base/utils/server/h5_base",h5_utils:"../../../../base/utils/server/h5_utils",h5_cache:"../../../../base/utils/server/h5_cache",h5_token:"../../../../base/utils/server/h5_token",cookie:"../../../../base/utils/server/cookie",cdn:"../../../../base/utils/server/cdn",aplus:"../../../../base/modules/aplus/aplus"},debug:1}),define("/mw/webapp/transformer/js/allspark.js",["./router"],function(a,b){a("./router").start()});
define("/mw/webapp/transformer/js/router.js",["zepto","underscore","../common/global","h5_base","backbone","../dynIndex/dynIndexView","../account/accountView","../detail/detailView","../accountList/accountListView","../comment/commentListView","../comment/newCommentView","./../common/background.js","cdn","../common/mtopForAllspark.js"],function(a,b,c){var d=a("zepto"),e=a("underscore"),f=a("../common/global"),g=a("h5_base"),h=a("backbone"),i=a("../dynIndex/dynIndexView"),j=a("../account/accountView"),k=a("../detail/detailView"),l=a("../accountList/accountListView"),m=a("../comment/commentListView"),n=a("../comment/newCommentView"),o=a("./../common/background.js"),p=a("cdn"),q=a("../common/mtopForAllspark.js"),r,s,t,u,v,w,x=h.Router.extend({routes:{},initialize:function(){getBetterImg=p.getBetterImg,resizeImg=p.resizeImg,window.MH5slogan&&window.MH5slogan.hideFunc&&window.MH5slogan.hideFunc(),q.autoCreate();var a=this;a.route("","index",a.filter),a.route(/^(index)\/?(\d*)?$/,"index",a.filter),a.route(/^(account)\/(\d*)\/?(\d*)?$/,"account",a.filter),a.route(/^(detail)\/(\d*)\/(\d*)\/?(\d*)?$/,"detail",a.filter),a.route(/^(comment)\/(\d*)\/(\d*)\/?(\d*)?$/,"commentList",a.filter),a.route(/^(accountList)\/?(\d*)?\/?(\d*)?$/,"accountList",a.filter),a.route(/^(newComment)\/(\d*)\/(\d*)\/?(\d*)?$/,"newComment",a.filter),f.init()},filter:function(a,b,c,d){var e=this;if(g.userCacheHash("allSpark"))return;a=a||"index",o.enter(a);switch(a){case"index":r=r||new i,e.index(b);break;case"account":s=s||new j,e.account(b,c);break;case"detail":t=t||new k,e.detail(b,c,d);break;case"comment":v=v||new m,e.commentList(b,c,d);break;case"accountList":u=u||new l,e.accountList(b,c);break;case"newComment":w=w||new n,e.newComment(b,c,d);break;default:r=r||new i,e.index(b)}},index:function(a){a=a||1,r.render(a)},account:function(a,b){b=b||1,s.render(a,b);var c="onorientationchange"in window,e=c?"orientationchange":"resize";d(window).bind(e,function(){var a=d("#accountPage .J_feed .tb-feed-items .media img");for(var b=0,c=a.length;b<c;b++)a.eq(b).attr("style",feedImageSizeStyle(parseInt(a.eq(b).attr("picWidth")),parseInt(a.eq(b).attr("picHeight"))))})},accountList:function(a,b){a=a||1,b=b||1,u.render(a,b)},detail:function(a,b,c){c=c||1,window.scrollTo(0,0),t.goDetail(a,b,c)},commentList:function(a,b,c){c=c||v.page||1,v.goComment(a,b,c)},newComment:function(a,b,c){c=c||1,w.goNewComment(a,b,c)},start:function(){h.history.start()}});return App=window.App||new x,App});
define("/mw/webapp/transformer/common/global.js",["zepto","h5_utils","h5_base","cookie"],function(a){var b=a("zepto"),c=a("h5_utils"),d=a("h5_base"),e=a("cookie");return c.wrapColsure({init:function(){d.isClient()?(b("header.navbar").hide(),b("body").addClass("webview")):(b("header.navbar").show(),b("body").removeClass("webview"));if(!e.isCookieEnable()){alert("您的浏览器不支持cookie，请开启cookie!");return}this.hashCheck()},hashCheck:function(){var a=location.hash;a&&a!="#index"&&a.indexOf("#account")==-1&&a.indexOf("#detail")==-1&&a.indexOf("#comment")==-1&&a.indexOf("#newComment")==-1&&a.indexOf("#accountList")==-1&&(location.hash="#index")}})});
define("/base/utils/server/h5_utils.js",["underscore","zepto"],function(a,b,c){var d=a("underscore"),e=a("zepto");b.isBlank=function(a){return a==null||typeof a=="undefined"||e.trim(a)==""?!0:!1},b.wrapColsure=function(a){return e.each(a,function(b){typeof a[b]=="function"&&(a[b]=d.bind(a[b],a))}),a},b.MD5=function(a){function b(a,b){return a<<b|a>>>32-b}function c(a,b){var c,d,e,f,g;return e=a&2147483648,f=b&2147483648,c=a&1073741824,d=b&1073741824,g=(a&1073741823)+(b&1073741823),c&d?g^2147483648^e^f:c|d?g&1073741824?g^3221225472^e^f:g^1073741824^e^f:g^e^f}function d(a,b,c){return a&b|~a&c}function e(a,b,c){return a&c|b&~c}function f(a,b,c){return a^b^c}function g(a,b,c){return b^(a|~c)}function h(a,e,f,g,h,i,j){return a=c(a,c(c(d(e,f,g),h),j)),c(b(a,i),e)}function i(a,d,f,g,h,i,j){return a=c(a,c(c(e(d,f,g),h),j)),c(b(a,i),d)}function j(a,d,e,g,h,i,j){return a=c(a,c(c(f(d,e,g),h),j)),c(b(a,i),d)}function k(a,d,e,f,h,i,j){return a=c(a,c(c(g(d,e,f),h),j)),c(b(a,i),d)}function l(a){var b,c=a.length,d=c+8,e=(d-d%64)/64,f=(e+1)*16,g=Array(f-1),h=0,i=0;while(i<c)b=(i-i%4)/4,h=i%4*8,g[b]=g[b]|a.charCodeAt(i)<<h,i++;return b=(i-i%4)/4,h=i%4*8,g[b]=g[b]|128<<h,g[f-2]=c<<3,g[f-1]=c>>>29,g}function m(a){var b="",c="",d,e;for(e=0;e<=3;e++)d=a>>>e*8&255,c="0"+d.toString(16),b+=c.substr(c.length-2,2);return b}function n(a){a=a.replace(/\r\n/g,"\n");var b="";for(var c=0;c<a.length;c++){var d=a.charCodeAt(c);d<128?b+=String.fromCharCode(d):d>127&&d<2048?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(d&63|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(d&63|128))}return b}var o=Array(),p,q,r,s,t,u,v,w,x,y=7,z=12,A=17,B=22,C=5,D=9,E=14,F=20,G=4,H=11,I=16,J=23,K=6,L=10,M=15,N=21;a=n(a),o=l(a),u=1732584193,v=4023233417,w=2562383102,x=271733878;for(p=0;p<o.length;p+=16)q=u,r=v,s=w,t=x,u=h(u,v,w,x,o[p+0],y,3614090360),x=h(x,u,v,w,o[p+1],z,3905402710),w=h(w,x,u,v,o[p+2],A,606105819),v=h(v,w,x,u,o[p+3],B,3250441966),u=h(u,v,w,x,o[p+4],y,4118548399),x=h(x,u,v,w,o[p+5],z,1200080426),w=h(w,x,u,v,o[p+6],A,2821735955),v=h(v,w,x,u,o[p+7],B,4249261313),u=h(u,v,w,x,o[p+8],y,1770035416),x=h(x,u,v,w,o[p+9],z,2336552879),w=h(w,x,u,v,o[p+10],A,4294925233),v=h(v,w,x,u,o[p+11],B,2304563134),u=h(u,v,w,x,o[p+12],y,1804603682),x=h(x,u,v,w,o[p+13],z,4254626195),w=h(w,x,u,v,o[p+14],A,2792965006),v=h(v,w,x,u,o[p+15],B,1236535329),u=i(u,v,w,x,o[p+1],C,4129170786),x=i(x,u,v,w,o[p+6],D,3225465664),w=i(w,x,u,v,o[p+11],E,643717713),v=i(v,w,x,u,o[p+0],F,3921069994),u=i(u,v,w,x,o[p+5],C,3593408605),x=i(x,u,v,w,o[p+10],D,38016083),w=i(w,x,u,v,o[p+15],E,3634488961),v=i(v,w,x,u,o[p+4],F,3889429448),u=i(u,v,w,x,o[p+9],C,568446438),x=i(x,u,v,w,o[p+14],D,3275163606),w=i(w,x,u,v,o[p+3],E,4107603335),v=i(v,w,x,u,o[p+8],F,1163531501),u=i(u,v,w,x,o[p+13],C,2850285829),x=i(x,u,v,w,o[p+2],D,4243563512),w=i(w,x,u,v,o[p+7],E,1735328473),v=i(v,w,x,u,o[p+12],F,2368359562),u=j(u,v,w,x,o[p+5],G,4294588738),x=j(x,u,v,w,o[p+8],H,2272392833),w=j(w,x,u,v,o[p+11],I,1839030562),v=j(v,w,x,u,o[p+14],J,4259657740),u=j(u,v,w,x,o[p+1],G,2763975236),x=j(x,u,v,w,o[p+4],H,1272893353),w=j(w,x,u,v,o[p+7],I,4139469664),v=j(v,w,x,u,o[p+10],J,3200236656),u=j(u,v,w,x,o[p+13],G,681279174),x=j(x,u,v,w,o[p+0],H,3936430074),w=j(w,x,u,v,o[p+3],I,3572445317),v=j(v,w,x,u,o[p+6],J,76029189),u=j(u,v,w,x,o[p+9],G,3654602809),x=j(x,u,v,w,o[p+12],H,3873151461),w=j(w,x,u,v,o[p+15],I,530742520),v=j(v,w,x,u,o[p+2],J,3299628645),u=k(u,v,w,x,o[p+0],K,4096336452),x=k(x,u,v,w,o[p+7],L,1126891415),w=k(w,x,u,v,o[p+14],M,2878612391),v=k(v,w,x,u,o[p+5],N,4237533241),u=k(u,v,w,x,o[p+12],K,1700485571),x=k(x,u,v,w,o[p+3],L,2399980690),w=k(w,x,u,v,o[p+10],M,4293915773),v=k(v,w,x,u,o[p+1],N,2240044497),u=k(u,v,w,x,o[p+8],K,1873313359),x=k(x,u,v,w,o[p+15],L,4264355552),w=k(w,x,u,v,o[p+6],M,2734768916),v=k(v,w,x,u,o[p+13],N,1309151649),u=k(u,v,w,x,o[p+4],K,4149444226),x=k(x,u,v,w,o[p+11],L,3174756917),w=k(w,x,u,v,o[p+2],M,718787259),v=k(v,w,x,u,o[p+9],N,3951481745),u=c(u,q),v=c(v,r),w=c(w,s),x=c(x,t);var O=m(u)+m(v)+m(w)+m(x);return O.toLowerCase()}});
define("/base/utils/server/h5_base.js",[],function(a,b,c){function d(a){var b=Array.prototype.slice.call(arguments,1);for(var c=0,d=b.length;c<d;c++)for(var e in b[c])a[e]=b[c][e];return a}b.paramKey="h5_paramKey",b.targetUrl="h5_targetUrl",b.userInfoKey="h5_userInfoKey",b.hrefHash="_hash",b.lastHash="_lastHash",b.appKey="h5_app_key",b.appToken="h5_app_token",b.appRefreshToken="h5_app_ref_token",b.appTokenExpired="h5_app_token_expired",b.appTokenBetween="h5_app_token_between",b.appTokenSaveTime="h5_app_token_save_time",b.appRequestFailed="h5_app_request_failed_tag",b.set=function(a,b){if(this.isSuppLocalStorage()){typeof b!="string"&&(b=JSON.stringify(b));try{return window.localStorage.setItem(a,b),!0}catch(c){}}return!1},b.add=function(a,b){if(this.isSuppLocalStorage()){if(typeof b=="string")b=JSON.parse(b);else{try{d(b,JSON.parse(getValue(a)))}catch(c){}b=JSON.stringify(b)}return window.localStorage.setItem(a,b),!0}return!1},b.get=getValue=function(a){return this.isSuppLocalStorage()?window.localStorage.getItem(a):null},b.removeValue=function(a){if(this.isSuppLocalStorage())return window.localStorage.removeItem(a)},b.clearAll=function(){if(this.isSuppLocalStorage())return window.localStorage.clear()},b.userCacheHash=function(a){var b=a||"h5",c=b+this.lastHash,d=b+this.hrefHash;return!location.hash&&this.get(d)?(location.hash=this.get(d),!0):(location.hash&&(this.get(d)!=location.hash&&this.set(c,this.get(d)||""),this.set(d,location.hash)),!1)},b.getLastHash=function(a,b){return this.get((a||"h5")+this.lastHash)||b||""},b.getParamFromStorage=function(a){try{return JSON.parse(this.get(this.paramKey))[a]}catch(b){}return null},b.getUserProFromStorage=function(a){try{return JSON.parse(this.get(this.userInfoKey))[a]}catch(b){}return null},b.getBetweenTime=function(a){if(a){var b=(new Date).getTime()-a;return this.set(this.appTokenBetween,b),b}return parseInt(this.get(this.appTokenBetween)||0)},b.checkIsBlank=function(a){return null==a||""==a},b.isLogin=function(){var a=this.getUserProFromStorage("nick");return a==""||a==null?!1:!0},b.removeToken=function(){try{this.removeValue(this.appToken),this.removeValue(this.appRefreshToken),this.removeValue(this.appTokenExpired),this.removeValue(this.appTokenBetween),this.removeValue(this.appTokenSaveTime)}catch(a){}},b.getQueryString=function(a){var b=location.search;if(b.length<1)return"";b=b.substr(1);var c=b.split("&"),d={};for(i in c){var e=c[i].split("=");d[decodeURIComponent(e[0])]=decodeURIComponent(e[1])}return a?d[a]:d},b.isClient=function(){var a=this.getQueryString("ttid");return a&&a.indexOf("@")>-1},b.isAndroidClient=function(){var a=this.getQueryString("ttid");return a&&a.toLowerCase().indexOf("android")>-1},b.isSuppLocalStorage=function(){try{if(window.localStorage=="undefined")return!1;var a="testSupportKey";window.localStorage.setItem(a,"1");var b=window.localStorage.getItem(a);return window.localStorage.removeItem(a),"1"==b}catch(c){}return!1}});
define("/base/utils/server/cookie.js",[],function(a,b,c){b.isCookieEnable=function(){if(!window.navigator.cookieEnabled)return!1;var a="_s_cookie_";this.setCookie(a,"1");var b=this.getCookie(a);return b=="1"?(this.delCookie(a),!0):!1},b.getCookieVal=function(a){var b=document.cookie.indexOf(";",a);return b==-1&&(b=document.cookie.length),unescape(document.cookie.substring(a,b))},b.getCookie=function(a){var b=a+"=",c=b.length,d=document.cookie.length,e=0;while(e<d){var f=e+c;if(document.cookie.substring(e,f)==b)return this.getCookieVal(f);e=document.cookie.indexOf(" ",e)+1;if(e==0)break}return null},b.setCookie=function(a,b){var c=window.location.host,d=c.indexOf("."),e=c.substring(0,d);e!="waptest"&&e!="wapa"&&e!="m"&&(c.indexOf("taobao")>-1||c.indexOf("tmall")>-1)&&(c=c.substr(d+1));var f=arguments.length>2?arguments[2]:null;if(f==null)document.cookie=a+"="+escape(b)+";path=/;domain="+c;else{var g=new Date;g.setTime(g.getTime()+f*1e3),document.cookie=a+"="+escape(b)+";path=/;domain="+c+";expires="+g.toGMTString()}},b.delCookie=function(a){var b=new Date;b.setTime(b.getTime()-1);var c=this.getCookie(a);document.cookie=a+"="+c+"; expires="+b.toGMTString()}});
define("/mw/webapp/transformer/dynIndex/dynIndexView.js",["backbone","zepto","underscore","./dynIndexModel","h5_base","h5_comm","../common/global","cookie","../common/cache","../../../../base/styles/component/slider/js/slider.js","../../../../base/styles/component/pagenav/js/pagenav.js","../ui/notification.js","../ui/loading","../common/mtopForAllspark.js"],function(a,b,c){var d=a("backbone"),e=a("zepto"),f=a("underscore"),g=a("./dynIndexModel"),h=a("h5_base"),i=a("h5_comm"),j=a("../common/global"),k=a("cookie"),l=a("../common/cache"),m=a("../../../../base/styles/component/slider/js/slider.js"),n=a("../../../../base/styles/component/pagenav/js/pagenav.js"),o=a("../ui/notification.js"),p=a("../ui/loading"),q=a("../common/mtopForAllspark.js");e.extend(e.fn,{wAE:function(a,b){var c=this,d=!0,e=function(c){if(b&&c.propertyName!=b)return;typeof a=="function"&&d&&(a(),d=!1)};c.unbind("webkitAnimationEnd").bind("webkitAnimationEnd",e),c.unbind("webkitTransitionEnd").bind("webkitTransitionEnd",e)}});var r=d.View.extend({el:"#content",events:{"click #J_login_btn":"goLogin","click .navbar .add":"add","click .navbar .refresh.index":"refresh","click #indexPage .myfeed li":"goToAccount","click #indexPage .person-list li .content":"goToAccount","click #indexPage .person-list .followbtn":"follow","click .gotop":"goTop"},initialize:function(a){var b=this;b._pageSize=15,b.loginFlag=!1,b.timestamp=(new Date).getTime(),b.dynIndexModel=new g,b.dynIndexModel.on("change:newFeedCounts",function(a,b){b.count>0&&o.message("更新了 "+b.count+" 条广播")}),b.dynIndexModel.on("change:banner",function(a,b){var c=b;c.width=b.list.length*320,e("#indexPage .J_slider").html(f.template(e("#slider_tpl").html(),c)),new m(".in-slider",{wrap:".in-slider-cont",trigger:".in-slider-status",useTransform:!0,interval:5e3,play:!0,loop:!0})}),b.dynIndexModel.on("change:accWithFeed",function(a,c){setTimeout(function(){e(".navbar .refresh .btn div").removeClass("spinner")},2e3);if(c&&c.fail){i.isLogin()?e(".indexPage .J_status").html(""):e(".J_list .person-list").html(""),o.message("服务异常，请稍后再试！");return}if(c.list&&c.list.length>0)if(c.list.length==1&&b.curPage==1)e("#indexPage .J_status").html(f.template(e("#myfeed_tpl").html()+e("#recommendtip_tpl").html(),c));else{e("#indexPage .J_list").css("height","auto"),e("#indexPage .J_list .person-list").html(""),e("#personListPageNav").html(""),e("#indexPage .J_status").html('<div class="account-title"><span>账号动态</span></div>'+f.template(e("#myfeed_tpl").html(),c));var d=Math.ceil(c.totalCount/b._pageSize);d>1?(e(".J_list").css("min-height","100px"),b.myfeedPage=new n({id:"#personListPageNav",index:b.curPage,pageCount:d,pageSize:b._pageSize,disableHash:"true"}),b.myfeedPage.pContainer().on("P:switchPage",function(a,c){b.changePage(c.index)})):e(".J_list").css("min-height","50px")}else e("#indexPage .J_status").html("")},this),b.dynIndexModel.on("change:recommends",function(a,c){setTimeout(function(){e(".navbar .refresh div").removeClass("spinner")},2e3);if(c&&c.fail){i.isLogin()?e(".indexPage .J_status").html(""):e(".J_list .person-list").html(""),o.message("服务异常，请稍后再试！");return}if(c.list&&c.list.length>0){var d=Math.ceil(c.totalCount/b._pageSize);d>1?e("#indexPage .J_list").css("height",71*parseInt(c.list.length)+100+"px"):e("#indexPage .J_list").css("height",71*parseInt(c.list.length)+70+"px"),e("#indexPage .J_list .person-list").html(f.template(e("#personList_tpl").html(),c)),d>1&&(b.recommentPage=new n({id:"#personListPageNav",index:b.curPage,pageCount:d,pageSize:b._pageSize,disableHash:"true"}),b.recommentPage.pContainer().on("P:switchPage",function(a,c){b.changePage(c.index)}))}},this),b.dynIndexModel.on("change:loaded",function(a,b){p.hide(),a.set("loaded","0")})},goTop:function(){window.scrollTo(0,1)},render:function(a){var b=this;b.curPage=parseInt(a),i.isLogin()?e(".indexPage .J_status").html('<div class="loading"><span class="spinner"></span></div>'):e(".J_list .person-list").html('<div class="loading"><span class="spinner"></span></div>'),e("#personListPageNav").html("");var c={curPage:b.curPage,pageSize:b._pageSize};i.isLogin()&&b.dynIndexModel.get("recommends")&&(c.type=2);var d=e("header.navbar");d.html(f.template(e("#navBack_tpl").html(),{backUrl:"http://m.taobao.com",backTitle:"首页"})+e("#homeTitle_tpl").html()),d.hasClass("iT")&&d.removeClass("iT").addClass("iC"),i.isLogin()?(e("footer .nick").html(q.userNick),e("footer").css("display","block")):e("#indexPage .J_status").html(e("#loginBar_tpl").html());if(!e("#indexPage").hasClass("show")){var g=e(".view-page.show"),h=e("#indexPage");g.length>0?(h.hasClass("iB")&&h.removeClass("iB").addClass("iL"),g.removeClass("show iC").addClass("iR").wAE(function(){g.addClass("hide")}),h.removeClass("hide iL").addClass("show iC")):(h.removeClass("hide"),setTimeout(function(){h.removeClass("iB").addClass("show iC")},0))}i.isLogin()||e("#indexPage .J_status").html(e("#loginBar_tpl").html()),window.scrollTo(0,1),b.dynIndexModel.getPageData(c)},PageNavRender:function(){},changePage:function(a){var b=this;i.isLogin()?e(".indexPage .J_status").html('<div class="loading"><span class="spinner"></span></div>'):e(".J_list .person-list").html('<div class="loading"><span class="spinner"></span></div>'),window.location.hash="#index/"+a},add:function(){var a=this;i.isLogin()?window.location.hash="#accountList/1":a.goLogin()},refresh:function(){var a=this;a.timestamp=(new Date).getTime();var b=e(".navbar .refresh .btn div");b.hasClass("spinner")||b.addClass("spinner"),a.curPage=="1"?a.dynIndexModel.getPageData({curPage:a.curPage,pageSize:a._pageSize,timestamp:a.timestamp}):window.location.hash="#index/1"},follow:function(a){a.stopPropagation();var b=this,c=e(a.currentTarget);i.isLogin()?c.hasClass("followed")||(c.html("关注中..."),c.addClass("min"),q.addAccount(c.attr("pid"),function(a){if(a.data.result)for(var b=a.data.result.length,d=0;d<b;d++)c.attr("pid")==a.data.result[d].id&&(a.data.result[d].isSuccess=="true"?(c.addClass("followed"),c.removeClass("min"),c.html("已关注")):(o.message("关注失败！"),c.html("关注"),c.removeClass("min")))},function(){o.message("关注失败！"),c.html("关注"),c.removeClass("min")})):b.goLogin()},goLogin:function(){h.removeValue("allSpark_hash"),h.removeValue("allSpark_lastHash"),i.goLogin("h5_allspark")},goToAccount:function(a){a.stopPropagation();var b=e(a.currentTarget);window.location.hash="#account/"+b.attr("snsid")+"/1"}});return r});
define("/mw/webapp/transformer/dynIndex/dynIndexModel.js",["backbone","zepto","underscore","../common/mtopForAllspark.js","h5_comm","../common/cache","../common/refine.js"],function(a,b,c){var d=a("backbone"),e=a("zepto"),f=a("underscore"),g=a("../common/mtopForAllspark.js"),h=a("h5_comm"),i=a("../common/cache"),j=a("../common/refine.js"),k=d.Model.extend({_biz:{bannerUrl:"http://m.taobao.com/channel/rgn/weitao/banner.htm?callback=?",banner:function(a){var b=i.getIndexTms();b?a&&a.call(arguments.callee,JSON.parse(b)):e.ajax({type:"GET",dataType:"json",url:this.bannerUrl,success:function(b){var c={list:b,lastUpdate:Date.now()};i.saveIndexTms(JSON.stringify(c)),a&&a.call(arguments.callee,c)},error:function(b){a&&a.call(arguments.callee,null)}})}},getPageData:function(a){function d(a){g.recommends(a,function(a){j.refineRecommend(a);if(a.fail){c.set("recommends",a);return}a.t=(new Date).getTime(),c.set("recommends",a),c.set("loaded","1")})}function e(a,b){g.listWithFirstFeed(a,function(a){if(a.fail){c.set("accWithFeed",a);return}a.t=(new Date).getTime(),c.set("accWithFeed",a),b&&b.call(arguments.callee,a),c.set("loaded","1")})}var b=this._biz,c=this;a||(a={});var k=a.type||1;a.order?c.order=a.order:a.order=c.order||"fans";var l=f.clone(g.pageParam);f.extend(l,a),delete l.type,b.banner(function(a){(!c.get("banner")||a.lastUpdate!=c.get("banner").lastUpdate)&&c.set("banner",a)});var m=h.isLogin();c.set("loginStatus",m),(1==k||l.isIndex())&&m?(l.isIndex()&&g.allFeedCount(function(a){if(!a.data)return;var b=parseInt(i.getPersistent("feedCountsKey","counts")),d=parseInt(a.data.count),e=d-b;!!b&&!!d&&e&&c.set("newFeedCounts",{count:e,t:(new Date).getTime()}),d&&e&&i.savePersistent("feedCountsKey","counts",d)}),e(l,l.isIndex()?function(a){(!a.list||a.list.length<=1)&&d(l)}:null)):d(l)}});return k});
define("/mw/webapp/transformer/common/mtopForAllspark.js",["h5_mtop","h5_comm","h5_cache","uriBroker","zepto","cookie","../common/cache.js"],function(a,b,c){function l(a,b,c){k(a,b||{},function(a){c&&c.call(arguments.callee,a.data)},function(a){c&&c.call(arguments.callee,{fail:a})})}function m(a){return a.join?{snsIds:a.join(":")}:{snsIds:a}}var d=a("h5_mtop"),e=a("h5_comm"),f=a("h5_cache"),g=a("uriBroker"),h=a("zepto"),i=a("cookie"),j=a("../common/cache.js"),k=b.getData=function(a,b,c,f){d.getApi(a,"2.0",b,{ap_ref:window.location.hash},function(a){e.dealResponse(a,function(a){c&&c.call(this,a)},function(a){f&&f.call(this,a)},"h5_allspark")},function(a){f.call(this,a)})},n=b.userNick=e.getNickFromCookie()||e.getNickFromHidden()||(e.isLogin()?"test":"");b.pageParam={curPage:1,pageSize:3,isIndex:function(){return 1==this.curPage}},b.addAccount=function(a,b,c){this.getData("mtop.sns.follow.pubAccount.add",m(a),b,c)},b.removeAccount=function(a,b,c){this.getData("mtop.sns.follow.pubAccount.remove",m(a),b,c)},b.info=function(a,b){var c=j.getAccountById(a.snsId);l("mtop.sns.pubAccount.info",a,function(c){c.fail||j.saveAccount(a.snsId,c),b&&b.call(arguments.callee,c)})},b.allFeedCount=function(a,b){this.getData("mtop.sns.pubAccount.allFeedCount",{},a,b)},b.listBefore=function(a,b){l("mtop.sns.feed.listBefore",a,b)},b.readAndListAfter=function(a,b){l("mtop.sns.feed.readAndListAfter",a,b)},b.recommends=function(a,b){l("mtop.transformer.pubAccount.recommends",a,b)},b.my=function(a,b){l("mtop.sns.follow.pubAccount.my",a,b)},b.listWithFirstFeed=function(a,b){l("mtop.sns.pubAccount.listWithFirstFeed",a,b)},b.commentCount=function(a,b){l("mtop.sns.comment.count",a,b)},b.addComment=function(a,b){l("mtop.sns.comment.new",a,b)},b.commentList=function(a,b){l("mtop.sns.comment.list",a,b)},b.detail=function(a,b){l("mtop.sns.feed.detail",a,b)};var o={};g.URL_CONSTANTS.path.s_price||(g.URL_CONSTANTS.path.s_price="search_turn_page_iphone.htm"),b.getPrices=function(a,b){var c=[],d=[];a.forEach(function(a){o[a]?c.push({id:a,price:o[a]}):d.push(a)}),d.length?h.ajax({type:"GET",dataType:"json",url:g.getUrl("s_price",{nid:d.join(",")})+"&callback=?",success:function(a){a.result&&"true"==a.result&&a.listItem&&a.listItem.forEach(function(a){o[a.itemNumId]=a.price,c.push({id:a.itemNumId,price:a.price})}),b&&b.call(arguments.callee,c)},error:function(a){console.log(a),b&&b.call(arguments.callee,c)}}):b&&b.call(arguments.callee,c)},b.autoCreate=function(){var a=this.userNick;this.userNick&&!j.isCreateSns(this.userNick)&&d.getApi("mtop.transformer.account.autoCreate","2.0",{},{},function(b){var c=b.ret.toString().toUpperCase();c.indexOf("SUCCESS::")>-1&&j.saveSnsFlag(a)},function(a){})}});
define("/base/utils/server/mtop_h5api.js",["zepto","./cookie","./h5_utils","./h5_base","./uri","./mtop_h5_chunk.js"],function(a,b,c){function v(a){return a.indexOf("bigPipe.do?")>0}var d=a("zepto"),e=a("./cookie"),f=a("./h5_utils"),g=a("./h5_base"),h=a("./uri"),i="J_app_key",j="h5ApiUpdate.do",k="_m_h5_tk",l=a("./mtop_h5_chunk.js"),m="bigPipe.do",n=0,o=5,p=!1;callQue=[],b.getApi=function(a,b,c,d,e,f){var k=c&&!!c.apis;k?(d.entrance="h5",d.apis=typeof c.apis=="string"?c.apis:JSON.stringify(c.apis)):(d.api=a,d.v=b||"*",d.data=typeof c=="string"?c:JSON.stringify(c));var l=h.renderURI(h.createURI("api"),k?m:j,d,"rest"),n=g.getQueryString("ttid");n&&n.indexOf("@")==-1?l=l.replace(/ttid=[^&]+/,"ttid=taobao_h5_1.0.0"):n||(l+="&ttid=taobao_h5_1.0.0"),0==l.indexOf("http://api.m.taobao.com"&&k)&&(l=l.replace("taobao.com","taobao.com:9999"));var o=document.getElementById(i).value;callQue.push({url:l,app_key:o,data:d.data,callback:e,errorback:f}),p||(p=!0,r())};var q=function(a,b,c,f,g){var h=(e.getCookie(k)||"").split("_")[0],i=s(a,b,h,c),j={type:"GET",url:i,timeout:2e4,success:function(d){var h=(d.ret?d.ret:"").toString();if(-1!=h.indexOf("SUCCESS::"))n=0;else if(-1!=h.indexOf("TOKEN_EMPTY::")||-1!=h.indexOf("TOKEN_EXOIRED::")){if(n<o){q(a,b,c,f,g);return}e.delCookie(k),console.log("try exceed times")}f&&f(d),r()},error:function(a){g&&g(a),r()},complete:function(a,b){b!="success"&&g&&g(b),r()}};v(a)?l.chunkAjax(j):d.ajax(j)},r=function(){if(callQue.length>0){var a=callQue.pop(0);q(a.url,a.app_key,a.data,a.callback,a.errorback)}else p=!1},s=function(a,b,c,d){var e=(new Date).getTime();return t(a)+"&appKey="+b+"&sign="+u(b,c,e,d)+"&t="+e},t=function(a){if(-1==a.indexOf("callback=")&&!v(a)){var b=a.indexOf("?");return a.substr(0,b)+"?callback=?&type=jsonp&"+a.substr(b+1,a.length)}return a},u=function(a,b,c,d){var e=b+"&"+c+"&"+a+"&"+d;return e=f.MD5(e),e};b.addApi=function(a,c,d,e,f,g){var h={apis:[{api:a,v:c,data:d}],succ:{},error:{},addApi:function(a,b,c,d,e,f){return this.apis.push({api:a,v:b,data:c}),this.succ[a]=e,this.error[a]=f,this},execute:function(a){function c(a){b.getApi(a.api,a.v,a.data,{},this.succ[a.api],this.error[a.api])}if(a&&l.isXhr2())if(1==this.apis.length)c.call(this,this.apis[0]);else{var d=this;b.getApi("","",{apis:d.apis},{},function(a){a.api&&d.error[a.api]&&d.error[a.api].call(this,a)},function(a){a.api&&d.error[a.api]&&d.error[a.api].call(this,a)})}else{var d=this;this.apis.forEach(function(a){c.call(d,a)})}}};return h.succ[a]=f,h.error[a]=g,h}});
define("/base/utils/server/uri.js",["zepto","./config","./h5_base"],function(a,b,c){function o(a){if(null!=b.ttQueryStr&&""!=b.ttQueryStr){var c=a.match("\\.[a-zA-Z]+\\?");null!=c&&0<c.length?a.indexOf("?")==a.length-1?a+=b.ttQueryStr:a=a+"&"+b.ttQueryStr:a=a+"?"+b.ttQueryStr}return a}function p(a,b,c,d){r(d)||(a+="/"+d),r(b)||(a+="/"+b);var e=!1;if(null!=c)for(var f in c)if(null!=c[f]){e=!0;break}return e&&(a+="?"+t(c)),a}function q(a){if(r(a))return!1;for(var b=0;b<g.length;b++)if(g[b].toLowerCase()==a.toLowerCase())return!0;return!1}function r(a){return f.checkIsBlank(a)}function s(a,c){return a.replace(h,function(){return q(c)?c:b.uri.defaultDomain})}function t(a){var b="";if(null==a)return b;for(var c in a)null!=a[c]&&""!=a[c]&&(b+=c+"="+encodeURIComponent(a[c])+"&");return""!=b&&b.length-1==b.lastIndexOf("&")&&(b=b.substr(0,b.length-1)),b}var d=a("zepto"),e=a("./config"),f=a("./h5_base");b.uri={protocol:"http://",sysType:e.sysType||"m",defaultDomain:"taobao"};var g=["taobao","tmall","etao","alibaba","alipay"],h="${_serverDomain}",j=["ttid","sprefer"];b._serverHost=b.uri.sysType+"."+h+".com",b.subUri={index:b.uri.protocol+b._serverHost},b.ttQueryStr="";try{var k=JSON.parse(f.get(f.paramKey)||"{}")||{};k.ttid&&""!=k.ttid&&(b.ttQueryStr+="&ttid="+k.ttid);for(i in j){var l=j[i],m=f.getQueryString(l);m&&m!=""&&(b.ttQueryStr+="&"+l+"="+m)}}catch(n){}b.renderURI=function(a,b,c,d,e){return o(p(s(a,e),b,c,d))},b.renderDomain=function(a,c,d,e){return o(p(s(b.subUri.index,e),a,c,d))},b.renderServer=function(a,b,c,d){return o(p(d,a,b,c))},b.encode=function(a){return encodeURI(a)},b.getStrParamFromJson=function(a){return t(a)},b.createURI=function(a){return a==="home"?b.uri.protocol+b._serverHost:b.uri.protocol+a+"."+b._serverHost}});
define("/base/utils/server/config.js",[],function(a,b,c){var d="m";window.location.host=="localhost"||window.location.host.match(".*\\waptest\\.(taobao|tmall|etao|alibaba|alipay|aliyun)\\.com.*")?d="waptest":window.location.host.match(".*\\wapa\\.(taobao|tmall|etao|alibaba|alipay|aliyun)\\.com.*")?d="wapa":window.location.host.match(".*\\m\\.(taobao|tmall|etao|alibaba|alipay|aliyun)\\.com.*")&&(d="m"),b.sysType=d||"m",b.indexPage="http://fav."+b.sysType+".taobao.com/h5proxy-midFav.htm",b.errorPage="http://fav."+b.sysType+".taobao.com/fav_error.htm"});
define("/base/utils/server/mtop_h5_chunk.js",["zepto","./h5_common"],function(a,b,c){var d=a("zepto"),e=a("./h5_common"),f;b.isXhr2=function(){return undefined===f&&(f=d.ajaxSettings.xhr().upload),f},b.appPath=undefined,b.chunkAjax=function(a,c){var f=d.extend({},a||{});for(key in d.ajaxSettings)f[key]===undefined&&(f[key]=d.ajaxSettings[key]);var g=d.ajaxSettings.xhr(),h,i=function(){g.abort(),h&&clearTimeout(h)},j=0,k=!1,l=function(a){if(k)return;var c=a.substr(j),d=c.search(/\d+/);if(d<0)return;var h=c.match(/\d+/)[0],m=h.length+parseInt(h)+d;if(c.length>=m){k=!0;var n=c.substr(h.length+d,parseInt(h)),o,p;try{o=JSON.parse(n)}catch(q){p=q}var r=f.context;p?(i(),f.error.call(this,p)):e.dealResponse(o,function(a){f.success.call(r,a)},function(a){f.error.call(this,a)},b.appPath,"",!0),j+=m,k=!1}g.responseText.length>=j&&l(g.responseText)};if(!g.upload)return console.log("un support xhr2"),!1;g.onreadystatechange=function(){g.readyState==4?g.status>=200&&g.status<300||g.status==304?l(g.responseText,!0):i():g.readyState==3&&l(g.responseText)},g.open(f.type,f.url,!0);for(name in f.headers)g.setRequestHeader(name,f.headers[name]);return f.timeout>0&&(h=setTimeout(function(){g.onreadystatechange=function(){},g.abort()},f.timeout)),g.send(f.data?f.data:null),g}});
define("/base/utils/server/h5_common.js",["./uriBroker","./h5_base","zepto","./cookie"],function(a,b,c){var d=a("./uriBroker"),e=a("./h5_base"),f=a("zepto"),g=a("./cookie"),h=function(a){var b=d.getUrl(a);window.location.href=d.getUrl("login",{tpl_redirect_url:b})},i=function(a){a&&a!="undefined"&&(window.location.href=d.getUrl(a)),window.location.href="http://m.taobao.com"};b.dealResponse=function(a,b,c,d,f,g){var k=a.ret.toString().toUpperCase();k.indexOf("SUCCESS::")>-1?b(a):(e.set(e.hrefHash,window.location.hash),k.indexOf("FAIL_SYS_SESSION_EXPIRED")>-1||k.indexOf("NEED_LOGIN::")>-1||k.indexOf("-100::")>-1||k.indexOf("NOT_FOUNT_USER::")>-1||k.indexOf("ERR_SID_INVALID::")>-1||k.indexOf("SID_ERROR::")>-1?d?h(d):h("home"):k.indexOf("ILLEGAL_REQUEST::")>-1||k.indexOf("ILLEGAL_SIGN::")>-1?j()?c&&c(g?a:k):i(f):c&&c(g?a:k))};var j=function(){var a=parseInt(e.get(e.appRequestFailed)||"0");return 3<=a?(window.location.href="http://m.taobao.com?t=3",!0):(a+=1,e.set(e.appRequestFailed,a),!1)};b.isSupportH5=function(){return window.localStorage=="undefined"?!1:window.applicationCache=="undefined"?!1:!0},b.getNickFromCookie=function(){var a=g.getCookie("_w_tb_nick");return a&&a.length>2&&a!="null"?a:""},b.getNickFromHidden=function(){var a=f("#J_user_nick").val();return a?a:""},b.isLogin=function(){var a=g.getCookie("imewweoriw");return a&&decodeURIComponent(a).length>32},b.goLogin=function(a){a=a||"home",h(a)},b.isSuppWebp=function(){return"true"==g.getCookie("supportWebp")}});
define("/base/utils/server/uriBroker.js",["underscore","./uri","./h5_base"],function(a,b,c){function h(a){if(URL_CONSTANTS.path[a])return URL_CONSTANTS.path[a];var b=a.lastIndexOf("_");return b<0?"":h(a.substring(0,b))}function i(a,b){return a==URL_CONSTANTS.path["a"]&&(a=a.replace("ITEM_ID",function(){var a=b.itemId;return delete b.itemId,a})),a==URL_CONSTANTS.path["a_td"]&&(a=a.replace("ORDER_ID",function(){var a=b.tradeId;return delete b.tradeId,a})),a||""}function j(a){var b=URL_CONSTANTS.dps[a];if(d.isString(b))return b;if(d.isObject(b)){var c=b.cache;if(b.dps)return URL_CONSTANTS[c]=b.dps,b.dps;if(c)return URL_CONSTANTS[c]}return!a||a.lastIndexOf("_")<0?"":(a=a.substring(0,a.lastIndexOf("_")),j(a))}var d=a("underscore"),e=a("./uri"),f=a("./h5_base"),g={};return g.URL_CONSTANTS=URL_CONSTANTS={path:{home:"index.htm",home_wuliu:"trade/bought_item_lists.htm",home_kehu:"channel/act/other/kehufuwu.xhtml",home_anquan:"channel/act/other/jiaoyianquan.xhtml",home_tiantiantejia:"channel/act/sale/tiantiantejia.html",home_taojinbi:"channel/act/taojinbi.html",home_help:"channel/act/other/help.xhtml",home_msg:"index_header_ajax.htm",my:"myTaobao.htm",my_deliver:"deliver/wap_deliver_address_list.htm",my_alipay:"myAlipay.htm",my_bindalipay:"alipay_modify.htm",my_viewitems:"view_items.htm",a:"iITEM_ID.htm",a_td:"tdORDER_ID.htm",s:"search.htm",s_history:"history.htm",im:"ww/ad_ww_lately_contacts.htm",im_icon:"ww/status.do",shop:"shop/shop_index.htm",shop_search:"shop/shop_auction_search.htm",login:"login.htm",login_out:"logout.htm",u_reg:"reg/newUser.htm",fav:"h5proxy-mid_fav.htm",auction1_cart:"cart/my_cart.htm",info_jianyi:"help/report.htm",h5_ww:"ww/index.htm",h5_myhome:"my/index.htm",h5_allspark:"we/index.htm",h5_mycart:"cart/index.htm",d:"my_bag.htm",triph5_order:"myorder.html",caipiao_order:"lottery/wap/user/my_lottery.htm",tm_pay:"order/baobeiPay.htm",auction1_refund:"refund/fill_refund.htm",tm_cancelOrder:"order/order_cancel.htm"},dps:{},app_param_key:f.paramKey},g.getUrl=function(a,b){a=a.toLowerCase(),b=b||{};var c=b.domain;c?delete b.domain:c="taobao";var f=a.split("_"),g=e.createURI(f[0]);if(!g)throw"module param is not current,can't match any host";var j="",k=_getDps(a,b);switch(f[0]){case"api":var l={};l.data=JSON.stringify(b),d.extend(l,this.defaultMtopParam),b=l,j=h(a);break;default:j=h(a),j=i(j,b)}return k&&(b.pds=k),e.renderURI(g,"",b,j,c)},g.getDps=_getDps=function(a,b){if(b.dps)return b.dps;var c=a,d=b.method;return d&&(c+="_"+d.toLowerCase()),b._3th&&(c+="_3th",delete b._3th),b.trigerType&&(c+="_"+b.trigerType,delete b.trigerType),j(c)},g});
define("/base/utils/server/h5_cache.js",["./h5_base"],function(a,b,c){var d=30,e=a("./h5_base");b.putExpireValue=function(a,b,c){try{var d={};d.data=b,d.expireTime=Date.now()+parseInt(c),e.set(a,JSON.stringify(d))}catch(f){}},b.getExpireValue=function(a){try{var b=e.get(a);return b?(b=JSON.parse(b),b.expireTime<Date.now()?(e.removeValue(a),null):b.data):null}catch(c){}return null},b.pushValue=function(a,b,c,f){try{if(!a||!b||!c)return!1;f=f||d;if(f<1)return!1;var g=e.get(a),h={};h[b]=c;if(!g)return e.set(a,"["+JSON.stringify(h)+"]"),!0;g=JSON.parse(g);var i=g.length,j=!1;for(var k=0;k<i;k++){var l=g[k][b];if(l){g[k]=h,j=!0;break}}if(!j){var m=i-f+1;m>0&&(g=g.slice(m,i)),g.push(h)}e.set(a,JSON.stringify(g))}catch(n){return!1}return!0},b.getValue=function(a,b){try{var c=e.get(a);if(!c)return null;c=JSON.parse(c);var d=c.length;for(var f=0;f<d;f++){var g=c[f][b];if(g)return g}}catch(h){return null}return null}});
define("/mw/webapp/transformer/common/cache.js",["h5_base","cookie","h5_cache"],function(a,b,c){var d=10,e={itemCacheKey:"allspark_item_key",accountCacheKey:"allspark_account_key",snsFlagCacheKey:"allspark_sns_flag_key",indexTmsCacheKey:"allspark_index_tms_key",feedCountsKey:"allspark_feed_counts_key"},f=a("h5_base"),g=a("cookie"),h=a("h5_cache");b.saveIndexTms=function(a){h.putExpireValue(e.indexTmsCacheKey,a,6e5)},b.getIndexTms=function(){return h.getExpireValue(e.indexTmsCacheKey)},b.savePersistent=function(a,b,c){var i=e[a];if(!i)return null;f.isSuppLocalStorage()?h.pushValue(i,b,c,d):g.setCookie(i+"_"+b,c)},b.getPersistent=function(a,b){var c=e[a];return c?f.isSuppLocalStorage()?h.getValue(c,b):g.getCookie(c+"_"+b):null},b.saveSnsFlag=function(a){b.savePersistent("snsFlagCacheKey",a,"1")},b.isCreateSns=function(a){return a&&a.length>1?"1"==b.getPersistent("snsFlagCacheKey",a):!1};var i={},j=30;b.pushValue=function(a,b,c,d){try{if(!a||!b||!c)return!1;d=d||j;if(d<1)return!1;var e=i[a],f={};f[b]=c;if(!e)return i[a]="["+JSON.stringify(f)+"]",!0;e=JSON.parse(e);var g=e.length,h=!1;for(var k=0;k<g;k++){var l=e[k][b];if(l){e[k]=f,h=!0;break}}if(!h){var m=g-d+1;m>0&&(e=e.slice(m,g)),e.push(f)}i[a]=JSON.stringify(e)}catch(n){return!1}return!0},b.getValue=function(a,b){try{var c=i[a];if(!c)return null;c=JSON.parse(c);var d=c.length;for(var e=0;e<d;e++){var f=c[e][b];if(f)return f}}catch(g){return null}return null},b.saveMemData=function(a,b,c){var g=e[a];return g?f.isClient()?h.pushValue(g,b,c,d):this.pushValue(g,b,c,d):null},b.getMemData=function(a,b){var c=e[a];return c?f.isClient()?h.getValue(c,b):this.getValue(c,b):null},b.getAccountById=function(a){return b.getMemData("accountCacheKey",a)},b.saveAccount=function(a,c){return b.saveMemData("accountCacheKey",a,c)},b.getItemById=function(a){return b.getMemData("itemCacheKey",a)},b.saveItem=function(a,c){return b.saveMemData("itemCacheKey",a,c)}});
define("/mw/webapp/transformer/common/refine.js",["uriBroker","cdn"],function(a){var b=a("uriBroker"),c=a("cdn");return{refinePubAccount:function(a){a.id=a.id===undefined?0:a.id,a.nick=a.nick||"",a.description=a.description||"",a.url=a.url||"",a.urlTitle=a.urlTitle||"",a.wangwang=a.wangwang||"",a.backgroundImg=a.backgroundImg||"",a.fansCount=a.fansCount===undefined?0:a.fansCount,a.accountType=a.accountType===undefined?0:a.accountType},refineRecommend:function(a){var b=this;a.list&&a.list.forEach(function(a){b.refinePubAccount(a)})},refineFeed:function(a){var b=this;a.list&&a.list.forEach(function(a){b.refineFeedListItem(a)})},refineFeedListItem:function(a){var b=this;a.coverTile&&b.refineFeedTile(a.coverTile),a.id=a.id===undefined?0:a.id,a.layout=a.layout||"",a.title=a.title||"",a.linkTitle=a.linkTitle||"",a.linkUrl=a.linkUrl||"",a.commentCount=a.commentCount===undefined?0:a.commentCount,a.time=a.time===undefined?0:a.time},refineFeedTile:function(a){var b=this;typeof a.type=="undefined"&&(a.type=""),a.text=a.text||"",a.path=a.path||"",a.item&&b.refineFeedItem(a.item)},refineFeedItem:function(a){a.id=a.id===undefined?0:a.id},refineComment:function(a){a.id=a.id===undefined?0:a.id,a.content=a.content||"",a.createrId=a.createrId===undefined?0:a.createrId,a.createrName=a.createrName||"",a.createrPic=a.createrPic||"",a.time=a.time===undefined?0:a.time},refineAccountFeed:function(a){this.refinePubAccount(a.account),this.refineFeed(a.firstFeed),a.unreadCount=a.unreadCount===undefined?0:a.unreadCount},refinePagination:function(a){a.curPage=a.curPage===undefined?0:a.curPage,a.pageSize=a.pageSize===undefined?0:a.pageSize,a.direction=a.direction===undefined?0:a.direction,a.timestamp=a.timestamp===undefined?0:a.timestamp},refinePaginationResult:function(a,b){a.totalCount=a.totalCount===undefined?0:a.totalCount,a.list.forEach(b),a.timestamp=a.timestamp===undefined?0:a.timestamp},refineOperationResult:function(a){a.id=a.id===undefined?0:a.id,a.isSuccess=!!a.isSuccess,a.errorCode=a.errorCode||""},refineBatOperationResult:function(a){a.isAllSuccess=!!a.isAllSuccess,a.list.forEach(this.refineOperationResult)},refineDetail:function(a){a.title=a.title||"",a.linkUrl=a.linkUrl||"",a.tiles=a.tiles||[],a.time=a.time||""}}});
define("/base/utils/server/cdn.js",["./config","./h5_common","zepto"],function(a,b,c){function t(a,b){var c=0;for(var d=b.length;--d;d>=0)if(b[d]<=a){b[d]==a?c=a:d<b.length-1&&(c=b[d+1]);break}return c}function u(a){return v(p,a,h,null,null,null,!0)}function v(a,b,c,d,e,f,g){if(!b)return"http://a.tbcdn.cn/mw/s/common/icons/nopic/nopic-"+d+".png";var i="";if(-1!=b.indexOf("http://"))i=g?b:b+w(d,e);else if(a==o)i=z()+m+b+(g?"":w(d,e));else{var j=x(b,f);i=y(j).replace("${machine}",j)+h+b+(g?"":w(d,e))}return i+D(i)}function w(a,b){return"_"+(a||80)+"x"+(b||80)+".jpg"}function x(a,b){var c=-1;null!=b&&b.toString().match("[0-9]")&&(c=b%n);if(-1==c)if(a.match("^i[0-9].*"))c=parseInt(a.charAt(1))%n;else{var d=a.match("([^/]*).jpg");if(null!=d&&""!=d&&d.length>1){var e=d[1].length,f=d[1].charCodeAt(0)+d[1].charCodeAt(e-1);c=f%n}else c=a.charCodeAt(0)%n}return 0==c&&(c+=1),c}function y(){return A()?i:j}function z(){return A()?k:l}function A(){return"waptest"==f}function C(){if(B)return B;var a=document.createElement("style");a.type="text/css",a.textContent="@media screen and (-webkit-device-pixel-ratio:1) {#ratio{height:1px;}}@media screen and (-webkit-device-pixel-ratio:1.5) {#ratio{height:1.5px;}}@media screen and (-webkit-device-pixel-ratio:2) {#ratio{height:2px;}}",$("head").append(a);var b=$("<div style='display: none' id='ratio'>");$(document.body).append(b);var c=b.css("height");b.remove(),$(a).remove();try{B=parseFloat(c.slice(0,c.length-2))}catch(d){B=1}return B}function D(a){return a&&a.indexOf("taobaocdn")!=-1&&a.indexOf("_.webp")==-1&&e.isSuppWebp()?"_.webp":""}var d=a("./config"),e=a("./h5_common");$=a("zepto");var f=d.sysType||"m",g="${machine}",h="/bao/uploaded/",i="http://img0"+g+".daily.taobaocdn.net",j="http://q.i0"+g+".wimg.taobao.com",k="http://logo.daily.taobao.net",l="http://logo.taobaocdn.com",m="/shop-logo/",n=4,o=1,p=2;getImgUrl=b.getImgUrl=function(a,b,c,d){window.devicePixelRatio<=1&&(b=c);var e=b+(d?"xz":"");return v(p,a,h,b,e)};var q=b.getImg=function(a,b,c,d){return v(p,a,h,b,c,d)},r=[110,150,170,220,240,290,450,570,580,620,790],s=[230,290,310,460,580,640];b.getBetterImg=function(a,c,d,e){return b.resizeImg({url:a,expWidth:c,rWidth:d,isXz:e}).url},b.resizeImg=function(a){var b={},c=C();try{a.rWidth>=a.rHeight&&(a.isXz=!1);var d=a.expWidth*c,e=t(d,a.isXz?s:r)||a.rWidth;b.width=d/c,b.height=a.isXz?a.rWidth>a.rHeight?a.rHeight*b.width/a.rWidth:b.width:a.rHeight*b.width/a.rWidth;if(a.isXz){if(e>=a.rWidth){var f=s.length;while(--f>0)if(s[f]<=a.rWidth){e=s[f];break}}b.url=e>a.rWidth?u(a.url):v(p,a.url,h,e,e+"xz",null)}else b.url=e>=a.rWidth?u(a.url):v(p,a.url,h,e,1e4,null);return b}catch(g){return{url:a.url,width:a.rWidth,height:a.rHeight}}},b.getLogo=function(a,b,c,d){return v(o,a,m,b,c,d)};var B=undefined;b.setDefaultDpi=function(a){B=a},C()});
define("/base/styles/component/slider/js/slider.js",["zepto","../../../../utils/smallCss3/css3"],function(a,b,c){var d=a("zepto"),e=a("../../../../utils/smallCss3/css3"),f=/android/gi.test(navigator.appVersion),g=e.has3d(),h=e.hasTransform(),i=g?"translate3d(":"translate(",j=g?",0)":")";return d.touchSlider=function(a,b){if(!a)return null;b?b.container=a:b=typeof a=="string"?{container:a}:a,d.extend(this,{container:".slider",wrap:null,panel:null,trigger:null,activeTriggerCls:"sel",hasTrigger:!1,steps:0,left:0,visible:1,margin:0,curIndex:0,duration:300,loop:!1,play:!1,interval:5e3,useTransform:!f,lazy:".lazyimg",lazyIndex:1,callback:null,prev:null,next:null,activePnCls:"none"},b),this.findEl()&&this.init()&&this.increaseEvent()},d.extend(d.touchSlider.prototype,{reset:function(a){d.extend(this,a||{}),this.init()},findEl:function(){var a=this.container=d(this.container);return a.length?(this.wrap=this.wrap&&a.find(this.wrap)||a.children().first(),this.wrap.length?(this.panel=this.panel&&a.find(this.panel)||this.wrap.children().first(),this.panel.length?(this.panels=this.panel.children(),this.panels.length?(this.trigger=this.trigger&&a.find(this.trigger),this.prev=this.prev&&a.find(this.prev),this.next=this.next&&a.find(this.next),this):(this.container.hide(),null)):null):null):null},init:function(){var a=this.wrap,b=this.panel,c=this.panels,d=this.trigger,e=this.len=c.length,f=this.margin,g=0,k=this.visible,l=this.useTransform=h?this.useTransform:!1;this.steps=this.steps||a.width(),c.each(function(a,b){g+=b.offsetWidth}),f&&typeof f=="number"&&(g+=(e-1)*f,this.steps+=f),k>1&&(this.loop=!1);var m=this.left;m-=this.curIndex*this.steps,this.setCoord(b,m),l&&(a.css({"-webkit-transform":"translate3d(0,0,0)"}),b.css({"-webkit-backface-visibility":"hidden"}),c.css({"-webkit-transform":i+"0,0"+j}));var n=this._pages=Math.ceil(e/k);this._minpage=0,this._maxpage=this._pages-1,this.loadImg(),this.updateArrow();if(n<=1)return this.getImg(c[0]),d&&d.hide(),null;if(this.loop){b.append(c[0].cloneNode(!0));var o=c[e-1].cloneNode(!0);b.append(o),this.getImg(o),o.style.cssText+="position:relative;left:"+ -this.steps*(e+2)+"px;",g+=c[0].offsetWidth,g+=c[e-1].offsetWidth}b.css("width",g);if(d&&d.length){var p="",q=d.children();if(!q.length){for(var r=0;r<n;r++)p+="<span"+(r==this.curIndex?" class="+this.activeTriggerCls+"":"")+"></span>";d.html(p)}this.triggers=d.children(),this.triggerSel=this.triggers[this.curIndex]}else this.hasTrigger=!1;return this},increaseEvent:function(){var a=this,b=a.wrap[0],c=a.prev,e=a.next,f=a.triggers;b.addEventListener&&(b.addEventListener("touchstart",a,!1),b.addEventListener("touchmove",a,!1),b.addEventListener("touchend",a,!1),b.addEventListener("webkitTransitionEnd",a,!1),b.addEventListener("msTransitionEnd",a,!1),b.addEventListener("oTransitionEnd",a,!1),b.addEventListener("transitionend",a,!1)),a.play&&a.begin(),c&&c.length&&c.on("click",function(b){a.backward.call(a,b)}),e&&e.length&&e.on("click",function(b){a.forward.call(a,b)}),a.hasTrigger&&f&&f.each(function(b,c){d(c).on("click",function(){a.slideTo(b)})})},handleEvent:function(a){switch(a.type){case"touchstart":this.start(a);break;case"touchmove":this.move(a);break;case"touchend":case"touchcancel":this.end(a);break;case"webkitTransitionEnd":case"msTransitionEnd":case"oTransitionEnd":case"transitionend":this.transitionEnd(a)}},loadImg:function(a){a=a||0,a<this._minpage?a=this._maxpage:a>this._maxpage&&(a=this._minpage);var b=this.visible,c=this.lazyIndex-1,d=c+a;if(d>this._maxpage)return;d+=1;var e=(a&&c+a||a)*b,f=d*b,g=this.panels;f=Math.min(g.length,f);for(var h=e;h<f;h++)this.getImg(g[h])},getImg:function(a){if(!a)return;a=d(a);if(a.attr("l"))return;var b=this,c=b.lazy,e="img"+c;c=c.replace(/^\.|#/g,""),a.find(e).each(function(a,b){var e=d(b);src=e.attr("dataimg"),src&&e.attr("src",src).removeAttr("dataimg").removeClass(c)}),a.attr("l","1")},start:function(a){var b=a.touches[0];this._movestart=undefined,this._disX=0,this._coord={x:b.pageX,y:b.pageY}},move:function(a){if(a.touches.length>1||a.scale&&a.scale!==1)return;var b=a.touches[0],c=this._disX=b.pageX-this._coord.x,d=this.left,e;typeof this._movestart=="undefined"&&(this._movestart=!!(this._movestart||Math.abs(c)<Math.abs(b.pageY-this._coord.y))),this._movestart||(a.preventDefault(),this.stop(),this.loop||(c/=!this.curIndex&&c>0||this.curIndex==this._maxpage&&c<0?Math.abs(c)/this.steps+1:1),e=d-this.curIndex*this.steps+c,this.setCoord(this.panel,e),this._disX=c)},end:function(a){if(!this._movestart){var b=this._disX;b<-10?(a.preventDefault(),this.forward()):b>10&&(a.preventDefault(),this.backward()),b=null}},backward:function(a){a&&a.preventDefault&&a.preventDefault();var b=this.curIndex,c=this._minpage;b-=1,b<c&&(this.loop?b=c-1:b=c),this.slideTo(b),this.callback&&this.callback(Math.max(b,c),-1)},forward:function(a){a&&a.preventDefault&&a.preventDefault();var b=this.curIndex,c=this._maxpage;b+=1,b>c&&(this.loop?b=c+1:b=c),this.slideTo(b),this.callback&&this.callback(Math.min(b,c),1)},setCoord:function(a,b){this.useTransform&&a.css("-webkit-transform",i+b+"px,0"+j)||a.css("left",b)},slideTo:function(a,b){a=a||0,this.curIndex=a;var c=this.panel,d=c[0].style,e=this.left-a*this.steps;d.webkitTransitionDuration=d.MozTransitionDuration=d.msTransitionDuration=d.OTransitionDuration=d.transitionDuration=(b||this.duration)+"ms",this.setCoord(c,e),this.loadImg(a)},transitionEnd:function(){var a=this.panel,b=a[0].style,c=this.loop,d=this.curIndex;c&&(d>this._maxpage?this.curIndex=0:d<this._minpage&&(this.curIndex=this._maxpage),this.setCoord(a,this.left-this.curIndex*this.steps)),!c&&d==this._maxpage?(this.stop(),this.play=!1):this.begin(),this.update(),this.updateArrow(),b.webkitTransitionDuration=b.MozTransitionDuration=b.msTransitionDuration=b.OTransitionDuration=b.transitionDuration=0},update:function(){var a=this.triggers,b=this.activeTriggerCls,c=this.curIndex;a&&a[c]&&(this.triggerSel&&(this.triggerSel.className=""),a[c].className=b,this.triggerSel=a[c])},updateArrow:function(){var a=this.prev,b=this.next;if(!a||!a.length||!b||!b.length)return;if(this.loop)return;var c=this.curIndex,d=this.activePnCls;c<=0&&a.addClass(d)||a.removeClass(d),c>=this._maxpage&&b.addClass(d)||b.removeClass(d)},begin:function(){var a=this;a.play&&!a._playTimer&&(a.stop(),a._playTimer=setInterval(function(){a.forward()},a.interval))},stop:function(){var a=this;a.play&&a._playTimer&&(clearInterval(a._playTimer),a._playTimer=null)},destroy:function(){var a=this,b=a.wrap[0],c=a.prev,e=a.next,f=a.triggers;b.removeEventListener&&(b.removeEventListener("touchstart",a,!1),b.removeEventListener("touchmove",a,!1),b.removeEventListener("touchend",a,!1),b.removeEventListener("webkitTransitionEnd",a,!1),b.removeEventListener("msTransitionEnd",a,!1),b.removeEventListener("oTransitionEnd",a,!1),b.removeEventListener("transitionend",a,!1)),c&&c.length&&c.off("click"),e&&e.length&&e.off("click"),a.hasTrigger&&f&&f.each(function(a,b){d(b).off("click")})}}),d.touchSlider.cache=[],d.fn.slider=function(a){return this.each(function(b,c){c.getAttribute("l")||(c.setAttribute("l",!0),d.touchSlider.cache.push(new d.touchSlider(c,a)))})},d.touchSlider.destroy=function(){var a=d.touchSlider.cache,b=a.length;if(b<1)return;for(var c=0;c<b;c++)a[c].destroy();d.touchSlider.cache=[]},d.touchSlider});
define("/base/utils/smallCss3/css3.js",[],function(a,b,c){function j(a,b){return typeof a===b}function k(a,b){for(var c in a)if(i[a[c]]!==undefined)return b=="pfx"?a[c]:!0;return!1}function l(a,b,c){var d=a.charAt(0).toUpperCase()+a.substr(1),e=(a+" "+h.join(d+" ")+d).split(" ");if(j(b,"string")||j(b,"undefined"))return k(e,b)}var d={},e=document.documentElement,f="modernizr",g=function(a,b,c,d){var g,h,i,j=document.createElement("div"),k=document.body,l=k?k:document.createElement("body");if(parseInt(c,10))while(c--)i=document.createElement("div"),i.id=d?d[c]:f+(c+1),j.appendChild(i);return g=["&#173;",'<style id="s',f,'">',a,"</style>"].join(""),j.id=f,(k?j:l).innerHTML+=g,l.appendChild(j),k||(l.style.background="",e.appendChild(l)),h=b(j,a),k?j.parentNode.removeChild(j):l.parentNode.removeChild(l),!!h},h="Webkit Moz O ms".split(" "),i=e.style;return d.hasTransform=function(){return!!l("transform")},d.has3d=function(){var a=!!l("perspective");return a&&"webkitPerspective"in e.style&&g("@media (transform-3d),(-webkit-transform-3d){#modernizr{left:9px;position:absolute;height:3px;}}",function(b,c){a=b.offsetLeft===9&&b.offsetHeight===3}),a},d});
define("/base/styles/component/pagenav/js/pagenav.js",["zepto"],function(a){var b=a("zepto"),c=function(a){this.init(a)};return c.prototype={setIndex:function(a){var b=this;a=Number(a),isNaN(a)&&(a=1),a>b.pageCount&&(a=b.pageCount),a<=0&&(a=1),b.index=a,b.renderPage()},init:function(a){this.$container||(this.$container=b(a.id)),this.index=Number(a.index?a.index:1),this.pageCount=Number(a.pageCount?a.pageCount:1),this.preFix=a.preFix?a.preFix:"!page/",this.objId=a.objId?a.objId:"Z",this.disableHash=a.disableHash,this.oldIndex=-1;var c=this.preFix.toString().length;this.preFix[c-1]!="/"&&(this.preFix+="/"),isNaN(this.index)&&(this.index=1),this.index>this.pageCount&&(this.index=this.pageCount),this.index<=0&&(this.index=1),this.createDom(),this.eventAttach(),this.parseHash(),this.renderPage()},parseHash:function(){var a=this,b=location.hash,c=b.substr(b.lastIndexOf("/")+1),d=[],e=0,f=[];d=c.split("-");for(var g=0;g<d.length;g++){f=d[g].split("");var h=f.shift();if(h==this.objId){e=Number(f.join(""));if(isNaN(e)||e<=0)a.index=1;e>a.pageCount&&(a.index=a.pageCount),a.index=e}}},setContainer:function(a){this.$container=b(a)},getObjId:function(){return this.objId},changeHash:function(){var a=this,b=location.hash;if(b=="")location.hash=a.preFix+"-"+a.objId+a.index;else{var c=b.lastIndexOf(a.objId),d=c;if(c==-1)location.hash+="-"+a.objId+a.index;else{for(;;){d++;if(b[d]=="-"||!b[d])break}b=b.replace(b.substring(c,d),a.objId+a.index),location.hash=b}}},createDom:function(){var a=this;a.$container.empty();var c=['<section class="c-p-sec">','<div class="c-p-pre">','<span class="c-p-p">',"<em></em>","</span><a>上一页</a>","</div>",'<div class="c-p-cur">','<div class="c-p-arrow c-p-down"><span></span><span></span></div>','<select class="c-p-select">',"</select></div>",'<div class="c-p-next">','<a>下一页</a><span class="c-p-p">',"<em></em>","</span>","</div>","</section>"];a.$container.html(c.join("")),b("select",a.$container).empty(),c=[];for(var d=1;d<=a.pageCount;d++)c[d-1]="<option>第"+d+"页</option>";b("select",a.$container).append(c.join(""))},renderPage:function(){var a=this,c=b("option",a.$container).length,d=b(".c-p-pre",a.$container),e=b(".c-p-next",a.$container);c<=1?(d.addClass("c-p-grey"),e.addClass("c-p-grey"),c=1):a.index==1?(d.addClass("c-p-grey"),c>1&&e.removeClass("c-p-grey")):a.index==c?(e.addClass("c-p-grey"),c>1&&d.removeClass("c-p-grey")):a.index>1&&a.index<c&&(d.removeClass("c-p-grey"),e.removeClass("c-p-grey"));var f=a.index+"/"+c;b(".c-p-arrow span:first-child",a.$container).text(f),b("select",a.$container).get(0).selectedIndex=this.index-1,d=null,e=null},eventDetach:function(){var a=this,c=b(a.$container);c.undelegate("select","mousedown",a.modifyArr),c.undelegate("select","blur",a.blur),c.find(".c-p-pre").undelegate("a","click",a.lastPage),c.find(".c-p-next").undelegate("a","click",a.nextPage),c.undelegate("select","change",a.selectChange),c=null},eventAttach:function(){var a=this,c=b(a.$container);c.delegate("select","mousedown",a.modifyArr=function(c){b(".c-p-arrow",a.$container).removeClass("c-p-down").addClass("c-p-up")}),c.delegate("select","blur",a.blur=function(c){b(".c-p-arrow",a.$container).removeClass("c-p-up").addClass("c-p-down")}),c.find(".c-p-pre").delegate("a","click",a.lastPage=function(c){c.preventDefault();if(b(this).parent().hasClass("c-p-grey"))return!1;a.index--,a.renderPage(),a.disableHash?a.$container.trigger("P:switchPage",{index:a.index,type:"pre"}):a.changeHash(),a.oldIndex=a.index}),c.find(".c-p-next").delegate("a","click",a.nextPage=function(c){c.preventDefault();if(b(this).parent().hasClass("c-p-grey"))return!1;a.index++,a.renderPage(),a.disableHash?a.$container.trigger("P:switchPage",{index:a.index,type:"next"}):a.changeHash(),a.oldIndex=a.index}),c.delegate("select","change",a.selectChange=function(){a.index=b(this).get(0).selectedIndex+1;if(a.oldIndex==a.index)return;a.renderPage(),b(".c-p-arrow",a.$container).removeClass("c-p-up").addClass("c-p-down"),a.disableHash?a.$container.trigger("P:switchPage",{index:a.index,type:"select"}):a.changeHash(),a.oldIndex=a.index})},pContainer:function(){return this.$container}},c});
define("/mw/webapp/transformer/ui/notification.js",["zepto","./effect.js"],function(a,b,c){var d=a("zepto"),e=a("./effect.js"),f=d("#notification"),g=f.find(".actions"),h=f.find(".long-message"),i=f.find(".simple-message");return{show:function(){f.fadeIn(100)},hide:function(){f.fadeOut(200)},position:function(){f.css("opacity","0").show(),f.css("top",window.innerHeight/2-f.height()/2),f.hide()},message:function(a,b){f.off(),g.hide(),h.hide(),i.html(a).show(),this.position(),this.show();var c=this;b||setTimeout(function(){c.hide()},1200)},alert:function(a,b){var c=this;f.off(),g.show(),h.hide(),i.html(a).show(),g.find(".btn-wrap").hide(),g.find(".btn-wrap").last().show(),f.on("click",".retry",function(){c.hide(),b&&b()}),this.position(),this.show()},confirm:function(a,b,c){},external:function(a,b,c){var d=this;f.off(),g.find(".btn-wrap").show(),g.find(".btn-wrap").last().hide(),g.show(),i.hide(),h.find(".external").attr("href",a).text(a),h.show(),f.on("click",".confirm",function(){d.hide(),b&&b()}),f.on("click",".cancel",function(){d.hide(),c&&c()}),this.position(),this.show()}}});
define("/mw/webapp/transformer/ui/effect.js",["zepto"],function(a,b,c){function j(a,b,c,e,f){typeof b=="function"&&!f&&(f=b,b=undefined);var g={opacity:c};return e&&(g.scale=e,a.css(d.fx.cssPrefix+"transform-origin","0 0")),a.animate(g,b,null,f)}function k(a,b,c,e){return j(a,b,0,c,function(){h.call(d(this)),e&&e.call(this)})}var d=a("zepto"),e=window.document,f=e.documentElement,g=d.fn.show,h=d.fn.hide,i=d.fn.toggle;d.fn.show=function(a,b){return g.call(this),a===undefined?a=0:this.css("opacity",0),j(this,a,1,"1,1",b)},d.fn.hide=function(a,b){return a===undefined?h.call(this):k(this,a,"0,0",b)},d.fn.toggle=function(a,b){return a===undefined||typeof a=="boolean"?i.call(this,a):this.each(function(){var c=d(this);c[c.css("display")=="none"?"show":"hide"](a,b)})},d.fn.fadeTo=function(a,b,c){return j(this,a,b,null,c)},d.fn.fadeIn=function(a,b){var c=this.css("opacity");return c>0?this.css("opacity",0):c=1,g.call(this).fadeTo(a,c,b)},d.fn.fadeOut=function(a,b){return k(this,a,null,b)},d.fn.fadeToggle=function(a,b){return this.each(function(){var c=d(this);c[c.css("opacity")==0||c.css("display")=="none"?"fadeIn":"fadeOut"](a,b)})}});
define("/mw/webapp/transformer/ui/loading.js",["zepto"],function(a,b,c){window.$=a("zepto");var d=$("#loading");return{show:function(){this.position(),d.show()},hide:function(){d.hide()},position:function(){d.css("opacity","0").show(),d.css("top",window.innerHeight/2),d.hide().css("opacity","1")}}});
define("/mw/webapp/transformer/account/accountView.js",["backbone","zepto","underscore","./accountModel","../../../../base/styles/component/pagenav/js/pagenav.js","h5_comm","../ui/loading","../ui/notification.js","../common/mtopForAllspark.js"],function(a,b,c){var d=a("backbone"),e=a("zepto"),f=a("underscore"),g=a("./accountModel"),h=a("../../../../base/styles/component/pagenav/js/pagenav.js"),i=a("h5_comm"),j=a("../ui/loading"),k=a("../ui/notification.js"),l=a("../common/mtopForAllspark.js"),m=d.View.extend({el:"#content",events:{"click .tb-feed-items li":"goToDetail","click #accountPage .J_info .stats-follow-btn":"follow","click .navbar .refresh.account":"refresh","click #accountPage .wwwIco":"goWWW"},backURL:"",afterTimestamp:"",before:!1,initialize:function(){var a=this;a._pageSize=15,a.afterTimestamp=(new Date).getTime(),a.accountModel=new g,a.accountModel.on("change:accInfo",function(a,b){if(b&&b.fail){k.message("服务异常，请稍后再试！");return}b&&e("#accountPage .J_info").html()==""&&e("#accountPage .J_info").html(f.template(e("#accountinfo_tpl").html(),b))}),a.accountModel.on("change:accFeeds",function(b,c){setTimeout(function(){e(".navbar .refresh .btn div").removeClass("spinner")},2e3);if(c&&c.fail){e("#accountPage .J_feed .tb-feed-items").html(""),k.message("服务异常，请稍后再试！");return}var d=!0;if(a.oldTotalCount&&a.oldTotalCount.snsid==a.snsid){var g=parseInt(c.totalCount)-parseInt(a.oldTotalCount.count);g>0&&a.curPage==1?k.message("更新了 "+g+" 条广播"):a.oldTotalCount.curPage==a.curPage&&(d=!1),a.oldTotalCount.count=c.totalCount,a.oldTotalCount.curPage=a.curPage}a.oldTotalCount={snsid:a.snsid,count:c.totalCount,curPage:a.curPage};var i=Math.ceil(c.totalCount/a._pageSize);i>1&&(a.pageNav=new h({id:"#feedPageNav",index:a.curPage,pageCount:i,pageSize:a._pageSize,disableHash:"true"}),a.pageNav.pContainer().on("P:switchPage",function(b,c){a.changePage(c.index)}));if(c.totalCount==0){e("#accountPage .J_feed .tb-feed-items").html(""),k.message("商家很懒还没发消息哦！");return}c.list&&c.list.length>0&&d&&(console.log("dom"),e("#accountPage .J_feed .tb-feed-items").html(f.template(e("#tbfeed_tpl").html(),a.reconFeedListData(c))),setTimeout(function(){e("#accountPage").css("height",e("#accountPage")[0].offsetHeight+"px")},100))}),a.accountModel.on("change:prices",function(a,b){if(b&&b.fail){k.message("服务异常，请稍后再试！");return}if(b&&b.prices.length>0)for(var c=0;c<b.prices.length;c++)e(".it"+b.prices[c].id).append('<div class="price">'+b.prices[c].price+"元</div>")})},render:function(a,b){var c=this;e.trim(e("#accountPage .J_feed .tb-feed-items").html()).length==0&&e("#accountPage .J_feed .tb-feed-items").html('<div class="loading"><span class="spinner"></span></div>'),c.snsid=a,c.curPage=parseInt(b),b==1&&(c.before=!1),a!=e("#accountPage").attr("snsid")&&(e("#accountPage").attr("snsid",a),e("#accountPage .J_info").html(""),e("#accountPage .J_feed .tb-feed-items").html('<div class="loading"><span class="spinner"></span></div>')),e("header.navbar").html("");if(c.oldTotalCount)if(c.oldTotalCount.snsid==c.snsid){var d=Math.ceil(c.oldTotalCount.totalCount/c._pageSize);d>1&&(c.pageNav=new h({id:"#feedPageNav",index:c.curPage,pageCount:d,pageSize:c._pageSize,disableHash:"true"}),c.pageNav.pContainer().on("P:switchPage",function(a,b){c.changePage(b.index)}))}else e("#feedPageNav").html("");var g=e("header.navbar"),i=e("#accountPage"),j={backUrl:"",backTitle:"返回"};typeof window.AccountList!="undefined"?(j={backUrl:"#"+window.AccountList.hash,backTitle:"返回"},window.AccountList.flag=!1,delete window.AccountList):c.backURL!=""?j={backUrl:c.backURL,backTitle:"返回"}:j={backUrl:"#index",backTitle:"返回"},g.html(f.template(e("#navBack_tpl").html(),j)+e("#accountTitle_tpl").html()),g.hasClass("iT")&&g.removeClass("iT").addClass("iC");var k=e(".view-page.show");e("#detailPage").hasClass("show")?(i.removeClass(" iR iL").addClass("iL"),k.removeClass("show iC").addClass("iR").wAE(function(){k.addClass("hide")})):i.hasClass("show")||k.removeClass("show iC").addClass("iL").wAE(function(){k.addClass("hide")}),i.removeClass("hide"),setTimeout(function(){i.removeClass(" iR iL").addClass("show iC")},0),window.scrollTo(0,1),c.accountModel.getPageData({snsId:c.snsid,curPage:c.curPage,pageSize:c._pageSize,afterTimestamp:c.afterTimestamp,before:c.before}),e("#content")[0].style.minHeight="360px"},refresh:function(){var a=this,b=e(".navbar .refresh .btn div");b.hasClass("spinner")||b.addClass("spinner"),a.afterTimestamp=(new Date).getTime(),a.curPage=="1"?a.accountModel.getPageData({exCludInfo:!1,snsId:a.snsid,curPage:a.curPage,before:!1,pageSize:a._pageSize,afterTimestamp:(new Date).getTime()}):window.location.hash="#account/"+a.snsid+"/1"},goWWW:function(a){var b=this,c=e(a.currentTarget);c.attr("linkUrlIsExt")=="true"?k.external(c.attr("url"),function(){window.open(c.attr("url"),"_blank")},null):c.attr("url")!=""&&(window.location.href=c.attr("url"))},goBackHome:function(){typeof window.AccountList!="undefined"?(window.AccountList.flag=!1,window.location.hash=window.AccountList.hash):window.history.back()},follow:function(a){var b=this,c=e(a.currentTarget);i.isLogin()?c.hasClass("followed")?(c.html("取消关注"),l.removeAccount(c.attr("pid"),function(a){if(a.data.result)for(var b=a.data.result.length,d=0;d<b;d++)c.attr("pid")==a.data.result[d].id&&(a.data.result[d].isSuccess=="true"?(c.html("关注"),c.removeClass("followed"),e(".stats-count").text(parseInt(e(".stats-count").text())-1)):(k.message("取消关注失败！"),c.html("取消关注")))},function(){k.message("取消关注失败！"),c.html("取消关注")})):(c.html("关注中..."),l.addAccount(c.attr("pid"),function(a){if(a.data.result)for(var b=a.data.result.length,d=0;d<b;d++)c.attr("pid")==a.data.result[d].id&&(a.data.result[d].isSuccess=="true"?(c.addClass("followed"),c.html("取消关注"),e(".stats-count").text(parseInt(e(".stats-count").text())+1)):(k.message("关注失败！"),c.html("关注")))},function(){k.message("关注失败！"),c.html("关注")})):i.goLogin("h5_allspark")},changePage:function(a){var b=this;parseInt(b.curPage)<parseInt(a)?b.before=!0:b.before=!1,e("#accountPage .J_feed .tb-feed-items").html('<div class="loading"><span class="spinner"></span></div>'),window.location.hash="#account/"+b.snsid+"/"+a,b.backURL=e(".navbar .back a").attr("href")},goToDetail:function(a){var b=e(a.currentTarget),c=this;window.location.hash="#detail/"+e(".tb-profile").attr("snsid")+"/"+b.attr("feedid")+"/"+c.curPage},reconAccInfoData:function(a){var b=a;return b},reconFeedListData:function(a){var b=this,c=a;for(var d=0;d<c.list.length;d++)c.list[d].commentCount||(c.list[d].commentCount=0);return c}});return m});
define("/mw/webapp/transformer/account/accountModel.js",["backbone","underscore","../common/mtopForAllspark.js","../common/cache.js","../common/refine.js"],function(a,b,c){var d=a("backbone"),e=a("underscore"),f=a("../common/mtopForAllspark.js"),g=a("../common/cache.js"),h=a("../common/refine.js");return d.Model.extend({_biz:{info:function(a,b){f.info(a,b)},feeds:function(a,b){a.before?f.listBefore(a,b):f.readAndListAfter(a,b),delete a.before}},getPageData:function(a){var b=this;a.exCludInfo||b._biz.info({snsId:a.snsId,sid:a.sid},function(c){h.refinePubAccount(c),b.set({accInfo:c,silent:!0}),b.trigger("change:accInfo"),g.saveAccount(a.snsId,c),b.set("loaded","1")}),a||(a={});var c=e.clone(f.pageParam);e.extend(c,a),c.isIndex()&&(c.before=!1),b._biz.feeds(c,function(a){a.totalCount&&a.list&&a.list.forEach(function(a){}),h.refineFeed(a);if(a.fail){b.set("accFeeds",a);return}a.a=(new Date).getTime(),b.set("accFeeds",a);var c=[];a.totalCount&&a.list&&a.list.forEach(function(a){a.coverTile&&a.coverTile.item&&a.coverTile.item.id&&c.push(a.coverTile.item.id)}),f.getPrices(e.uniq(c),function(a){a.length&&b.set("prices",{prices:a,t:(new Date).getTime()})}),b.set("loaded","1")})}})});
define("/mw/webapp/transformer/detail/detailView.js",["backbone","zepto","underscore","./detailModel","cdn","h5_base","uriBroker","../ui/loading","../ui/notification.js","../comment/commentModel.js"],function(a,b,c){var d=a("backbone"),e=a("zepto"),f=a("underscore"),g=a("./detailModel"),h=a("cdn"),i=a("h5_base"),j=a("uriBroker"),k=a("../ui/loading"),l=a("../ui/notification.js"),m=a("../comment/commentModel.js"),n=f.template(e("#detail_header_tpl").html()),o=f.template(e("#detail_accinfo_tpl").html()),p=f.template(e("#detail_content_tpl").html());getBetterImg=h.getBetterImg,getItemDetailUrl=j.getUrl;var q=d.View.extend({el:"#content",model:new g,events:{"click .to-comment-list":"commentList","click .more-content":"more","click #detailPage .brand":"toAccountPage"},initialize:function(){this.$container=e("#detailPage"),this.model.on("change:feed",this.renderDetail,this),this.model.on("change:accInfo",this.renderAccInfo,this),this.model.on("change:prices",this.renderPrices,this),i.isClient()||(this.commentModel=new m,this.commentModel.on("change:commentCount",this.renderComentCount,this))},goDetail:function(a,b,c){this.$container.find(".main").empty(),(!i.isClient()||i.isAndroidClient())&&this.$container.find(".main").html('<div class="loading"><span class="spinner"></span></div>');var d=this;d.snsId=a,d.feedId=b,d.page=c,window.scrollTo(0,1);var f=e("header.navbar"),g=e("#detailPage");f.html(n({href:"#account/"+this.snsId+"/"+this.page})),this.commentModel&&this.commentModel.get("commentCount")&&this.commentModel.trigger("change:commentCount"),f.hasClass("iT")&&f.removeClass("iT").addClass("iC");var h=e(".view-page.show");h.length==0&&g.removeClass(" iR iL");var j=e("#commentListPage");j.hasClass("show")?(g.removeClass(" iR iL").addClass("iL"),h.removeClass("show iC").addClass("iR").wAE(function(){h.addClass("hide")})):h.attr("id")!="detailPage"&&h.removeClass("show iC").addClass("iL").wAE(function(){h.addClass("hide")}),g.removeClass("hide"),setTimeout(function(){g.removeClass(" iR iL").addClass("show iC")},0),d.model.getPageData({snsId:a,feedId:b}),this.commentModel&&this.commentModel.getCommentCount({snsId:a,feedId:b})},renderAccInfo:function(){var a=e.extend(this.model.get("accInfo"),{snsId:this.snsId}),b=o(a),c=this.$container.find(".account .follow");if(c.length>0)if(c.attr("snsid")==this.snsId)if(parseInt(a.fansCount)==0)c.html("还没有人关注");else{var d='<span class="count">'+a.fansCount+"</span> 关注者";e.trim(c.html())!=d&&c.html(d)}else this.$container.find(".account").html(b);else this.$container.find(".account").html(b)},renderDetail:function(){var a=this,b=this.model.get("feed");!!i.isClient()&&!i.isAndroidClient();if(b&&b.fail){this.model.set("feed",{},{silent:!0}),l.message("请稍后重试"),this.$container.find(".main").html("加载失败，稍后重试！");return}e("#content")[0].style.minHeight="360px";var c=p(b);this.$container.find(".main").html(c)},renderComentCount:function(){var a=this.commentModel.get("commentCount").count;a>99&&(a="99+"),e(".comment .btn span").text(a)},more:function(a){a.preventDefault();var b=this.model.get("feed"),c=b.linkUrl,d=b.linkUrlIsExt;if(i.isClient()){window.location=c;return}d=="true"?l.external(c,function(){window.open(c,"_blank")}):window.location=c},toAccountPage:function(a){i.isClient()&&(a.preventDefault(),location.href=location.protocol+"//"+location.hostname+location.pathname+"#account/"+this.snsId+"/"+this.page)},renderPrices:function(){var a=this.$container.find(".media .item"),b=this.model.get("prices");for(var c=0;c<a.length;c++){var d=a.eq(c),e=d.attr("data-id");for(var f=0;f<b.length;f++)if(e==b[f].id){d.find(".price").text(b[f].price+"元").show();break}}},commentList:function(){location.hash="comment/"+this.snsId+"/"+this.feedId+"/1"}});return q});
define("/mw/webapp/transformer/detail/detailModel.js",["backbone","underscore","../common/mtopForAllspark.js","../common/cache.js","h5_comm","../common/refine.js"],function(a,b,c){var d=a("backbone"),e=a("underscore"),f=a("../common/mtopForAllspark.js"),g=a("../common/cache.js"),h=a("h5_comm"),i=a("../common/refine.js");return d.Model.extend({linkUrlFormat:function(a){if(a&&a.indexOf("detail.tmall.com")!=-1){var b=a.match(/id=[\d]+/);b=b&&b[0].split("=");if(b&&b.length>1)return"http://a.m.tmall.com/i"+b[1]+".htm"}return a},getPageData:function(a){function c(a){var c=[];a.tiles&&a.tiles.forEach(function(a){a.item&&c.push(a.item.id)}),f.getPrices(e.uniq(c),function(a){a.length&&b.set({prices:a},{silent:!0}),b.trigger("change:prices")})}var b=this,d=g.getAccountById(a.snsId);d?(b.set("accInfo",d),b.trigger("change:accInfo")):f.info({snsId:a.snsId},function(c){i.refinePubAccount(c),b.set("accInfo",c),g.saveAccount(a.snsId,c)});var h=g.getItemById(a.snsId+"_"+a.feedId);if(h&&h.tiles&&h.tiles.length>0){b.set("feed",h),b.trigger("change:feed"),c(h,a);return}f.detail(a||{},function(d){i.refineDetail(d),b.set("feed",d),d.linkUrl=b.linkUrlFormat(d.linkUrl),d&&d.tiles&&d.tiles.length>0&&(g.saveItem(a.snsId+"_"+a.feedId,d),c(d,a))})}})});
define("/mw/webapp/transformer/comment/commentModel.js",["backbone","zepto","underscore","../common/mtopForAllspark.js","h5_comm"],function(a,b,c){var d=a("backbone"),e=a("zepto"),f=a("underscore"),g=a("../common/mtopForAllspark.js"),h=a("h5_comm");return d.Model.extend({getPageData:function(a){var b=this;g.commentList(a,function(a){b.set("commentList",a)})},getCommentCount:function(a){var b=this;g.commentCount(a,function(a){b.set("commentCount",a)})},addComment:function(a,b){var c=this;h.isLogin()?(c.set("loginStatus",!0),g.addComment(a,function(a){b&&b(!0,a.fail&&a.fail.split("::")[1])},function(){b&&b(!1)})):c.set("loginStatus",!1)}})});
define("/mw/webapp/transformer/accountList/accountListView.js",["backbone","zepto","underscore","./accountListModel","h5_comm","../../../../base/styles/component/pagenav/js/pagenav.js","../ui/notification.js","../ui/loading","../common/mtopForAllspark.js"],function(a,b,c){var d=a("backbone"),e=a("zepto"),f=a("underscore"),g=a("./accountListModel"),h=a("h5_comm"),i=a("../../../../base/styles/component/pagenav/js/pagenav.js"),j=a("../ui/notification.js"),k=a("../ui/loading"),l=a("../common/mtopForAllspark.js"),m=d.View.extend({el:"#content",events:{"click .tab-bar li":"changeTab","click #accountListPage .person-list li .content":"goToAccount","click #accountListPage .followbtn":"follow"},initialize:function(){var a=this;a.pageSize=15,a.accountListModel=new g,a.accountListModel.on("change:myAttention",function(b,c){if(c&&c.fail){e("#accountListPage .person-list").html(""),j.message("服务异常，请稍后再试！");return}var d=Math.ceil(c.totalCount/a.pageSize);d<a.curPage&&a.changePage(d),c.list&&c.list.length>0?(e("#accountListPage .person-list").html(f.template(e("#myList_tpl").html(),c)),d>1&&(a.myPageNav=new i({id:"#accountListPageNav",index:a.curPage,pageCount:d,pageSize:a.pageSize,disableHash:"true"}),a.myPageNav.pContainer().on("P:switchPage",function(b,c){a.changePage(c.index)}))):e("#accountListPage .person-list").html('<div class="empty">还没有关注任何帐号哦</div>')}),a.accountListModel.on("change:recommends",function(b,c){if(c&&c.fail){e("#accountListPage .person-list").html(""),j.message("服务异常，请稍后再试！");return}var d=Math.ceil(c.totalCount/a.pageSize);d<a.curPage&&a.changePage(d),c.list&&c.list.length>0?(e("#accountListPage .person-list").html(f.template(e("#personList_tpl").html(),c)),e("#accountListPageNav").html(""),d>1&&(a.recPageNav=new i({id:"#accountListPageNav",index:a.curPage,pageCount:d,pagesize:a.pageSize,disableHash:"true"}),a.recPageNav.pContainer().on("P:switchPage",function(b,c){a.changePage(c.index)}))):e("#accountListPage .person-list").html('<div class="empty">您已经关注所有帐号了</div>')}),a.accountListModel.on("change:loaded",function(a,b){k.hide(),a.set("loaded","0")})},render:function(a,b){var c=this;k.show(),c.status=a,c.curPage=parseInt(b),e(".navbar .back").unbind("click");var d=e("header.navbar");d.html(f.template(e("#navBack_tpl").html(),{backUrl:"#index",backTitle:"微淘"})+e("#accountListTabBar_tpl").html()),window.scrollTo(0,1),e(".tab-bar li.cur").removeClass("cur"),e(".tab-bar li").eq(c.status-1).addClass("cur"),e("#accountListPage .person-list").html('<div class="loading"><span class="spinner"></span></div>'),e("#accountListPageNav").html(""),c.accountListModel.getPageData({type:c.status,curPage:c.curPage,pageSize:c.pageSize,order:"lastFeedTime"}),d.hasClass("iT")&&d.removeClass("iT").addClass("iC");var g=e(".view-page.show"),h=e("#accountListPage"),i=e("#indexPage");h.hasClass("show")||g.removeClass("show iC").addClass("iL").wAE(function(){g.addClass("hide")}),h.removeClass("hide"),setTimeout(function(){h.removeClass("iR iL").addClass("show iC")},0)},changePage:function(a){var b=this;e("#accountListPage .person-list").html('<div class="loading"><span class="spinner"></span></div>'),window.location.hash="#accountList/"+b.status+"/"+a},goToAccount:function(a){var b=this;a.stopPropagation();var c=e(a.currentTarget);window.AccountList={hash:"#accountList/"+b.status+"/"+b.curPage,flag:!0},window.location.hash="#account/"+c.attr("snsid")+"/1"},follow:function(a){a.stopPropagation();var b=this,c=e(a.currentTarget),d=c.parent().find(".follows span");h.isLogin()?c.hasClass("followed")||(c.html("关注中..."),c.addClass("min"),l.addAccount(c.attr("pid"),function(a){if(a.data.result)for(var b=a.data.result.length,e=0;e<b;e++)c.attr("pid")==a.data.result[e].id&&(a.data.result[e].isSuccess=="true"?(c.addClass("followed"),c.html("已关注"),c.removeClass("min"),d.text(parseInt(d.text())+1)):(j.message("关注失败！"),c.removeClass("min"),c.html("关注")))},function(){j.message("关注失败！"),c.html("关注"),c.removeClass("min")})):h.goLogin("h5_allspark")},goBack:function(){window.location.hash="index/"},changeTab:function(a){var b=this,c=e(a.currentTarget);e(".tab-bar li.cur").removeClass("cur"),c.addClass("cur"),b.status==1?window.location.hash="accountList/2/1":window.location.hash="accountList/1/1"}});return m});
define("/mw/webapp/transformer/accountList/accountListModel.js",["backbone","zepto","underscore","../common/mtopForAllspark.js","h5_comm","h5_cache","cookie","../common/refine.js"],function(a,b,c){var d=a("backbone"),e=a("zepto"),f=a("underscore"),g=a("../common/mtopForAllspark.js"),h=a("h5_comm"),i=a("h5_cache"),j=a("cookie"),k=a("../common/refine.js");return d.Model.extend({getPageData:function(a){var b=this;a||(a={});var c=a.type||1,d=f.clone(g.pageParam);f.extend(d,a),delete d.type,2==c?g.my(d,function(a){a.a=(new Date).getTime(),k.refineRecommend(a),b.set("myAttention",a),b.set("loaded","1")}):g.recommends(d,function(a){a.a=(new Date).getTime(),k.refineRecommend(a),b.set("recommends",a),b.set("loaded","1")})}})});
define("/mw/webapp/transformer/comment/commentListView.js",["backbone","zepto","underscore","h5_comm","../ui/loading","../../../../base/styles/component/pagenav/js/pagenav.js","../ui/notification.js","./commentModel"],function(a,b,c){var d=a("backbone"),e=a("zepto"),f=a("underscore"),g=a("h5_comm"),h=a("../ui/loading"),i=a("../../../../base/styles/component/pagenav/js/pagenav.js"),j=a("../ui/notification.js"),k=f.template(e("#comment_list_tpl").html()),l=f.template(e("#comment_list_header_tpl").html()),m=a("./commentModel"),n=d.View.extend({el:"#content",model:new m,events:{"click .write-comment":"newComment"},initialize:function(){this.pageSize=10,this.$container=e("#commentListPage"),this.model.on("change:commentList",this.renderCommentList,this)},goComment:function(a,b,c){this.$container.html('<div class="loading"><span class="spinner"></span></div>'),this.snsId=a,this.feedId=b,this.page=parseInt(c);var d=e("header.navbar"),f=e("#commentListPage");e("header.navbar").html(l({href:"#detail/"+this.snsId+"/"+this.feedId+"/"+this.page})),window.scrollTo(0,1),d.hasClass("iT")&&d.removeClass("iT").addClass("iC");var g=e(".view-page.show"),h=e("#newCommentPage");h.hasClass("show")?(f.removeClass(" iR iL").addClass("iL"),g.removeClass("show iC").addClass("iR").wAE(function(){g.addClass("hide")})):f.hasClass("show")||g.removeClass("show iC").addClass("iL").wAE(function(){g.addClass("hide")}),f.removeClass("hide"),setTimeout(function(){f.removeClass("iR iL").addClass("show iC")},0),this.model.getPageData({snsId:this.snsId,feedId:this.feedId,curPage:this.page,pageSize:this.pageSize})},renderCommentList:function(){var a=this,b=this.model.get("commentList");if(b&&b.fail){j.message("请稍后重试"),this.$container.html("加载失败，稍后重试！");return}if(b.totalCount==0)this.$container.html('<p class="no-comment">还没有评论，快抢沙发吧。</p>');else{var c=k(this.model.get("commentList"));this.$container.html(c);var d=Math.ceil(b.totalCount/this.pageSize);d>1&&(this.pageNav=new i({id:"#commentListPageNav",index:this.page,pageCount:d,pageSize:this.pageSize,disableHash:"true"}),this.pageNav.pContainer().on("P:switchPage",function(b,c){a.changePage(c.index)}))}},changePage:function(a){this.$container.html('<div class="loading"><span class="spinner"></span></div>'),location.hash="#comment/"+this.snsId+"/"+this.feedId+"/"+a},newComment:function(){g.isLogin()?location.hash="newComment/"+this.snsId+"/"+this.feedId+"/"+this.page:g.goLogin("h5_allspark")}});return n});
define("/mw/webapp/transformer/comment/newCommentView.js",["backbone","zepto","underscore","h5_comm","../ui/notification.js","./commentModel"],function(a,b,c){var d=a("backbone"),e=a("zepto"),f=a("underscore"),g=a("h5_comm"),h=a("../ui/notification.js"),i=a("./commentModel"),j=f.template(e("#newComment_header_tpl").html()),k=f.template(e("#newComment_input_tpl").html()),l=d.View.extend({el:"#content",model:new i,events:{"keyup #comment-area":"typing","click .publish-comment":"publish"},initialize:function(){this.$container=e("#newCommentPage"),this.$container.html(k({})),this.$commentArea=e("#comment-area"),this.$charCount=this.$container.find(".char-count")},goNewComment:function(a,b,c){this.snsId=a,this.feedId=b,this.curPage=c;var d=e("header.navbar");d.html(j({href:"#comment/"+this.snsId+"/"+this.feedId+"/"+this.curPage})),window.scrollTo(0,1),d.hasClass("iT")&&d.removeClass("iT").addClass("iC");var f=e(".view-page.show"),g=e("#newCommentPage"),h=e("#commentListPage");f.removeClass("show iC").addClass("iL").wAE(function(){f.addClass("hide")}),g.removeClass("hide"),setTimeout(function(){g.removeClass(" iR iL").addClass("show iC")},0),e(".view-page.show").removeClass("show iC").addClass("iL"),e("#newCommentPage").removeClass("iL").addClass("show iC")},back:function(a){location.hash="#comment/"+this.snsId+"/"+this.feedId+"/"+(a||this.curPage)},focus:function(){e(".navbar").hide()},blur:function(){e(".navbar").show(),window.scroll(0,1)},typing:function(){var a=this.$commentArea.val().length;this.$charCount.text(a),a?this.$charCount.addClass("typing"):this.$charCount.removeClass("typing"),a>140&&this.$commentArea.val(this.$commentArea.val().substr(0,140));var b=this;setTimeout(function(){b.typing()},200)},publish:function(){if(!g.isLogin()){g.goLogin("h5_allspark");return}var a=this,b=this.$commentArea.val();if(b.length==0){h.message("写点什么吧 ^_^");return}b.length<=140&&(this.model.addComment({snsId:this.snsId,feedId:this.feedId,content:b},function(b,c){if(b){if(c){h.message(c);return}h.message("发布成功！"),a.$commentArea.val(""),setTimeout(function(){a.back(1)},1500)}else h.message("发布失败，请重试")}),h.message("发布中，请稍候...",!0))}});return l});
define("/mw/webapp/transformer/common/background.js",["./log.js","backbone","h5_comm"],function(a,b,c){function i(a,b){f.push({hash:a,hisLen:++h,orignHash:b?b:location.hash,isFromBack:function(){return h-this.hisLen!=1}})}function j(a){if(f.length>1){var b=f[f.length-2];b.isFromBack()||d.logEnter(a,k()?"login":"")}else d.logEnter(a,k()?"login":"")}function k(){return g.isLogin()&&1==h&&document.referrer&&0==document.referrer.indexOf("http://login")}var d=a("./log.js"),e=a("backbone"),f=[],g=a("h5_comm"),h=-1;i("index","#index"),b.enter=function(a){var b=[],c=0;while(c<f.length){if(f[c].hash==a)break;b.push(f[c]),c++}f=b,i(a),j&&j(a)};var l=e.View.extend({el:"#content",events:{"click header .back":function(a){if(f.length>0&&"index"==f[f.length-1].hash)return!0;var b=null;return f.length>1&&(b=f[f.length-2]),window.location.href=b&&b.orignHash?b.orignHash:"#index",!1},"click .log[data-log]":function(a,b){var c=f.length?f[f.length-1].hash:"",e=$(a.currentTarget),h=e.data("log");h&&(!g.isLogin()&&(h=="addaccount"||h=="attention"||h=="addcomment")&&d.logToLogin(h,c),"attention"==h&&"account"==c&&e.hasClass("followed")&&(h="cancelattention"),d.logClick(h,c))}}});b.backgroundView=new l});
define("/mw/webapp/transformer/common/log.js",["aplus"],function(a,b,c){var d=a("aplus"),e={enter:2001,click:2101,data:{index:"_index",login:"_login",accountList:"_accountlist",account:"_account",detail:"_detail",comment:"_commentlist"},uri:{index:"_index",login:"_login"}};b.logEnter=function(a,b){var a=e.data[a];if(a){var c={aplus:!0};c.apdata="allspark"+a+"_"+e.enter,e.uri[b]&&(c.apuri="allspark"+e.uri[b]);try{d.ajax(c)}catch(f){console.log(f)}}},b.logClick=function(a,b){if(a){var c={aplus:!0};c.apdata="allspark_"+a+"_"+e.click,e.data[b]&&(c.apuri="allspark"+e.data[b]),d.ajax(c)}},b.logToLogin=function(){}});
(function(a){if(typeof window["define"]=="undefined"){var b={},c=b.exports={};result=a(null,c,b)||b.exports}else define("/base/modules/aplus/aplus.js",["zepto"],a)})(function(a,b,c){function j(){return f.href.toString()}function k(){return""}function l(){return e.cookie.match(i)}function m(a){var b=e.createElement("a");return b.href=a,b}var d=window,e=d.document,f=d.location,g=a?a("zepto"):d.Zepto||d.$,h="http://log.m.taobao.com/js.do",i=/(?:^|\s)cna=([^;]+)(?:;|$)/;return g.orginAjax=g.ajax,g.ajax=function(a){function p(){o&&o.apply(this,arguments);if(m===!0||m===1)b=j(),c=l(),d=k(),e=a.apdata,f=a.apuri,b&&(n.ap_ref=b),c&&(n.ap_cna=c[1]),e&&(n.ap_data=e),f&&(n.ap_uri=f),d&&(n.ap_ip=d),i={url:h,data:n,type:"GET",dataType:"jsonp"},m!==2&&g.orginAjax(i)}var b,c,d,e,f,i,m=a.aplus!=null?a.aplus:g.ajaxSettings.aplus||!1,n={_aplus:"1"},o=a.complete;a.url?(a.complete=p,g.orginAjax(a)):p()},g});