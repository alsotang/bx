function timestamps(e){typeof e=="string"&&(e=parseInt(e));var t=1e3,n=t*60,r=n*60,i=r*24,s=null,o=new Date,u=o.getTime(),a="";typeof e=="number"?s=e:typeof e=="object"&&e.getTime&&(s=e.getTime());if(s!=NaN){var f=new Date;f.setTime(s)}var l=f.getMinutes();return l<10&&(l="0"+l),s==NaN?a="-":s>u?a="刚刚":s>u-t*10?a="刚刚":s>u-n?a=parseInt((u-s)/t/10).toString()+"0秒前":s>u-r?a=parseInt((u-s)/n)+"分钟前":f.getYear()==o.getYear()&&f.getMonth()==o.getMonth()&&f.getDate()==o.getDate()?a="今天"+f.getHours()+":"+l:f.getYear()==o.getYear()&&f.getMonth()==o.getMonth()&&o.getDate()-f.getDate()==1?a="昨天"+f.getHours()+":"+l:f.getYear()==o.getYear()?a=f.getMonth()+1+"月"+f.getDate()+"日 "+f.getHours()+":"+l:a=f.getFullYear()+"年"+(f.getMonth()+1)+"月"+f.getDate()+"日 "+f.getHours()+":"+l,a}function numToBinary(e){var t="",n=e,r;do r=n%2,t=r+t,n=Math.floor(n/2);while(n!=0);return t}function noHelper(e){var t=numToBinary(e),n=!1;return t="0000"+t,t.substring(t.length-4,t.length-3)!="1"}function isLongImg(e){return e&&parseFloat(e.picWidth)/parseFloat(e.picHeight)>1.45}function isSquareImg(e){return e&&parseFloat(e.picWidth)/parseFloat(e.picHeight)<=1.45}function setOrientation(){var e;if(window.orientation)e=Math.abs(window.orientation)===90?"landscape":"portrait";else if(window.screen){var t=screen.width,n=screen.height;e=t>n?"landscape":"portrait"}else e="unknow";return e}function feedImageSizeStyle(e,t){var n=parseInt(e),r=parseInt(t),i;i=window.innerWidth-30,setOrientation()=="portrait"?i=window.innerWidth-30:i=(window.innerWidth>window.innerHeight?window.innerWidth:window.innerHeight)-30;var s=0;n<r?n<i?(s=i/n*r,s>i&&(s=i)):s=i:n<i?s=i/n*r:s=r/(n/i);if(!Env.isDesktop)return s?"width: "+i+"px; "+"height: "+s+"px;":"width: 100%"}function detailImageSizeStyle(e,t){var n=parseInt(e),r=parseInt(t),i=window.innerWidth-30,s=0;n<i?s=i/n*r:s=r/(n/i);if(!Env.isDesktop)return s?"width: "+i+"px; "+"height: "+s+"px;":"width: 100%"}function formatFans(e){typeof e=="string"&&(e=parseInt(e));if(e>99999999)return e=e.toString(),e.substr(0,e.length-8)+"亿";if(e>999999)return e=e.toString(),e.substr(0,e.length-4)+"万";if(e>9999){e=e.toString();var t=e.charAt(e.length-4);return e.substr(0,e.length-4)+(t=="0"?"":"."+t)+"万"}return e.toString()}seajs.config({alias:{backbone:"http://a.tbcdn.cn/mw/base/libs/backbone/0.9.2/backbone",underscore:"http://a.tbcdn.cn/mw/base/libs/underscore/1.3.3/underscore",zepto:"http://a.tbcdn.cn/mw/base/libs/zepto/1.0.0/zepto",mustache:"http://a.tbcdn.cn/mw/base/libs/mustache/0.5.0/mustache",linkfocus:"../../../../base/modules/linkfocus/linkfocus",lazyload:"../../../../base/modules/lazyload/js/lazyload",uriBroker:"../../../../base/utils/server/uriBroker",h5_mtop:"../../../../base/utils/server/mtop_h5api",h5_events:"../../../../base/utils/server/h5_events",h5_comm:"../../../../base/utils/server/h5_common",h5_base:"../../../../base/utils/server/h5_base",h5_utils:"../../../../base/utils/server/h5_utils",h5_cache:"../../../../base/utils/server/h5_cache",h5_token:"../../../../base/utils/server/h5_token",cookie:"../../../../base/utils/server/cookie",cdn:"../../../../base/utils/server/cdn",aplus:"../../../../base/modules/aplus/aplus",dpi:"../../../../base/modules/imgtrim/dpi",imgtrim:"../../../../base/modules/imgtrim/trim"},debug:1});var G_PersonCollection;define("/mw/webapp/transformer/js/allspark.js",["./router"],function(e,t){e("./router").start()});
define("/mw/webapp/transformer/js/router.js",["zepto","underscore","../common/global","h5_base","backbone","../index/indexView","../account/accountView","../detail/detailView","../accountList/accountListView","../search/personCollection","../search/accountManageView","../search/searchResultView","../search/recommendView","../comment/commentListView","../comment/newCommentView","../comment/recCommentView","../favorite/favoriteView","./../common/background.js","cdn","dpi","imgtrim","./../common/log.js","../common/mtopForAllspark.js","lazyload"],function(e,t,n){var r=e("zepto"),i=e("underscore"),s=e("../common/global"),o=e("h5_base"),u=e("backbone"),a=e("../index/indexView"),f=e("../account/accountView"),l=e("../detail/detailView"),c=e("../accountList/accountListView"),h=e("../search/personCollection"),p=e("../search/accountManageView"),d=e("../search/searchResultView"),v=e("../search/recommendView"),m=e("../comment/commentListView"),g=e("../comment/newCommentView"),y=e("../comment/recCommentView"),b=e("../favorite/favoriteView"),w=e("./../common/background.js"),E=e("cdn"),S=e("dpi"),x=e("imgtrim"),T=e("./../common/log.js"),N=e("../common/mtopForAllspark.js"),C,k,L,A,O,M,_,D,P,H,B;window.lazyload=e("lazyload"),window.lazyload.init({lazyHeight:300}),window.lazyload.reload=function(){window.lazyload.img.trigger()};var j=u.Router.extend({routes:{},initialize:function(){window.globalCDN=x,/i(Phone|P(o|a)d)/.test(navigator.userAgent)&&(r("body").hasClass("ios")||r("body").addClass("ios")),o.get("hdButton")!=null?(x.setRatio(parseInt(o.get("hdButton"))),o.get("hdButton")>1?r(".hdButton").html("<span>切换到流畅模式</span>"):r(".hdButton").html("<span>切换到高清模式</span>")):S.get()>1&&(o.set("hdButton",2),r(".hdButton").html("<span>切换到流畅模式</span>")),resizeImg=x.trim,getBetterImg=function(e,t,n,r){return x.trim({url:e,expWidth:t,rWidth:n,isXz:r}).url},getImgUrl=function(e,t,n,r){window.devicePixelRatio<=1&&(t=n);var i=t+(r?"xz":""),e=e+"_"+i+"x"+t+".jpg";return E.getOriginalImg(e)},window.MH5slogan&&window.MH5slogan.hideFunc&&window.MH5slogan.hideFunc(),N.autoCreate();var e=this;e.route("","index",e.filter),e.route(/^(index)\/?(\d*)?$/,"index",e.filter),e.route(/^(fav)\/?(\d*)?$/,"fav",e.filter),e.route(/^(account)\/(\d*)\/?(\d*)?$/,"account",e.filter),e.route(/^(detail)\/(\d*)\/(\d*)\/?(\d*)?(.*)?$/,"detail",e.filter),e.route(/^(comment)\/(\d*)\/(\d*)\/?(\d*)?$/,"commentList",e.filter),e.route(/^(accountList)\/?(\d*)?\/?(\d*)?$/,"accountList",e.filter),e.route(/^(newComment)\/(\d*)\/(\d*)\/?(\d*)?$/,"newComment",e.filter),e.route(/^(recComment)\/?(\d*)?$/,"recComment",e.filter),e.route(/^(recommendAccount)\/(\d*)\/?p(\d*)?$/,"recommend",e.filter),e.route(/^(accountManage)\/?p(\d*)?$/,"accountManage",e.filter),e.route(/^(search)\/(.*)\/p(\d*)?$/,"search",e.filter),s.init()},filter:function(e,t,n,r){var i=this;e=e||"index";switch(e){case"index":C=C||new a,i.index(t);break;case"fav":H=H||new b,i.fav(t);break;case"account":k=k||new f,i.account(t,n);break;case"detail":M=M||new l,i.detail(t,n,r);break;case"comment":D=D||new m,i.commentList(t,n,r);break;case"accountList":_=_||new c,i.accountList(t,n);break;case"newComment":P=P||new g,i.newComment(t,n,r);break;case"recComment":B=B||new y,i.recComment(t);break;case"accountManage":A=A||new p,i.accountManage(t);break;case"search":O=O||new d,i.search(t,n);break;case"recommendAccount":L=L||new v,i.recommedAccount(t,n);break;default:C=C||new a,i.index(t)}},index:function(e){e=e||1,C.render(e);var t="onorientationchange"in window,n=t?"orientationchange":"resize";r(window).unbind(n).bind(n,function(){var e=r("#indexPage .feed-item .js_feed img");for(var t=0,n=e.length;t<n;t++)e.eq(t).parent().hasClass("feed-box")||e.eq(t).attr("style",feedImageSizeStyle(parseInt(e.eq(t).attr("picWidth")),parseInt(e.eq(t).attr("picHeight"))))})},fav:function(e){e=e||1,H.render(e)},account:function(e,t){t=t||1,k.render(e,t);var n="onorientationchange"in window,i=n?"orientationchange":"resize";r(window).unbind(i).bind(i,function(){r(".navbar").css("width",window.innerWidth);var e=r("#accountPage .J_feed .tb-feed-items .media img");for(var t=0,n=e.length;t<n;t++)e.eq(t).attr("style",feedImageSizeStyle(parseInt(e.eq(t).attr("picWidth")),parseInt(e.eq(t).attr("picHeight"))))})},accountList:function(e,t){e=e||1,t=t||1,_.render(e,t)},detail:function(e,t,n){n=n||1,window.scrollTo(0,0),M.goDetail(e,t,n);var i="onorientationchange"in window,s=i?"orientationchange":"resize";r(window).unbind(s).bind(s,function(){var e=r("#detailPage .media img");for(var t=0,n=e.length;t<n;t++)e.eq(t).attr("style",feedImageSizeStyle(parseInt(e.eq(t).attr("picWidth")),parseInt(e.eq(t).attr("picHeight"))))})},commentList:function(e,t,n){n=n||D.page||1,D.goComment(e,t,n)},newComment:function(e,t,n){n=n||1,P.goNewComment(e,t,n)},recComment:function(e){e=e||1,B.goRecComment(e)},accountManage:function(e){console.log("route accountManage"),e=e||1,A.queryMyList(e)},search:function(e,t){t=t||1,O.search(e,t)},recommedAccount:function(e,t){t=t||1,L.queryRecommendList(e,t)},start:function(){u.history.start()}});return App=window.App||new j,App});
define("/mw/webapp/transformer/common/global.js",["zepto","h5_utils","h5_base","dpi","imgtrim","h5_base","./../common/log.js","cdn","cookie"],function(e){var t=e("zepto"),n=e("h5_utils"),r=e("h5_base"),i=e("dpi"),s=e("imgtrim"),o=e("h5_base"),u=e("./../common/log.js"),a=e("cdn"),f=e("cookie");Env={isDesktop:!1};var l=/(\bwindows\b|\bmacintosh\b|\blinux\b|\bunix\b)/;return changeHash=function(e,t){if(window.location.hash==e)return!1;u&&u.logEnter(e,t),window.location.hash=e},n.wrapColsure({init:function(){r.isClient()?(t("header.navbar").hide(),t("body").addClass("webview")):(t("header.navbar").show(),t("body").removeClass("webview")),this.hashCheck()},hashCheck:function(){var e=location.hash,t=e.split("/")[0],n=["#fav","#account","#detail","#comment","#newComment","#recComment","#accountList","#accountManage","#recommendAccount","#search"];e&&e!="#index"&&n.indexOf(t)==-1&&(location.hash="#index")}})});
define("/base/utils/server/h5_utils.js",["underscore","zepto"],function(e,t,n){var r=e("underscore"),i=e("zepto");t.isBlank=function(e){return e==null||typeof e=="undefined"||i.trim(e)==""?!0:!1},t.wrapColsure=function(e){return i.each(e,function(t){typeof e[t]=="function"&&(e[t]=r.bind(e[t],e))}),e},t.MD5=function(e){function t(e,t){return e<<t|e>>>32-t}function n(e,t){var n,r,i,s,o;return i=e&2147483648,s=t&2147483648,n=e&1073741824,r=t&1073741824,o=(e&1073741823)+(t&1073741823),n&r?o^2147483648^i^s:n|r?o&1073741824?o^3221225472^i^s:o^1073741824^i^s:o^i^s}function r(e,t,n){return e&t|~e&n}function i(e,t,n){return e&n|t&~n}function s(e,t,n){return e^t^n}function o(e,t,n){return t^(e|~n)}function u(e,i,s,o,u,a,f){return e=n(e,n(n(r(i,s,o),u),f)),n(t(e,a),i)}function a(e,r,s,o,u,a,f){return e=n(e,n(n(i(r,s,o),u),f)),n(t(e,a),r)}function f(e,r,i,o,u,a,f){return e=n(e,n(n(s(r,i,o),u),f)),n(t(e,a),r)}function l(e,r,i,s,u,a,f){return e=n(e,n(n(o(r,i,s),u),f)),n(t(e,a),r)}function c(e){var t,n=e.length,r=n+8,i=(r-r%64)/64,s=(i+1)*16,o=Array(s-1),u=0,a=0;while(a<n)t=(a-a%4)/4,u=a%4*8,o[t]=o[t]|e.charCodeAt(a)<<u,a++;return t=(a-a%4)/4,u=a%4*8,o[t]=o[t]|128<<u,o[s-2]=n<<3,o[s-1]=n>>>29,o}function h(e){var t="",n="",r,i;for(i=0;i<=3;i++)r=e>>>i*8&255,n="0"+r.toString(16),t+=n.substr(n.length-2,2);return t}function p(e){e=e.replace(/\r\n/g,"\n");var t="";for(var n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t+=String.fromCharCode(r):r>127&&r<2048?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(r&63|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(r&63|128))}return t}var d=Array(),v,m,g,y,b,w,E,S,x,T=7,N=12,C=17,k=22,L=5,A=9,O=14,M=20,_=4,D=11,P=16,H=23,B=6,j=10,F=15,I=21;e=p(e),d=c(e),w=1732584193,E=4023233417,S=2562383102,x=271733878;for(v=0;v<d.length;v+=16)m=w,g=E,y=S,b=x,w=u(w,E,S,x,d[v+0],T,3614090360),x=u(x,w,E,S,d[v+1],N,3905402710),S=u(S,x,w,E,d[v+2],C,606105819),E=u(E,S,x,w,d[v+3],k,3250441966),w=u(w,E,S,x,d[v+4],T,4118548399),x=u(x,w,E,S,d[v+5],N,1200080426),S=u(S,x,w,E,d[v+6],C,2821735955),E=u(E,S,x,w,d[v+7],k,4249261313),w=u(w,E,S,x,d[v+8],T,1770035416),x=u(x,w,E,S,d[v+9],N,2336552879),S=u(S,x,w,E,d[v+10],C,4294925233),E=u(E,S,x,w,d[v+11],k,2304563134),w=u(w,E,S,x,d[v+12],T,1804603682),x=u(x,w,E,S,d[v+13],N,4254626195),S=u(S,x,w,E,d[v+14],C,2792965006),E=u(E,S,x,w,d[v+15],k,1236535329),w=a(w,E,S,x,d[v+1],L,4129170786),x=a(x,w,E,S,d[v+6],A,3225465664),S=a(S,x,w,E,d[v+11],O,643717713),E=a(E,S,x,w,d[v+0],M,3921069994),w=a(w,E,S,x,d[v+5],L,3593408605),x=a(x,w,E,S,d[v+10],A,38016083),S=a(S,x,w,E,d[v+15],O,3634488961),E=a(E,S,x,w,d[v+4],M,3889429448),w=a(w,E,S,x,d[v+9],L,568446438),x=a(x,w,E,S,d[v+14],A,3275163606),S=a(S,x,w,E,d[v+3],O,4107603335),E=a(E,S,x,w,d[v+8],M,1163531501),w=a(w,E,S,x,d[v+13],L,2850285829),x=a(x,w,E,S,d[v+2],A,4243563512),S=a(S,x,w,E,d[v+7],O,1735328473),E=a(E,S,x,w,d[v+12],M,2368359562),w=f(w,E,S,x,d[v+5],_,4294588738),x=f(x,w,E,S,d[v+8],D,2272392833),S=f(S,x,w,E,d[v+11],P,1839030562),E=f(E,S,x,w,d[v+14],H,4259657740),w=f(w,E,S,x,d[v+1],_,2763975236),x=f(x,w,E,S,d[v+4],D,1272893353),S=f(S,x,w,E,d[v+7],P,4139469664),E=f(E,S,x,w,d[v+10],H,3200236656),w=f(w,E,S,x,d[v+13],_,681279174),x=f(x,w,E,S,d[v+0],D,3936430074),S=f(S,x,w,E,d[v+3],P,3572445317),E=f(E,S,x,w,d[v+6],H,76029189),w=f(w,E,S,x,d[v+9],_,3654602809),x=f(x,w,E,S,d[v+12],D,3873151461),S=f(S,x,w,E,d[v+15],P,530742520),E=f(E,S,x,w,d[v+2],H,3299628645),w=l(w,E,S,x,d[v+0],B,4096336452),x=l(x,w,E,S,d[v+7],j,1126891415),S=l(S,x,w,E,d[v+14],F,2878612391),E=l(E,S,x,w,d[v+5],I,4237533241),w=l(w,E,S,x,d[v+12],B,1700485571),x=l(x,w,E,S,d[v+3],j,2399980690),S=l(S,x,w,E,d[v+10],F,4293915773),E=l(E,S,x,w,d[v+1],I,2240044497),w=l(w,E,S,x,d[v+8],B,1873313359),x=l(x,w,E,S,d[v+15],j,4264355552),S=l(S,x,w,E,d[v+6],F,2734768916),E=l(E,S,x,w,d[v+13],I,1309151649),w=l(w,E,S,x,d[v+4],B,4149444226),x=l(x,w,E,S,d[v+11],j,3174756917),S=l(S,x,w,E,d[v+2],F,718787259),E=l(E,S,x,w,d[v+9],I,3951481745),w=n(w,m),E=n(E,g),S=n(S,y),x=n(x,b);var q=h(w)+h(E)+h(S)+h(x);return q.toLowerCase()}});
define("/base/utils/server/h5_base.js",[],function(e,t,n){function r(e){var t=Array.prototype.slice.call(arguments,1);for(var n=0,r=t.length;n<r;n++)for(var i in t[n])e[i]=t[n][i];return e}t.paramKey="h5_paramKey",t.targetUrl="h5_targetUrl",t.userInfoKey="h5_userInfoKey",t.hrefHash="_hash",t.lastHash="_lastHash",t.appKey="h5_app_key",t.appToken="h5_app_token",t.appRefreshToken="h5_app_ref_token",t.appTokenExpired="h5_app_token_expired",t.appTokenBetween="h5_app_token_between",t.appTokenSaveTime="h5_app_token_save_time",t.appRequestFailed="h5_app_request_failed_tag",t.set=function(e,t){if(this.isSuppLocalStorage()){typeof t!="string"&&(t=JSON.stringify(t));try{return window.localStorage.setItem(e,t),!0}catch(n){}}return!1},t.add=function(e,t){if(this.isSuppLocalStorage()){if(typeof t=="string")t=JSON.parse(t);else{try{r(t,JSON.parse(getValue(e)))}catch(n){}t=JSON.stringify(t)}return window.localStorage.setItem(e,t),!0}return!1},t.get=getValue=function(e){return this.isSuppLocalStorage()?window.localStorage.getItem(e):null},t.removeValue=function(e){if(this.isSuppLocalStorage())return window.localStorage.removeItem(e)},t.clearAll=function(){if(this.isSuppLocalStorage())return window.localStorage.clear()},t.userCacheHash=function(e){var t=e||"h5",n=t+this.lastHash,r=t+this.hrefHash;return!location.hash&&this.get(r)?(location.hash=this.get(r),!0):(location.hash&&(this.get(r)!=location.hash&&this.set(n,this.get(r)||""),this.set(r,location.hash)),!1)},t.getLastHash=function(e,t){return this.get((e||"h5")+this.lastHash)||t||""},t.getParamFromStorage=function(e){try{return JSON.parse(this.get(this.paramKey))[e]}catch(t){}return null},t.getUserProFromStorage=function(e){try{return JSON.parse(this.get(this.userInfoKey))[e]}catch(t){}return null},t.getBetweenTime=function(e){if(e){var t=(new Date).getTime()-e;return this.set(this.appTokenBetween,t),t}return parseInt(this.get(this.appTokenBetween)||0)},t.checkIsBlank=function(e){return null==e||""==e},t.isLogin=function(){var e=this.getUserProFromStorage("nick");return e==""||e==null?!1:!0},t.removeToken=function(){try{this.removeValue(this.appToken),this.removeValue(this.appRefreshToken),this.removeValue(this.appTokenExpired),this.removeValue(this.appTokenBetween),this.removeValue(this.appTokenSaveTime)}catch(e){}},t.getQueryString=function(e){var t=location.search;if(t.length<1)return"";t=t.substr(1);var n=t.split("&"),r={};for(i in n){var s=n[i].split("=");r[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return e?r[e]:r},t.isClient=function(){var e=this.getQueryString("ttid");return e&&e.indexOf("@")>-1},t.isAndroidClient=function(){var e=this.getQueryString("ttid");return e&&e.toLowerCase().indexOf("android")>-1},t.isIos=function(){var e=navigator.userAgent;return e&&e.toLowerCase().indexOf("iphone")>-1},t.isSuppLocalStorage=function(){try{if(window.localStorage=="undefined")return!1;var e="testSupportKey";window.localStorage.setItem(e,"1");var t=window.localStorage.getItem(e);return window.localStorage.removeItem(e),"1"==t}catch(n){}return!1},t.getBrowserInfo=function(e){var t={os:"iphone",version:6,browser:"safari",keyboardHeight:250,ios6:function(){return"iphone"==this.os&&this.version>=6},lowLevel:function(){return!1}},n=e.toUpperCase(),r=n.indexOf("IPHONE")>=0||n.indexOf("IPOD")>=0||n.indexOf("IPAD")>=0;n.indexOf("IPAD")>=0&&(t.keyboardHeight=450),r||(t.os="android");var i=e.match(/UC\sAppleWebKit\/([\d.]+)/),s=e.match(/(UCWEB)(\d.+?(?=\/))/);i||s?t.browser="uc":e.match(/MQQBrowser/)?t.browser="qq":e.match(/(Chrome)|(CriOS)/)&&(t.browser="chrome");if("iphone"==t.os)t.version=parseFloat((""+(/CPU.*OS ([0-9_]{1,5})|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))||6;else if("android"==t.os){var o=e.indexOf("Android "),u=e.substr(o+8,6),a=u.split(/_|\./);t.version=parseFloat(a.join("."))}return r||(t.keyboardHeight=window.innerWidth*.8),t}});
define("/base/modules/imgtrim/dpi.js",[],function(e,t,n){var r=1;window.devicePixelRatio&&(r=window.devicePixelRatio),t.get=function(){return r}});
define("/base/modules/imgtrim/trim.js",["./dpi.js","../../utils/server/cdn.js"],function(e,t){function a(){return s||i}function f(e,t,n){var r;e>t?r=t:r=l(e,n);if(r){var i=n[n.length-1];i<r&&(r=i),r===t&&(r=undefined)}return r}function l(e,t){var n=t[t.length-1];if(n<=e)return n;var r=0;for(var i=t.length;i>=0;i--)if(t[i]<=e){t[i]==e?r=e:i<t.length-1&&(r=t[i+1]);break}return r}var n=e("./dpi.js"),r=e("../../utils/server/cdn.js"),i=n.get(),s,o=[110,150,170,220,240,290,450,570],u=[120,230,290,310,460,580];t.setRatio=function(e){s=e},t.trim=function(e){if(e.isXz)return t.trimXz(e);var n={},i=e.ratio||a(),s=f(e.expWidth*i,e.rWidth,o),u=e.url,l=e.expWidth,c=e.rWidth,h=e.rHeight;return s&&(u+="_"+s+"x10000.jpg",c=s,h=e.rHeight*c/e.rWidth),n.expWidth=l,n.expHeight=l*h/e.rWidth,n.rWidth=c,n.rHeight=h,n.url=r.getOriginalImg(u),n},t.trimXz=function(e){var t={},n=e.ratio||a(),i=e.url,s=e.rHeight>e.rWidth,o=f(e.expWidth*n,s?e.rHeight:e.rWidth,u),l,c=e.expWidth,h=e.rWidth,p=e.rHeight;return o&&(i+="_"+o+"x"+o+"xz.jpg",s?(p=o,h=o<h?o:h):(h=o,p=o<p?o:p)),l=c*p/h,t.expWidth=c,t.expHeight=l,t.rWidth=h,t.rHeight=p,t.url=r.getOriginalImg(i),t}});
define("/base/utils/server/cdn.js",["./config","./h5_common"],function(e,t,n){function m(e,t,n,r,i,s,o){if(!t)return"http://a.tbcdn.cn/mw/s/common/icons/nopic/nopic-"+r+".png";var a="";if(-1!=t.indexOf("http://"))a=o?t:t+g(r,i);else if(e==d)a=w()+h+t+(o?"":g(r,i));else{var f=y(t,s);a=b(f).replace("${machine}",f)+u+t+(o?"":g(r,i))}return a}function g(e,t){return"_"+(e||80)+"x"+(t||80)+".jpg"}function y(e,t){var n=-1;null!=t&&t.toString().match("[0-9]")&&(n=t%p);if(-1==n)if(e.match("^i[0-9].*"))n=parseInt(e.charAt(1))%p;else{var r=e.match("([^/]*).jpg");if(null!=r&&""!=r&&r.length>1){var i=r[1].length,s=r[1].charCodeAt(0)+r[1].charCodeAt(i-1);n=s%p}else n=e.charCodeAt(0)%p}return 0==n&&(n+=1),n}function b(){return E()?a:f}function w(){return E()?l:c}function E(){return"waptest"==s}function S(e){return e&&e.indexOf("taobaocdn")!=-1&&e.indexOf("_.webp")==-1&&i.isSuppWebp()?"_.webp":""}var r=e("./config"),i=e("./h5_common"),s=r.sysType||"m",o="${machine}",u="/bao/uploaded/",a="http://img0"+o+".daily.taobaocdn.net",f="http://q.i0"+o+".wimg.taobao.com",l="http://logo.daily.taobao.net",c="http://logo.taobaocdn.com",h="/shop-logo/",p=4,d=1,v=2;t.getImg=function(e,t,n,r){return m(v,e,u,t,n,r)},t.getOriginalImg=function(e){return m(v,e,u,null,null,null,!0)},t.getLogo=function(e,t,n,r){return m(d,e,h,t,n,r)}});
define("/base/utils/server/config.js",[],function(e,t,n){var r="m",i="12574478";window.location.host=="localhost"||window.location.host.match(".*\\waptest\\.(taobao|tmall|etao|alibaba|alipay|aliyun)\\.com.*")?(r="waptest",i="4272"):window.location.host.match(".*\\wapa\\.(taobao|tmall|etao|alibaba|alipay|aliyun)\\.com.*")?r="wapa":window.location.host.match(".*\\m\\.(taobao|tmall|etao|alibaba|alipay|aliyun)\\.com.*")&&(r="m"),t.sysType=r||"m",t.defaultAppKey=i||"12574478",t.indexPage="http://fav."+t.sysType+".taobao.com/h5proxy-midFav.htm",t.errorPage="http://fav."+t.sysType+".taobao.com/fav_error.htm"});
define("/base/utils/server/h5_common.js",["./uriBroker","./h5_base","./h5_jump","zepto","./cookie"],function(e,t,n){var r=e("./uriBroker"),i=e("./h5_base"),s=e("./h5_jump"),o=e("zepto"),u=e("./cookie"),a=function(e){var t=r.getUrl(e);s.setLocationHref(r.getUrl("login",{tpl_redirect_url:t}))},f=function(e){var t="http://m.taobao.com";e&&e!="undefined"&&(t=r.getUrl(e)),s.setLocationHref(t)};t.dealResponse=function(e,t,n,r,s,o){var u=e.ret.toString().toUpperCase();u.indexOf("SUCCESS::")>-1?t(e):(i.set(i.hrefHash,window.location.hash),u.indexOf("FAIL_SYS_SESSION_EXPIRED")>-1||u.indexOf("NEED_LOGIN::")>-1||u.indexOf("-100::")>-1||u.indexOf("NOT_FOUNT_USER::")>-1||u.indexOf("ERR_SID_INVALID::")>-1||u.indexOf("SID_ERROR::")>-1?r?a(r):a("home"):u.indexOf("ILLEGAL_REQUEST::")>-1||u.indexOf("ILLEGAL_SIGN::")>-1?l()?n&&n(o?e:u):f(s):n&&n(o?e:u))};var l=function(){var e=parseInt(i.get(i.appRequestFailed)||"0");return 3<=e?(window.location.href="http://m.taobao.com?t=3",!0):(e+=1,i.set(i.appRequestFailed,e),!1)};t.isSupportH5=function(){return window.localStorage=="undefined"?!1:window.applicationCache=="undefined"?!1:!0},t.getNickFromCookie=function(){var e=u.getCookie("_w_tb_nick");return e&&e.length>0&&e!="null"?e:""},t.isLogin=function(){var e=u.getCookie("imewweoriw");return e&&e.length>32},t.goLogin=function(e){!i.isClient()&&e.hideType?t.popLogin(e):a(e.rediUrl||e)},t.isSuppWebp=function(){return"true"==u.getCookie("supportWebp")},t.popLogin=function(e){if(o("#J_h5_login").length<1){var t=document.createElement("script");t.type="text/javascript",t.id="J_h5_login",t.src="http://a.tbcdn.cn/mw/base/modules/login/h5_login.js",o("body").append(t),t.onload=function(){window.H5_M.Login.showLogin(e)}}else window.H5_M.Login.showLogin(e)}});
define("/base/utils/server/uriBroker.js",["underscore","./uri","./h5_base"],function(e,t,n){function u(e){if(URL_CONSTANTS.path[e])return URL_CONSTANTS.path[e];var t=e.lastIndexOf("_");return t<0?"":u(e.substring(0,t))}function a(e,t){return e==URL_CONSTANTS.path["a"]&&(e=e.replace("ITEM_ID",function(){var e=t.itemId;return delete t.itemId,e})),e==URL_CONSTANTS.path["a_td"]&&(e=e.replace("ORDER_ID",function(){var e=t.tradeId;return delete t.tradeId,e})),e||""}function f(e){var t=URL_CONSTANTS.dps[e];if(r.isString(t))return t;if(r.isObject(t)){var n=t.cache;if(t.dps)return URL_CONSTANTS[n]=t.dps,t.dps;if(n)return URL_CONSTANTS[n]}return!e||e.lastIndexOf("_")<0?"":(e=e.substring(0,e.lastIndexOf("_")),f(e))}var r=e("underscore"),i=e("./uri"),s=e("./h5_base"),o={};return o.URL_CONSTANTS=URL_CONSTANTS={path:{home:"index.htm",home_wuliu:"trade/bought_item_lists.htm",home_kehu:"channel/act/other/kehufuwu.xhtml",home_anquan:"channel/act/other/jiaoyianquan.xhtml",home_tiantiantejia:"channel/act/sale/tiantiantejia.html",home_taojinbi:"channel/act/taojinbi.html",home_help:"channel/act/other/help.xhtml",home_msg:"index_header_ajax.htm",my:"myTaobao.htm",my_deliver:"deliver/wap_deliver_address_list.htm",my_alipay:"myAlipay.htm",my_bindalipay:"alipay_modify.htm",my_viewitems:"view_items.htm",a:"iITEM_ID.htm",a_td:"tdORDER_ID.htm",s:"search.htm",s_history:"history.htm",im:"ww/ad_ww_lately_contacts.htm",im_icon:"ww/status.do",shop:"shop/shop_index.htm",shop_search:"shop/shop_auction_search.htm",login:"login.htm",login_out:"logout.htm",u_reg:"reg/newUser.htm",fav:"h5proxy-mid_fav.htm",auction1_cart:"cart/my_cart.htm",info_jianyi:"help/report.htm",h5_ww:"ww/index.htm",h5_myhome:"my/index.htm",h5_allspark:"we/index.htm",h5_mycart:"cart/index.htm",h5_fav:"fav/index.htm",d:"my_bag.htm",triph5_order:"myorder.html",caipiao_order:"lottery/wap/user/my_lottery.htm",tm_pay:"order/baobeiPay.htm",auction1_refund:"refund/fill_refund.htm",tm_cancelOrder:"order/order_cancel.htm"},dps:{},app_param_key:s.paramKey},o.getUrl=function(e,t){e=e.toLowerCase(),t=t||{};var n=t.domain;n?delete t.domain:n="taobao";var s=e.split("_"),o=i.createURI(s[0]);if(!o)throw"module param is not current,can't match any host";var f="",l=_getDps(e,t);switch(s[0]){case"api":var c={};c.data=JSON.stringify(t),r.extend(c,this.defaultMtopParam),t=c,f=u(e);break;default:f=u(e),f=a(f,t)}return l&&(t.pds=l),i.renderURI(o,"",t,f,n)},o.getDps=_getDps=function(e,t){if(t.dps)return t.dps;var n=e,r=t.method;return r&&(n+="_"+r.toLowerCase()),t._3th&&(n+="_3th",delete t._3th),t.trigerType&&(n+="_"+t.trigerType,delete t.trigerType),f(n)},o});
define("/base/utils/server/uri.js",["zepto","./config","./h5_base"],function(e,t,n){function h(e){if(null!=t.ttQueryStr&&""!=t.ttQueryStr){var n=e.match("\\.[a-zA-Z]+\\?");null!=n&&0<n.length?e.indexOf("?")==e.length-1?e+=t.ttQueryStr:e=e+"&"+t.ttQueryStr:e=e+"?"+t.ttQueryStr}return e}function p(e,t,n,r){v(r)||(e+="/"+r),v(t)||(e+="/"+t);var i=!1;if(null!=n)for(var s in n)if(null!=n[s]){i=!0;break}return i&&(e+="?"+g(n)),e}function d(e){if(v(e))return!1;for(var t=0;t<o.length;t++)if(o[t].toLowerCase()==e.toLowerCase())return!0;return!1}function v(e){return s.checkIsBlank(e)}function m(e,n){return e.replace(u,function(){return d(n)?n:t.uri.defaultDomain})}function g(e){var t="";if(null==e)return t;for(var n in e)null!=e[n]&&""!=e[n]&&(t+=n+"="+encodeURIComponent(e[n])+"&");return""!=t&&t.length-1==t.lastIndexOf("&")&&(t=t.substr(0,t.length-1)),t}var r=e("zepto"),i=e("./config"),s=e("./h5_base");t.uri={protocol:"http://",sysType:i.sysType||"m",defaultDomain:"taobao"};var o=["taobao","tmall","etao","alibaba","alipay"],u="${_serverDomain}",a=["ttid","sprefer"];t._serverHost=t.uri.sysType+"."+u+".com",t.subUri={index:t.uri.protocol+t._serverHost},t.ttQueryStr="";for(var f in a){var l=a[f],c=s.getQueryString(l);c&&c!=""&&(t.ttQueryStr+="&"+l+"="+c)}t.createURI=function(e){return!e||e==="home"?t.uri.protocol+t._serverHost:t.uri.protocol+e+"."+t._serverHost},t.renderURI=function(e,t,n,r,i){return h(p(m(e,i),t,n,r))},t.renderServer=function(e,t,n,r){return h(p(r,e,t,n))},t.encode=function(e){return encodeURI(e)},t.getStrParamFromJson=function(e){return g(e)}});
define("/base/utils/server/h5_jump.js",["./h5_base"],function(e,t,n){var r=e("./h5_base"),i=function(e,t){try{var n=document.createEvent("Event");n.initEvent(t,!0,!0),e.dispatchEvent(n)}catch(r){console.log("error")}},s=function(e){var t=document.getElementById("loc-simulate-dom");if(t==null){var t=document.createElement("a");t.id="loc-simulate-dom",t.href=e,t.value="",document.body.appendChild(t)}else t.href=e;i(t,"click"),t.click()};t.simulateJump=function(e){_simulatieJump(e)},t.setLocationHref=function(e){if(r.isAndroidClient()){var t=r.getBrowserInfo(navigator.userAgent);if(t.os=="android"&&(""+t.version).indexOf("2.3")>-1){s(e);return}}location.href=e}});
define("/base/utils/server/cookie.js",[],function(e,t,n){t.isCookieEnable=function(){if(!window.navigator.cookieEnabled)return!1;var e="_s_cookie_";this.setCookie(e,"1");var t=this.getCookie(e);return t=="1"?(this.delCookie(e),!0):!1},t.getCookieVal=function(e){var t=document.cookie.indexOf(";",e);return t==-1&&(t=document.cookie.length),unescape(decodeURIComponent(document.cookie.substring(e,t)))},t.getCookie=function(e){var t=e+"=",n=t.length,r=document.cookie.length,i=0;while(i<r){var s=i+n;if(document.cookie.substring(i,s)==t)return this.getCookieVal(s);i=document.cookie.indexOf(" ",i)+1;if(i==0)break}return null},t.setCookie=function(e,t){var n=window.location.host,r=n.indexOf("."),i=n.substring(0,r);i!="waptest"&&i!="wapa"&&i!="m"&&(n.indexOf("taobao")>-1||n.indexOf("tmall")>-1)&&(n=n.substr(r+1));var s=arguments.length>2?arguments[2]:null;if(s==null)document.cookie=e+"="+escape(t)+";path=/;domain="+n;else{var o=new Date;o.setTime(o.getTime()+s*1e3),document.cookie=e+"="+escape(t)+";path=/;domain="+n+";expires="+o.toGMTString()}},t.delCookie=function(e){var t=new Date;t.setTime(t.getTime()-1);var n=this.getCookie(e);document.cookie=e+"="+n+"; expires="+t.toGMTString()}});
define("/mw/webapp/transformer/common/log.js",["aplus"],function(e,t,n){var r=e("aplus");t.logEnter=function(e,t){console.log(e);if(e){var n={aplus:!0},i="";window.location.search==""?i=location.protocol+"//"+location.hostname+location.pathname+"?log=page_"+e.split("/")[0].replace("#","")+e:i=location.protocol+"//"+location.hostname+location.pathname+window.location.search+"&log=page_"+e.split("/")[0].replace("#","")+e,n.apuri=i;try{r.ajax(n)}catch(s){console.log(s)}}},t.logClick=function(e,t){if(e){var n={aplus:!0},i="",s="";window.location.search==""?(i=location.protocol+"//"+location.hostname+location.pathname+"?log=click_"+e,s=location.protocol+"//"+location.hostname+location.pathname+location.hash):(i=location.protocol+"//"+location.hostname+location.pathname+window.location.search+"&log=click_"+e+location.hash,s=location.protocol+"//"+location.hostname+location.pathname+window.location.search+location.hash),n.apref=s,n.apuri=i,r.ajax(n)}},t.logToLogin=function(){}});
(function(e){if(typeof window["define"]=="undefined"){var t={},n=t.exports={};result=e(null,n,t)||t.exports}else define("/base/modules/aplus/aplus.js",["zepto"],e)})(function(e,t,n){function f(){return s.href.toString()}function l(){return""}function c(){return i.cookie.match(a)}function h(e){var t=i.createElement("a");return t.href=e,t}var r=window,i=r.document,s=r.location,o=e?e("zepto"):r.Zepto||r.$,u="http://log.m.taobao.com/js.do",a=/(?:^|\s)cna=([^;]+)(?:;|$)/;return o.orginAjax=o.ajax,o.ajax=function(e){function v(){d&&d.apply(this,arguments);if(h===!0||h===1)t=f(),n=c(),r=l(),i=e.apdata||e.ap_data,s=e.apuri||e.ap_uri,t&&(p.ap_ref=t),n&&(p.ap_cna=n[1]),i&&(p.ap_data=i),s&&(p.ap_uri=s),r&&(p.ap_ip=r),a={url:u,data:p,type:"GET",dataType:"jsonp"},h!==2&&o.orginAjax(a)}var t,n,r,i,s,a,h=e.aplus!=null?e.aplus:o.ajaxSettings.aplus||!1,p={_aplus:"1"},d=e.complete;e.url?(e.complete=v,o.orginAjax(e)):v()},o});
define("/mw/webapp/transformer/index/indexView.js",["backbone","zepto","underscore","./indexModel","cdn","h5_base","h5_comm","h5_base","uriBroker","../../../../base/styles/component/slider/js/slider.js","../common/mtopForAllspark.js","../../../../base/styles/component/pagenav/js/pagenav.js","../ui/notification.js","../ui/loading","../common/favUtils.js","dpi"],function(e,t,n){var r=e("backbone"),i=e("zepto"),s=e("underscore"),o=e("./indexModel"),u=e("cdn"),a=e("h5_base"),f=e("h5_comm"),l=e("h5_base"),c=e("uriBroker"),h=e("../../../../base/styles/component/slider/js/slider.js"),p=e("../common/mtopForAllspark.js"),d=e("../../../../base/styles/component/pagenav/js/pagenav.js"),v=e("../ui/notification.js"),m=e("../ui/loading"),g=e("../common/favUtils.js"),y=e("dpi"),b=i("#index_header_tpl").html(),w=i("#index_logedheader_tpl").html(),E=s.template(i("#index_feed_tpl").html());return i.extend(i.fn,{wAE:function(e,t){var n=this,r=!0,i=function(n){if(t&&n.propertyName!=t)return;typeof e=="function"&&r&&(e(),r=!1)};n.unbind("webkitAnimationEnd").bind("webkitAnimationEnd",i),n.unbind("webkitTransitionEnd").bind("webkitTransitionEnd",i)}}),r.View.extend({el:"#content",model:new o,events:{"click .loginbtn":"goLogin","click .navbar .add":"add","click .navbar .refresh.index":"refresh","click #indexPage .js_feed":"goToDetail","click .goFollowbtn":"add","click .navbar .favs":"favs","click #indexPage .feed-list .favbtn":"favbtn","click .gotop":"goTop","click .hdButton span":"changeHD","click .loginStatus a.login":"goLogin","click .icon-received-comments":"recComment"},initialize:function(){this.params={timestamp:0,curPage:1,pageSize:10,onlyYou:1,direction:0},this.model.on("change:timeLine",this.renderFeeds,this),this.model.on("change:hotFeeds",this.renderFeeds,this),this.model.on("change:replyCount",this.renderReplyCount,this),this.$feedList=i("#indexPage .feed-list")},hotFeedFlag:!1,render:function(e){var t='<div class="login-bar">想看更多？登录淘宝帐号<button class="loginbtn log" data-log="attention">登录</button></div>';i(".icon-received-comments .count").hide(),this.params.curPage=e,this.$feedList.html()==""&&this.$feedList.html('<div class="loading"><span class="spinner"></span></div>'),i("footer").css("display","block");if(f.isLogin()){i(".navbar").html(w),i("footer .nick").html(f.getNickFromCookie());var n=c.getUrl("login_out");i("footer .loginStatus a.logout").attr("href",n),i("footer .loginStatus a.logout").css("display","inline-block"),i("footer .loginStatus a.login").css("display","none"),i("footer .loginStatus a.reg").css("display","none"),i(".J_status").html(""),this.model.getTimeLine(this.params),this.model.getReplyCount({})}else i(".navbar").html(b+t),i("footer .nick").html(""),i("footer .loginStatus a.logout").css("display","none"),i("footer .loginStatus a.login").css("display","inline-block"),i("footer .loginStatus a.reg").css("display","inline-block"),i(".J_slider").length==0&&(i("#indexPage .J_status").html('<div class="J_slider"></div><div class="hotfeedhd"><span>热门广播</span></div>'),this.showBanner()),this.hotFeedFlag||(this.model.hotFeeds(this.params),this.hotFeedFlag=!0);if(!i("#indexPage").hasClass("show")){var r=i(".view-page.show"),s=i("#indexPage");r.length>0?(s.hasClass("iB")&&s.removeClass("iB").addClass("iL"),r.removeClass("show iC").addClass("iR").wAE(function(){r.addClass("hide")}),s.removeClass("hide iL").addClass("show iC")):(s.removeClass("hide"),setTimeout(function(){s.removeClass("iB").addClass("show iC")},0))}},changeHD:function(e){var t=this,n=i(e.currentTarget);console.log("changeHD"),n.text()=="切换到高清模式"?(n.html("切换到流畅模式"),a.set("hdButton",2),globalCDN.setRatio(2)):(n.html("切换到高清模式"),a.set("hdButton",1),globalCDN.setRatio(1))},favbtn:function(e){var t=i(e.currentTarget),n=t.parent().find(".js_feed");g.favbtn(t,n.attr("feedid"),n.attr("snsid"))},changePage:function(e){var t=this;this.$feedList.html('<div class="loading"><span class="spinner"></span></div>'),t.params.curPage>e?t.params.direction=0:t.params.direction=1,t.isChangePage=!0,window.scrollTo(0,1),window.location.hash="#index/"+e},goTop:function(){window.scrollTo(0,1)},goToDetail:function(e){var t=i(e.currentTarget),n=this;changeHash("#detail/"+t.attr("snsid")+"/"+t.attr("feedid")+"/"+n.params.curPage,"detail")},favs:function(){var e=this;f.isLogin()?changeHash("#fav/1","fav"):f.goLogin({rediUrl:"h5_allSpark",hideType:"changeHash",targetUrl:"#fav/1"})},add:function(){var e=this;f.isLogin()?(e.isAdd=!0,changeHash("#accountManage/p1","accountManage")):f.goLogin({rediUrl:"h5_allSpark",hideType:"changeHash",targetUrl:"#accountManage/p1"})},goLogin:function(){var e=location.href;f.goLogin({rediUrl:"h5_allSpark",hideType:"reload"})},refresh:function(){var e=this;e.allFeedCount=parseInt(this.model.get("timeLine").allFeedCount),e.isRefresh=!0;var t=i(".navbar .refresh .btn div");t.hasClass("spinner")||t.addClass("spinner"),this.params.curPage=="1"?this.model.getTimeLine(this.params):window.location.hash="#index/1"},showBanner:function(){var e={list:[{url:"",picture:"http://a.tbcdn.cn/mw/webapp/allspark/01.jpg"},{url:"",picture:"http://a.tbcdn.cn/mw/webapp/allspark/02.jpg"},{url:"",picture:"http://a.tbcdn.cn/mw/webapp/allspark/03.jpg"}]};e.width=e.list.length*document.getElementById("content").offsetWidth;var t=!1;a.get("hdButton")!=null?parseInt(a.get("hdButton"))>1&&(t=!0):y.get()>1&&(t=!0);if(t)for(var n=0;n<e.list.length;n++)e.list[n].picture=e.list[n].picture.replace(".jpg","x2.jpg");e.swidth=document.getElementById("content").offsetWidth,i("#indexPage .J_slider").html(s.template(i("#slider_tpl").html(),e)),new h(".in-slider",{wrap:".in-slider-cont",trigger:".in-slider-status",useTransform:!0,interval:5e3,play:!0,loop:!0})},renderFeeds:function(){var e,t=this;setTimeout(function(){i(".navbar .refresh div").removeClass("spinner")},2e3);if(f.isLogin()){e=this.model.get("timeLine"),e.hotFeeds=!1;if(e.fail){v.message(e.errMsg);return}if(typeof t.allFeedCount!="undefined"){var n=parseInt(e.allFeedCount)-t.allFeedCount;if(n>0||this.$feedList.html()==""){this.params.curPage==1&&v.message("更新了 "+n+" 条广播");var r=E(e);this.$feedList.html(r)}}else{var r=E(e);this.$feedList.html(r)}if(t.isChangePage||t.isRefresh||t.isAdd){var r=E(e);this.$feedList.html(r),t.isChangePage=!1,t.isRefresh=!1}t.allFeedCount=parseInt(e.allFeedCount),i("#timeLinePageNav").html("");var s=Math.ceil(parseInt(e.totalCount)/this.params.pageSize);s>1&&(this.recommentPage=new d({id:"#timeLinePageNav",index:this.params.curPage,pageCount:s,pageSize:this.params.pageSize,disableHash:"true"}),this.recommentPage.pContainer().on("P:switchPage",function(e,n){t.changePage(n.index)}))}else{e=this.model.get("hotFeeds");if(e.fail){v.message(e.errMsg);return}e.hotFeeds=!0;var r=E(e);this.$feedList.html(r),i("#timeLinePageNav").html("")}if(e.onlyYou=="1"){if(i(".login-bar").length==0){var o='<div class="login-bar">关注账号，订阅丰富内容<button class="goFollowbtn log" data-log="attention">去关注</button></div>';i(".navbar").append(o),i(".feed-list").css("margin-top","44px")}}else f.isLogin()&&(i(".login-bar").remove(),i(".feed-list").css("margin-top",""));i("#content")[0].style.minHeight="360px",window.lazyload.reload()},renderReplyCount:function(){var e=parseInt(this.model.get("replyCount").count);e>9&&(e="N");if(e==0)return;e&&i(".icon-received-comments .count").text(e).show()},recComment:function(){changeHash("#recComment/1","index")}})});
define("/mw/webapp/transformer/index/indexModel.js",["backbone","zepto","underscore","../common/mtopForAllspark.js"],function(e,t,n){var r=e("backbone"),i=e("zepto"),s=e("underscore"),o=e("../common/mtopForAllspark.js"),u=r.Model.extend({getTimeLine:function(e){var t=this;o.timeLine(e,function(e){if(e.fail){e.errMsg="服务器繁忙，请稍后再试！",t.set("timeLine",e);return}e.t=(new Date).getTime(),t.set("timeLine",e)})},hotFeeds:function(e){var t=this;o.hotFeeds(e,function(e){if(e.fail){e.errMsg="服务器繁忙，请稍后再试！",t.set("hotFeeds",e);return}e.t=(new Date).getTime(),t.set("hotFeeds",e)})},getReplyCount:function(e){var t=this;o.recommendsReplyCount(e,function(e){if(e.fail){e.errMsg="服务器繁忙，请稍后再试！",e.t=(new Date).getTime(),t.set("replyCount",e);return}e.t=(new Date).getTime(),t.set("replyCount",e)})}});return u});
define("/mw/webapp/transformer/common/mtopForAllspark.js",["h5_mtop","h5_comm","h5_cache","uriBroker","zepto","cookie","../common/cache.js"],function(e,t,n){function c(e,t,n){l(e,t||{},function(e){n&&n.call(arguments.callee,e.data)},function(e){n&&n.call(arguments.callee,{fail:e})})}function h(e){return e.join?{snsIds:e.join(":")}:{snsIds:e}}var r=e("h5_mtop"),i=e("h5_comm"),s=e("h5_cache"),o=e("uriBroker"),u=e("zepto"),a=e("cookie"),f=e("../common/cache.js"),l=t.getData=function(e,t,n,s){r.getApi(e,"2.0",t,{ap_ref:window.location.href},function(e){i.dealResponse(e,function(e){n&&n.call(this,e)},function(e){s&&s.call(this,e)},"h5_allspark")},function(e){s.call(this,e)})};t.pageParam={curPage:1,pageSize:3,isIndex:function(){return 1==this.curPage}},t.addAccount=function(e,t,n){this.getData("mtop.sns.follow.pubAccount.add",h(e),t,n)},t.removeAccount=function(e,t,n){this.getData("mtop.sns.follow.pubAccount.remove",h(e),t,n)},t.info=function(e,t){c("mtop.sns.pubAccount.info",e,function(n){n.fail||f.saveAccount(e.snsId,n),t&&t.call(arguments.callee,n)})},t.allFeedCount=function(e,t){this.getData("mtop.sns.pubAccount.allFeedCount",{},e,t)},t.listBefore=function(e,t){c("mtop.sns.feed.listBefore",e,t)},t.readAndListAfter=function(e,t){c("mtop.sns.feed.readAndListAfter",e,t)},t.recommends=function(e,t){c("mtop.transformer.pubAccount.recommends",e,t)},t.my=function(e,t){c("mtop.sns.follow.pubAccount.my",e,t)},t.listWithFirstFeed=function(e,t){c("mtop.sns.pubAccount.listWithFirstFeed",e,t)},t.addComment=function(e,t){c("mtop.sns.comment.new",e,t)},t.commentList=function(e,t){c("mtop.sns.comment.list",e,function(n){if(!n.fail){var r=e.snsId+"_"+e.feedId,i=f.getItemById(r);i&&(typeof i=="string"&&(i=JSON.parse(i)),i.commentCount=n.totalCount||0,f.saveItem(r,i))}t&&t.call(arguments.callee,n)})},t.recommendsReplyList=function(e,t){c("mtop.sns.comment.replyList",e,t)},t.recommendsReplyCount=function(e,t){c("mtop.sns.comment.replyCount",e,t)},t.detail=function(e,t){c("mtop.sns.feed.detail",e,t)};var p={};o.URL_CONSTANTS.path.s_price||(o.URL_CONSTANTS.path.s_price="search_turn_page_iphone.htm"),t.getPrices=function(e,t){var n=[],r=[];e.forEach(function(e){p[e]?n.push({id:e,price:p[e]}):r.push(e)}),r.length?u.ajax({type:"GET",dataType:"json",url:o.getUrl("s_price",{nid:r.join(",")})+"&callback=?",success:function(e){e.result&&"true"==e.result&&e.listItem&&e.listItem.forEach(function(e){p[e.itemNumId]=e.price,n.push({id:e.itemNumId,price:e.price})}),t&&t.call(arguments.callee,n)},error:function(e){console.log(e),t&&t.call(arguments.callee,n)}}):t&&t.call(arguments.callee,n)},t.autoCreate=function(){var e=i.getNickFromCookie();e&&!f.isCreateSns(e)&&r.getApi("mtop.transformer.account.autoCreate","2.0",{},{},function(t){var n=t.ret.toString().toUpperCase();n.indexOf("SUCCESS::")>-1&&f.saveSnsFlag(e)},function(e){})},t.timeLine=function(e,t){c("mtop.sns.pubAccount.getTimeLine",e,t)},t.hotFeeds=function(e,t){c("mtop.sns.pubAccount.hotFeeds",e,t)},t.favoriteFeeds=function(e,t){c("mtop.sns.favorite.feeds",e,t)},t.favoriteAddFeed=function(e,t){c("mtop.sns.favorite.addFeed",e,t)},t.favoriteRemoveFeed=function(e,t){c("mtop.sns.favorite.removeFeed",e,t)},t.searchAccount=function(e,t){c("mtop.sns.pubAccount.search",e,t)}});
define("/base/utils/server/mtop_h5api.js",["zepto","./cookie","./h5_utils","./uri","./config","./mtop_h5_chunk.js"],function(e,t,n){function x(e){return e.indexOf("bigPipe.do?")>0}var r=e("zepto"),i=e("./cookie"),s=e("./h5_utils"),o=e("./uri"),u=e("./config"),a="J_app_key",f="h5ApiUpdate.do",l="_m_h5_tk",c=e("./mtop_h5_chunk.js"),h="bigPipe.do",p=0,d=5,v=!1;callQue=[];var m=function(){var e=document.getElementById(a);return e?e.value:u.defaultAppKey},g=m();t.getApi=function(e,t,n,r,i,s){var u=n&&!!n.apis;u?(r.entrance="h5",r.apis=typeof n.apis=="string"?n.apis:JSON.stringify(n.apis)):(r.api=e,r.v=t||"*",r.data=typeof n=="string"?n:JSON.stringify(n));var a=o.renderURI(o.createURI("api"),u?h:f,r,"rest");0==a.indexOf("http://api.m.taobao.com"&&u)&&(a=a.replace("taobao.com","taobao.com:9999"));var l=g;callQue.push({url:a,app_key:l,data:r.data,callback:i,errorback:s}),v||(v=!0,b())};var y=function(e,t,n,s,o){var u=(i.getCookie(l)||"").split("_")[0],a=w(e,t,u,n),f={type:"GET",url:a,timeout:2e4,success:function(r){var u=(r.ret?r.ret:"").toString();if(-1!=u.indexOf("SUCCESS::"))p=0;else if(-1!=u.indexOf("TOKEN_EMPTY::")||-1!=u.indexOf("TOKEN_EXOIRED::")){p++;if(p<d){y(e,t,n,s,o);return}i.delCookie(l),console.log("try exceed times")}s&&s(r),b()},error:function(e){o&&o(e),b()},complete:function(e,t){t!="success"&&o&&o(t),b()}};x(e)?c.chunkAjax(f):r.ajax(f)},b=function(){if(callQue.length>0){var e=callQue.pop(0);y(e.url,e.app_key,e.data,e.callback,e.errorback)}else v=!1},w=function(e,t,n,r){var i=(new Date).getTime();return E(e)+"&appKey="+t+"&sign="+S(t,n,i,r)+"&t="+i},E=function(e){if(-1==e.indexOf("callback=")&&!x(e)){var t=e.indexOf("?");return e.substr(0,t)+"?callback=?&type=jsonp&"+e.substr(t+1,e.length)}return e},S=function(e,t,n,r){var i=t+"&"+n+"&"+e+"&"+r;return i=s.MD5(i),i};t.addApi=function(e,n,r,i,s,o){var u={apis:[{api:e,v:n,data:r}],succ:{},error:{},addApi:function(e,t,n,r,i,s){return this.apis.push({api:e,v:t,data:n}),this.succ[e]=i,this.error[e]=s,this},execute:function(e){function n(e){t.getApi(e.api,e.v,e.data,{},this.succ[e.api],this.error[e.api])}if(e&&c.isXhr2())if(1==this.apis.length)n.call(this,this.apis[0]);else{var r=this;t.getApi("","",{apis:r.apis},{},function(e){e.api&&r.error[e.api]&&r.error[e.api].call(this,e)},function(e){e.api&&r.error[e.api]&&r.error[e.api].call(this,e)})}else{var r=this;this.apis.forEach(function(e){n.call(r,e)})}}};return u.succ[e]=s,u.error[e]=o,u}});
define("/base/utils/server/mtop_h5_chunk.js",["zepto","./h5_common"],function(e,t,n){var r=e("zepto"),i=e("./h5_common"),s;t.isXhr2=function(){return undefined===s&&(s=r.ajaxSettings.xhr().upload),s},t.appPath=undefined,t.chunkAjax=function(e,n){var s=r.extend({},e||{});for(key in r.ajaxSettings)s[key]===undefined&&(s[key]=r.ajaxSettings[key]);var o=r.ajaxSettings.xhr(),u,a=function(){o.abort(),u&&clearTimeout(u)},f=0,l=!1,c=function(e){if(l)return;var n=e.substr(f),r=n.search(/\d+/);if(r<0)return;var u=n.match(/\d+/)[0],h=u.length+parseInt(u)+r;if(n.length>=h){l=!0;var p=n.substr(u.length+r,parseInt(u)),d,v;try{d=JSON.parse(p)}catch(m){v=m}var g=s.context;v?(a(),s.error.call(this,v)):i.dealResponse(d,function(e){s.success.call(g,e)},function(e){s.error.call(this,e)},t.appPath,"",!0),f+=h,l=!1}o.responseText.length>=f&&c(o.responseText)};if(!o.upload)return console.log("un support xhr2"),!1;o.onreadystatechange=function(){o.readyState==4?o.status>=200&&o.status<300||o.status==304?c(o.responseText,!0):a():o.readyState==3&&c(o.responseText)},o.open(s.type,s.url,!0);for(name in s.headers)o.setRequestHeader(name,s.headers[name]);return s.timeout>0&&(u=setTimeout(function(){o.onreadystatechange=function(){},o.abort()},s.timeout)),o.send(s.data?s.data:null),o}});
define("/base/utils/server/h5_cache.js",["./h5_memcache","./h5_base"],function(e,t,n){var r={mem:e("./h5_memcache"),local:e("./h5_base")},i=function(e,t){var n=e,i=t||30;this.putExpireValue=function(e,t,i){try{var s={};s.data=t,s.expireTime=Date.now()+parseInt(i),r[n].set(e,JSON.stringify(s))}catch(o){}},this.getExpireValue=function(e){try{var t=r[n].get(e);return t?(t=JSON.parse(t),t.expireTime<Date.now()?(r[n].removeValue(e),null):t.data):null}catch(i){}return null},this.pushValue=function(e,t,s,o){try{if(!e||!t||!s)return!1;o=o||i;if(o<1)return!1;var u=r[n].get(e),a={};a[t]=s;if(!u)return r[n].set(e,"["+JSON.stringify(a)+"]"),!0;u=JSON.parse(u);var f=u.length,l=!1;for(var c=0;c<f;c++){var h=u[c][t];if(h){u[c]=a,l=!0;break}}if(!l){var p=f-o+1;p>0&&(u=u.slice(p,f)),u.push(a)}r[n].set(e,JSON.stringify(u))}catch(d){return!1}return!0},this.popValue=function(e,t){try{var i=r[n].get(e);if(!i)return null;i=JSON.parse(i);var s=i.length;for(var o=0;o<s;o++){var u=i[o][t];if(u)return u}}catch(a){return null}return null}};return i});
define("/base/utils/server/h5_memcache.js",[],function(e,t,n){var r={};t.set=function(e,t){r[e]=t},t.get=function(e){return r[e]},t.removeValue=function(e){delete r[e]}});
define("/mw/webapp/transformer/common/cache.js",["underscore","h5_base","cookie","h5_cache"],function(e,t,n){var r=10,i=e("underscore"),s={itemCacheKey:"allspark_item_key",accountCacheKey:"allspark_account_key",snsFlagCacheKey:"allspark_sns_flag_key",indexTmsCacheKey:"allspark_index_tms_key",feedCountsKey:"allspark_feed_counts_key"},o=e("h5_base"),u=e("cookie"),a=e("h5_cache"),f=new a("local"),l=new a("mem");t.saveIndexTms=function(e){f.putExpireValue(s.indexTmsCacheKey,e,6e5)},t.getIndexTms=function(){return f.getExpireValue(s.indexTmsCacheKey)},t.savePersistent=function(e,t,n){var i=s[e];if(!i)return null;o.isSuppLocalStorage()?f.pushValue(i,t,n,r):u.setCookie(i+"_"+t,n)},t.getPersistent=function(e,t){var n=s[e];return n?o.isSuppLocalStorage()?f.popValue(n,t):u.getCookie(n+"_"+t):null},t.saveSnsFlag=function(e){t.savePersistent("snsFlagCacheKey",e,"1")},t.isCreateSns=function(e){return e&&e.length>1?"1"==t.getPersistent("snsFlagCacheKey",e):!1},t.saveMemData=function(e,t,n,i){var u=s[e];return u?o.isClient()?f.pushValue(u,t,n,i||r):l.pushValue(u,t,n,i||r):null},t.getMemData=function(e,t){var n=s[e];return n?o.isClient()?f.popValue(n,t):l.popValue(n,t):null},t.getAccountById=function(e){return t.getMemData("accountCacheKey",e)},t.saveAccount=function(e,n){return n=i.pick(n,"id","nick","logoUrl","fansCount","accountType"),o.isClient()?t.saveMemData("accountCacheKey",e,n,5):t.saveMemData("accountCacheKey",e,n)},t.getItemById=function(e){return t.getMemData("itemCacheKey",e)},t.saveItem=function(e,n){return t.saveMemData("itemCacheKey",e,n)}});
define("/base/styles/component/slider/js/slider.js",["zepto","../../../../utils/smallCss3/css3"],function(e,t,n){var r=e("zepto"),i=e("../../../../utils/smallCss3/css3"),s=/android/gi.test(navigator.appVersion),o=i.has3d(),u=i.hasTransform(),a=o?"translate3d(":"translate(",f=o?",0)":")";return r.touchSlider=function(e,t){if(!e)return null;t?t.container=e:t=typeof e=="string"?{container:e}:e,r.extend(this,{container:".slider",wrap:null,panel:null,trigger:null,activeTriggerCls:"sel",hasTrigger:!1,steps:0,left:0,visible:1,margin:0,curIndex:0,duration:300,loop:!1,play:!1,interval:5e3,useTransform:!s,lazy:".lazyimg",lazyIndex:1,callback:null,prev:null,next:null,activePnCls:"none"},t),this.findEl()&&this.init()&&this.increaseEvent()},r.extend(r.touchSlider.prototype,{reset:function(e){r.extend(this,e||{}),this.init()},findEl:function(){var e=this.container=r(this.container);return e.length?(this.wrap=this.wrap&&e.find(this.wrap)||e.children().first(),this.wrap.length?(this.panel=this.panel&&e.find(this.panel)||this.wrap.children().first(),this.panel.length?(this.panels=this.panel.children(),this.panels.length?(this.trigger=this.trigger&&e.find(this.trigger),this.prev=this.prev&&e.find(this.prev),this.next=this.next&&e.find(this.next),this):(this.container.hide(),null)):null):null):null},init:function(){var e=this.wrap,t=this.panel,n=this.panels,r=this.trigger,i=this.len=n.length,s=this.margin,o=0,l=this.visible,c=this.useTransform=u?this.useTransform:!1;this.steps=this.steps||e.width(),n.each(function(e,t){o+=t.offsetWidth}),s&&typeof s=="number"&&(o+=(i-1)*s,this.steps+=s),l>1&&(this.loop=!1);var h=this.left;h-=this.curIndex*this.steps,this.setCoord(t,h),c&&(e.css({"-webkit-transform":"translate3d(0,0,0)"}),t.css({"-webkit-backface-visibility":"hidden"}),n.css({"-webkit-transform":a+"0,0"+f}));var p=this._pages=Math.ceil(i/l);this._minpage=0,this._maxpage=this._pages-1,this.loadImg(),this.updateArrow();if(p<=1)return this.getImg(n[0]),r&&r.hide(),null;if(this.loop){t.append(n[0].cloneNode(!0));var d=n[i-1].cloneNode(!0);t.append(d),this.getImg(d),d.style.cssText+="position:relative;left:"+ -this.steps*(i+2)+"px;",o+=n[0].offsetWidth,o+=n[i-1].offsetWidth}t.css("width",o);if(r&&r.length){var v="",m=r.children();if(!m.length){for(var g=0;g<p;g++)v+="<span"+(g==this.curIndex?" class="+this.activeTriggerCls+"":"")+"></span>";r.html(v)}this.triggers=r.children(),this.triggerSel=this.triggers[this.curIndex]}else this.hasTrigger=!1;return this},increaseEvent:function(){var e=this,t=e.wrap[0],n=e.prev,i=e.next,s=e.triggers;t.addEventListener&&(t.addEventListener("touchstart",e,!1),t.addEventListener("touchmove",e,!1),t.addEventListener("touchend",e,!1),t.addEventListener("webkitTransitionEnd",e,!1),t.addEventListener("msTransitionEnd",e,!1),t.addEventListener("oTransitionEnd",e,!1),t.addEventListener("transitionend",e,!1)),e.play&&e.begin(),n&&n.length&&n.on("click",function(t){e.backward.call(e,t)}),i&&i.length&&i.on("click",function(t){e.forward.call(e,t)}),e.hasTrigger&&s&&s.each(function(t,n){r(n).on("click",function(){e.slideTo(t)})})},handleEvent:function(e){switch(e.type){case"touchstart":this.start(e);break;case"touchmove":this.move(e);break;case"touchend":case"touchcancel":this.end(e);break;case"webkitTransitionEnd":case"msTransitionEnd":case"oTransitionEnd":case"transitionend":this.transitionEnd(e)}},loadImg:function(e){e=e||0,e<this._minpage?e=this._maxpage:e>this._maxpage&&(e=this._minpage);var t=this.visible,n=this.lazyIndex-1,r=n+e;if(r>this._maxpage)return;r+=1;var i=(e&&n+e||e)*t,s=r*t,o=this.panels;s=Math.min(o.length,s);for(var u=i;u<s;u++)this.getImg(o[u])},getImg:function(e){if(!e)return;e=r(e);if(e.attr("l"))return;var t=this,n=t.lazy,i="img"+n;n=n.replace(/^\.|#/g,""),e.find(i).each(function(e,t){var i=r(t);src=i.attr("dataimg"),src&&i.attr("src",src).removeAttr("dataimg").removeClass(n)}),e.attr("l","1")},start:function(e){var t=e.touches[0];this._movestart=undefined,this._disX=0,this._coord={x:t.pageX,y:t.pageY}},move:function(e){if(e.touches.length>1||e.scale&&e.scale!==1)return;var t=e.touches[0],n=this._disX=t.pageX-this._coord.x,r=this.left,i;typeof this._movestart=="undefined"&&(this._movestart=!!(this._movestart||Math.abs(n)<Math.abs(t.pageY-this._coord.y))),this._movestart||(e.preventDefault(),this.stop(),this.loop||(n/=!this.curIndex&&n>0||this.curIndex==this._maxpage&&n<0?Math.abs(n)/this.steps+1:1),i=r-this.curIndex*this.steps+n,this.setCoord(this.panel,i),this._disX=n)},end:function(e){if(!this._movestart){var t=this._disX;t<-10?(e.preventDefault(),this.forward()):t>10&&(e.preventDefault(),this.backward()),t=null}},backward:function(e){e&&e.preventDefault&&e.preventDefault();var t=this.curIndex,n=this._minpage;t-=1,t<n&&(this.loop?t=n-1:t=n),this.slideTo(t),this.callback&&this.callback(Math.max(t,n),-1)},forward:function(e){e&&e.preventDefault&&e.preventDefault();var t=this.curIndex,n=this._maxpage;t+=1,t>n&&(this.loop?t=n+1:t=n),this.slideTo(t),this.callback&&this.callback(Math.min(t,n),1)},setCoord:function(e,t){this.useTransform&&e.css("-webkit-transform",a+t+"px,0"+f)||e.css("left",t)},slideTo:function(e,t){e=e||0,this.curIndex=e;var n=this.panel,r=n[0].style,i=this.left-e*this.steps;r.webkitTransitionDuration=r.MozTransitionDuration=r.msTransitionDuration=r.OTransitionDuration=r.transitionDuration=(t||this.duration)+"ms",this.setCoord(n,i),this.loadImg(e)},transitionEnd:function(){var e=this.panel,t=e[0].style,n=this.loop,r=this.curIndex;n&&(r>this._maxpage?this.curIndex=0:r<this._minpage&&(this.curIndex=this._maxpage),this.setCoord(e,this.left-this.curIndex*this.steps)),!n&&r==this._maxpage?(this.stop(),this.play=!1):this.begin(),this.update(),this.updateArrow(),t.webkitTransitionDuration=t.MozTransitionDuration=t.msTransitionDuration=t.OTransitionDuration=t.transitionDuration=0},update:function(){var e=this.triggers,t=this.activeTriggerCls,n=this.curIndex;e&&e[n]&&(this.triggerSel&&(this.triggerSel.className=""),e[n].className=t,this.triggerSel=e[n])},updateArrow:function(){var e=this.prev,t=this.next;if(!e||!e.length||!t||!t.length)return;if(this.loop)return;var n=this.curIndex,r=this.activePnCls;n<=0&&e.addClass(r)||e.removeClass(r),n>=this._maxpage&&t.addClass(r)||t.removeClass(r)},begin:function(){var e=this;e.play&&!e._playTimer&&(e.stop(),e._playTimer=setInterval(function(){e.forward()},e.interval))},stop:function(){var e=this;e.play&&e._playTimer&&(clearInterval(e._playTimer),e._playTimer=null)},destroy:function(){var e=this,t=e.wrap[0],n=e.prev,i=e.next,s=e.triggers;t.removeEventListener&&(t.removeEventListener("touchstart",e,!1),t.removeEventListener("touchmove",e,!1),t.removeEventListener("touchend",e,!1),t.removeEventListener("webkitTransitionEnd",e,!1),t.removeEventListener("msTransitionEnd",e,!1),t.removeEventListener("oTransitionEnd",e,!1),t.removeEventListener("transitionend",e,!1)),n&&n.length&&n.off("click"),i&&i.length&&i.off("click"),e.hasTrigger&&s&&s.each(function(e,t){r(t).off("click")})}}),r.touchSlider.cache=[],r.fn.slider=function(e){return this.each(function(t,n){n.getAttribute("l")||(n.setAttribute("l",!0),r.touchSlider.cache.push(new r.touchSlider(n,e)))})},r.touchSlider.destroy=function(){var e=r.touchSlider.cache,t=e.length;if(t<1)return;for(var n=0;n<t;n++)e[n].destroy();r.touchSlider.cache=[]},r.touchSlider});
define("/base/utils/smallCss3/css3.js",[],function(e,t,n){function f(e,t){return typeof e===t}function l(e,t){for(var n in e)if(a[e[n]]!==undefined)return t=="pfx"?e[n]:!0;return!1}function c(e,t,n){var r=e.charAt(0).toUpperCase()+e.substr(1),i=(e+" "+u.join(r+" ")+r).split(" ");if(f(t,"string")||f(t,"undefined"))return l(i,t)}var r={},i=document.documentElement,s="modernizr",o=function(e,t,n,r){var o,u,a,f=document.createElement("div"),l=document.body,c=l?l:document.createElement("body");if(parseInt(n,10))while(n--)a=document.createElement("div"),a.id=r?r[n]:s+(n+1),f.appendChild(a);return o=["&#173;",'<style id="s',s,'">',e,"</style>"].join(""),f.id=s,(l?f:c).innerHTML+=o,c.appendChild(f),l||(c.style.background="",i.appendChild(c)),u=t(f,e),l?f.parentNode.removeChild(f):c.parentNode.removeChild(c),!!u},u="Webkit Moz O ms".split(" "),a=i.style;return r.hasTransform=function(){return!!c("transform")},r.has3d=function(){var e=!!c("perspective");return e&&"webkitPerspective"in i.style&&o("@media (transform-3d),(-webkit-transform-3d){#modernizr{left:9px;position:absolute;height:3px;}}",function(t,n){e=t.offsetLeft===9&&t.offsetHeight===3}),e},r});
define("/base/styles/component/pagenav/js/pagenav.js",["zepto"],function(e){var t=e("zepto"),n=function(t){this.init(t)};return n.prototype={setIndex:function(e){var t=this;e=Number(e),isNaN(e)&&(e=1),e>t.pageCount&&(e=t.pageCount),e<=0&&(e=1),t.index=e,t.renderPage()},init:function(e){this.$container||(this.$container=t(e.id)),this.index=Number(e.index?e.index:1),this.pageCount=Number(e.pageCount?e.pageCount:1),this.preFix=e.preFix?e.preFix:"!page/",this.objId=e.objId?e.objId:"Z",this.disableHash=e.disableHash,this.oldIndex=-1;var n=this.preFix.toString().length;this.preFix[n-1]!="/"&&(this.preFix+="/"),isNaN(this.index)&&(this.index=1),this.index>this.pageCount&&(this.index=this.pageCount),this.index<=0&&(this.index=1),this.createDom(),this.eventAttach(),this.parseHash(),this.renderPage()},parseHash:function(){var e=this,t=location.hash,n=t.substr(t.lastIndexOf("/")+1),r=[],i=0,s=[];r=n.split("-");for(var o=0;o<r.length;o++){s=r[o].split("");var u=s.shift();if(u==this.objId){i=Number(s.join(""));if(isNaN(i)||i<=0)e.index=1;i>e.pageCount&&(e.index=e.pageCount),e.index=i}}},setContainer:function(e){this.$container=t(e)},getObjId:function(){return this.objId},changeHash:function(){var e=this,t=location.hash;if(t=="")location.hash=e.preFix+"-"+e.objId+e.index;else{var n=t.lastIndexOf(e.objId),r=n;if(n==-1)location.hash+="-"+e.objId+e.index;else{for(;;){r++;if(t[r]=="-"||!t[r])break}t=t.replace(t.substring(n,r),e.objId+e.index),location.hash=t}}},createDom:function(){var e=this;e.$container.empty();var n=['<section class="c-p-sec">','<div class="c-p-pre">','<span class="c-p-p">',"<em></em>","</span><a>上一页</a>","</div>",'<div class="c-p-cur">','<div class="c-p-arrow c-p-down"><span></span><span></span></div>','<select class="c-p-select">',"</select></div>",'<div class="c-p-next">','<a>下一页</a><span class="c-p-p">',"<em></em>","</span>","</div>","</section>"];e.$container.html(n.join("")),t("select",e.$container).empty(),n=[];for(var r=1;r<=e.pageCount;r++)n[r-1]="<option>第"+r+"页</option>";t("select",e.$container).append(n.join(""))},renderPage:function(){var e=this,n=t("option",e.$container).length,r=t(".c-p-pre",e.$container),i=t(".c-p-next",e.$container);n<=1?(r.addClass("c-p-grey"),i.addClass("c-p-grey"),n=1):e.index==1?(r.addClass("c-p-grey"),n>1&&i.removeClass("c-p-grey")):e.index==n?(i.addClass("c-p-grey"),n>1&&r.removeClass("c-p-grey")):e.index>1&&e.index<n&&(r.removeClass("c-p-grey"),i.removeClass("c-p-grey"));var s=e.index+"/"+n;t(".c-p-arrow span:first-child",e.$container).text(s),t("select",e.$container).get(0).selectedIndex=this.index-1,r=null,i=null},eventDetach:function(){var e=this,n=t(e.$container);n.undelegate("select","mousedown",e.modifyArr),n.undelegate("select","blur",e.blur),n.find(".c-p-pre").undelegate("a","click",e.lastPage),n.find(".c-p-next").undelegate("a","click",e.nextPage),n.undelegate("select","change",e.selectChange),n=null},eventAttach:function(){var e=this,n=t(e.$container);n.delegate("select","mousedown",e.modifyArr=function(n){t(".c-p-arrow",e.$container).removeClass("c-p-down").addClass("c-p-up")}),n.delegate("select","blur",e.blur=function(n){t(".c-p-arrow",e.$container).removeClass("c-p-up").addClass("c-p-down")}),n.find(".c-p-pre").delegate("a","click",e.lastPage=function(n){n.preventDefault();if(t(this).parent().hasClass("c-p-grey"))return!1;e.index--,e.renderPage(),e.disableHash?e.$container.trigger("P:switchPage",{index:e.index,type:"pre"}):e.changeHash(),e.oldIndex=e.index}),n.find(".c-p-next").delegate("a","click",e.nextPage=function(n){n.preventDefault();if(t(this).parent().hasClass("c-p-grey"))return!1;e.index++,e.renderPage(),e.disableHash?e.$container.trigger("P:switchPage",{index:e.index,type:"next"}):e.changeHash(),e.oldIndex=e.index}),n.delegate("select","change",e.selectChange=function(){e.index=t(this).get(0).selectedIndex+1;if(e.oldIndex==e.index)return;e.renderPage(),t(".c-p-arrow",e.$container).removeClass("c-p-up").addClass("c-p-down"),e.disableHash?e.$container.trigger("P:switchPage",{index:e.index,type:"select"}):e.changeHash(),e.oldIndex=e.index})},pContainer:function(){return this.$container}},n});
define("/mw/webapp/transformer/ui/notification.js",["zepto","./effect.js"],function(e,t,n){var r=e("zepto"),i=e("./effect.js"),s=r("#notification"),o=s.find(".actions"),u=s.find(".long-message"),a=s.find(".simple-message");return{show:function(){s.fadeIn(100)},hide:function(){s.fadeOut(200)},position:function(){s.css("opacity","0").show(),s.css("top",window.innerHeight/2-s.height()/2),s.hide()},message:function(e,t){s.off(),o.hide(),u.hide(),a.html(e).show(),this.position(),this.show();var n=this;t||setTimeout(function(){n.hide()},1200)},alert:function(e,t){var n=this;s.off(),o.show(),u.hide(),a.html(e).show(),o.find(".btn-wrap").hide(),o.find(".btn-wrap").last().show(),s.on("click",".retry",function(){n.hide(),t&&t()}),this.position(),this.show()},confirm:function(e,t,n){},external:function(e,t,n){var r=this;s.off(),o.find(".btn-wrap").show(),o.find(".btn-wrap").last().hide(),o.show(),a.hide(),u.find(".external").attr("href",e).text(e),u.show(),s.on("click",".confirm",function(){r.hide(),t&&t()}),s.on("click",".cancel",function(){r.hide(),n&&n()}),this.position(),this.show()}}});
define("/mw/webapp/transformer/ui/effect.js",["zepto"],function(e,t,n){function f(e,t,n,i,s){typeof t=="function"&&!s&&(s=t,t=undefined);var o={opacity:n};return i&&(o.scale=i,e.css(r.fx.cssPrefix+"transform-origin","0 0")),e.animate(o,t,null,s)}function l(e,t,n,i){return f(e,t,0,n,function(){u.call(r(this)),i&&i.call(this)})}var r=e("zepto"),i=window.document,s=i.documentElement,o=r.fn.show,u=r.fn.hide,a=r.fn.toggle;r.fn.show=function(e,t){return o.call(this),e===undefined?e=0:this.css("opacity",0),f(this,e,1,"1,1",t)},r.fn.hide=function(e,t){return e===undefined?u.call(this):l(this,e,"0,0",t)},r.fn.toggle=function(e,t){return e===undefined||typeof e=="boolean"?a.call(this,e):this.each(function(){var n=r(this);n[n.css("display")=="none"?"show":"hide"](e,t)})},r.fn.fadeTo=function(e,t,n){return f(this,e,t,null,n)},r.fn.fadeIn=function(e,t){var n=this.css("opacity");return n>0?this.css("opacity",0):n=1,o.call(this).fadeTo(e,n,t)},r.fn.fadeOut=function(e,t){return l(this,e,null,t)},r.fn.fadeToggle=function(e,t){return this.each(function(){var n=r(this);n[n.css("opacity")==0||n.css("display")=="none"?"fadeIn":"fadeOut"](e,t)})}});
define("/mw/webapp/transformer/ui/loading.js",["zepto"],function(e,t,n){window.$=e("zepto");var r=$("#loading");return{show:function(){this.position(),r.show()},hide:function(){r.hide()},position:function(){r.css("opacity","0").show(),r.css("top",window.innerHeight/2),r.hide().css("opacity","1")}}});
define("/mw/webapp/transformer/common/favUtils.js",["h5_comm","../ui/notification.js","../common/cache.js","./mtopForAllspark"],function(e,t,n){var r=e("h5_comm"),i=e("../ui/notification.js"),s=e("../common/cache.js"),o=e("./mtopForAllspark"),u=function(e,t){var n=s.getItemById(e);n&&n.isLiked&&(n.isLiked=t,s.saveItem(e,n))};t.favbtn=function(e,t,n){if(!r.isLogin()){r.goLogin({rediUrl:"h5_allSpark",hideType:"close"});return}var s=n+"_"+t;e.hasClass("faved")?o.favoriteRemoveFeed({feedId:t,snsId:n},function(t){t.fail?i.message("服务器在偷懒，再试试吧！"):(e.removeClass("faved"),e.attr("data-log","addfav"),i.message("已取消收藏！"),u(s,"0"))}):o.favoriteAddFeed({feedId:t,snsId:n},function(t){if(t.fail){var n=t.fail.split("::");n.length>1?(i.message(n[1]),"FAIL_BIZ_SNS_FAVORITE_ALREADY_FAVORITE"==n[0]&&(e.addClass("faved"),e.attr("data-log","cancelfaved"))):i.message("服务器在偷懒，再试试吧！")}else e.addClass("faved"),e.attr("data-log","cancelfaved"),i.message("收藏成功！"),u(s,"1")})}});
define("/mw/webapp/transformer/account/accountView.js",["backbone","zepto","underscore","./accountModel","../../../../base/styles/component/pagenav/js/pagenav.js","h5_comm","../ui/loading","../ui/notification.js","../common/mtopForAllspark.js","../common/favUtils.js"],function(e,t,n){var r=e("backbone"),i=e("zepto"),s=e("underscore"),o=e("./accountModel"),u=e("../../../../base/styles/component/pagenav/js/pagenav.js"),a=e("h5_comm"),f=e("../ui/loading"),l=e("../ui/notification.js"),c=e("../common/mtopForAllspark.js"),h=e("../common/favUtils.js"),p=r.View.extend({el:"#content",events:{"click .tb-feed-items .jsItem":"goToDetail","click #accountPage .J_info .stats-follow-btn":"follow","click .navbar .refresh.account":"refresh","click #accountPage .favbtn":"favbtn","click #accountPage .wwwIco":"goWWW"},backURL:"",afterTimestamp:"",before:!1,initialize:function(){var e=this;e._pageSize=15,e.afterTimestamp=(new Date).getTime(),e.accountModel=new o,e.accountModel.on("change:accInfo",function(e,t){if(t&&t.fail){l.message("服务异常，请稍后再试！");return}t&&i("#accountPage .J_info").html()==""&&(typeof t.logoUrl=="undefined"&&(t.logoUrl=""),i("#accountPage .J_info").html(s.template(i("#accountinfo_tpl").html(),t)));if(t){t.followed=="false"?i("#accountPage .stats-follow-btn").html("关注").attr("class","stats-follow-btn log"):i("#accountPage .stats-follow-btn").html("取消关注").attr("class","stats-follow-btn followed log");var n='<div class="default">';t.logoUrl&&(n+='<img class="avatar lazy" dataimg="'+getImgUrl(t.logoUrl,100,60),n+='src="http://a.tbcdn.cn/mw/webapp/fav/img/grey.gif">'),n+='</div><p class="name">'+t.nick+"</p>",i("#accountPage li a.account").children.length==0&&i("#accountPage li a.account").html(n)}}),e.accountModel.on("change:accFeeds",function(t,n){setTimeout(function(){i(".navbar .refresh .btn div").removeClass("spinner")},2e3);if(n&&n.fail){i("#accountPage .J_feed .tb-feed-items").html(""),l.message("服务异常，请稍后再试！");return}var r=!0;if(e.oldTotalCount&&e.oldTotalCount.snsid==e.snsid){var o=parseInt(n.totalCount)-parseInt(e.oldTotalCount.count);o>0&&e.curPage==1?l.message("更新了 "+o+" 条广播"):e.oldTotalCount.curPage==e.curPage&&(r=!1),e.oldTotalCount.count=n.totalCount,e.oldTotalCount.curPage=e.curPage}e.oldTotalCount={snsid:e.snsid,count:n.totalCount,curPage:e.curPage};var a=Math.ceil(n.totalCount/e._pageSize);a>1&&(e.pageNav=new u({id:"#feedPageNav",index:e.curPage,pageCount:a,pageSize:e._pageSize,disableHash:"true"}),e.pageNav.pContainer().on("P:switchPage",function(t,n){e.changePage(n.index)}));if(n.totalCount==0){i("#accountPage .J_feed .tb-feed-items").html(""),l.message("商家很懒还没发消息哦！");return}if(n.list&&n.list.length>0&&r){e.accountModel.get("accInfo")&&i("#accountPage .J_feed .tb-feed-items").html(s.template(i("#tbfeed_tpl").html(),e.reconFeedListData(n)));if(e.accountModel.get("accInfo").nick!=""){var f='<div class="default">',c=e.accountModel.get("accInfo");c.logoUrl&&(f+='<img class="avatar lazy" dataimg="'+getImgUrl(c.logoUrl,100,60),f+='src="http://a.tbcdn.cn/mw/webapp/fav/img/grey.gif">'),f+='</div><p class="name">'+c.nick+"</p>",i("#accountPage li a.account").children.length==1&&i("#accountPage li a.account").html(f)}window.lazyload.reload(),setTimeout(function(){},100)}}),e.accountModel.on("change:prices",function(e,t){if(t&&t.fail){l.message("服务异常，请稍后再试！");return}if(t&&t.prices.length>0)for(var n=0;n<t.prices.length;n++)i(".it"+t.prices[n].id).append('<div class="price">'+t.prices[n].price+"元</div>")})},favbtn:function(e){var t=i(e.currentTarget),n=t.parent();h.favbtn(t,n.attr("feedid"),n.attr("snsid"))},render:function(e,t){var n=this;i.trim(i("#accountPage .J_feed .tb-feed-items").html()).length==0&&i("#accountPage .J_feed .tb-feed-items").html('<div class="loading"><span class="spinner"></span></div>'),n.snsid=e,n.curPage=parseInt(t),t==1&&(n.before=!1),e!=i("#accountPage").attr("snsid")&&(i("#accountPage").attr("snsid",e),i("#accountPage .J_info").html(""),i("#accountPage .J_feed .tb-feed-items").html('<div class="loading"><span class="spinner"></span></div>')),i("header.navbar").html("");if(n.oldTotalCount)if(n.oldTotalCount.snsid==n.snsid){var r=Math.ceil(n.oldTotalCount.totalCount/n._pageSize);r>1&&(n.pageNav=new u({id:"#feedPageNav",index:n.curPage,pageCount:r,pageSize:n._pageSize,disableHash:"true"}),n.pageNav.pContainer().on("P:switchPage",function(e,t){n.changePage(t.index)}))}else i("#feedPageNav").html("");var o=i("header.navbar"),a=i("#accountPage"),f={backUrl:"",backTitle:"返回"};typeof window.AccountList!="undefined"?(f={backUrl:"#"+window.AccountList.hash,backTitle:"返回"},window.AccountList.flag=!1,delete window.AccountList):n.backURL!=""?f={backUrl:n.backURL,backTitle:"返回"}:f={backUrl:"#index",backTitle:"返回"},o.html(s.template(i("#navBack_tpl").html(),f)+i("#accountTitle_tpl").html()),o.hasClass("iT")&&o.removeClass("iT").addClass("iC");var l=i(".view-page.show");i("#detailPage").hasClass("show")?(a.removeClass(" iR iL").addClass("iL"),l.removeClass("show iC").addClass("iR").wAE(function(){l.addClass("hide")})):a.hasClass("show")||l.removeClass("show iC").addClass("iL").wAE(function(){l.addClass("hide")}),a.removeClass("hide"),setTimeout(function(){a.removeClass(" iR iL").addClass("show iC")},0),window.scrollTo(0,1),n.accountModel.getPageData({snsId:n.snsid,curPage:n.curPage,pageSize:n._pageSize,afterTimestamp:n.afterTimestamp,before:n.before}),i("#content")[0].style.minHeight="360px"},refresh:function(){var e=this,t=i(".navbar .refresh .btn div");t.hasClass("spinner")||t.addClass("spinner"),e.afterTimestamp=(new Date).getTime(),e.curPage=="1"?e.accountModel.getPageData({exCludInfo:!1,snsId:e.snsid,curPage:e.curPage,before:!1,pageSize:e._pageSize,afterTimestamp:(new Date).getTime()}):window.location.hash="#account/"+e.snsid+"/1"},goWWW:function(e){var t=this,n=i(e.currentTarget),r="";n.attr("url")!=""&&(n.attr("url").indexOf("?")==-1?r=n.attr("url")+"?ap_ref="+encodeURIComponent(window.location.href):r=n.attr("url")+"&ap_ref="+encodeURIComponent(window.location.href)),n.attr("linkUrlIsExt")=="true"?l.external(n.attr("url"),function(){window.open(r,"_blank")},null):n.attr("url")!=""&&(window.location.href=r)},goBackHome:function(){typeof window.AccountList!="undefined"?(window.AccountList.flag=!1,window.location.hash=window.AccountList.hash):window.history.back()},follow:function(e){var t=this,n=i(e.currentTarget);a.isLogin()?n.hasClass("followed")?(n.html("取消关注"),c.removeAccount(n.attr("pid"),function(e){if(e.data.result)for(var r=e.data.result.length,i=0;i<r;i++)n.attr("pid")==e.data.result[i].id&&(e.data.result[i].isSuccess=="true"?(n.html("关注"),n.removeClass("followed"),n.attr("data-log","attention"),t.showFans(-1)):(l.message("取消关注失败！"),n.html("取消关注")))},function(){l.message("取消关注失败！"),n.html("取消关注")})):(n.html("关注中..."),c.addAccount(n.attr("pid"),function(e){if(e.data.result)for(var r=e.data.result.length,i=0;i<r;i++)n.attr("pid")==e.data.result[i].id&&(e.data.result[i].isSuccess=="true"?(n.addClass("followed"),n.attr("data-log","cancelattention"),n.html("取消关注"),t.showFans(1)):(l.message("关注失败！"),n.html("关注")))},function(){l.message("关注失败！"),n.html("关注")})):a.goLogin({rediUrl:"h5_allSpark",hideType:"close"})},showFans:function(e){var t=i(".stats-count").text();t.indexOf("万")==-1&&t.indexOf("亿")==-1&&i(".stats-count").text(parseInt(t)+e)},changePage:function(e){var t=this;parseInt(t.curPage)<parseInt(e)?t.before=!0:t.before=!1,i("#accountPage .J_feed .tb-feed-items").html('<div class="loading"><span class="spinner"></span></div>'),window.location.hash="#account/"+t.snsid+"/"+e,t.backURL=i(".navbar .back a").attr("href")},goToDetail:function(e){var t=i(e.currentTarget).parent(),n=this;changeHash("#detail/"+i(".tb-profile").attr("snsid")+"/"+t.attr("feedid")+"/"+n.curPage,"account")},reconAccInfoData:function(e){var t=e;return t},reconFeedListData:function(e){var t=this,n=e;for(var r=0;r<n.list.length;r++)n.list[r].commentCount||(n.list[r].commentCount=0);return n}});return p});
define("/mw/webapp/transformer/account/accountModel.js",["backbone","underscore","../common/mtopForAllspark.js","../common/cache.js","../common/refine.js"],function(e,t,n){var r=e("backbone"),i=e("underscore"),s=e("../common/mtopForAllspark.js"),o=e("../common/cache.js"),u=e("../common/refine.js");return r.Model.extend({_biz:{info:function(e,t){s.info(e,t)},feeds:function(e,t){e.before?s.listBefore(e,t):s.readAndListAfter(e,t),delete e.before}},getPageData:function(e){var t=this;e.exCludInfo||t._biz.info({snsId:e.snsId,sid:e.sid},function(n){u.refinePubAccount(n),t.set({accInfo:n,silent:!0}),t.trigger("change:accInfo"),o.saveAccount(e.snsId,n),t.set("loaded","1")}),e||(e={});var n=i.clone(s.pageParam);i.extend(n,e),n.isIndex()&&(n.before=!1),t._biz.feeds(n,function(e){e.totalCount&&e.list&&e.list.forEach(function(e){}),u.refineFeed(e);if(e.fail){t.set("accFeeds",e);return}e.a=(new Date).getTime(),t.set("accFeeds",e);var n=[];e.totalCount&&e.list&&e.list.forEach(function(e){e.coverTile&&e.coverTile.item&&e.coverTile.item.id&&n.push(e.coverTile.item.id)}),s.getPrices(i.uniq(n),function(e){e.length&&t.set("prices",{prices:e,t:(new Date).getTime()})}),t.set("loaded","1")})}})});
define("/mw/webapp/transformer/common/refine.js",["uriBroker","cdn"],function(e){var t=e("uriBroker"),n=e("cdn");return{refinePubAccount:function(e){e.id=e.id===undefined?0:e.id,e.nick=e.nick||"",e.description=e.description||"",e.url=e.url||"",e.urlTitle=e.urlTitle||"",e.wangwang=e.wangwang||"",e.backgroundImg=e.backgroundImg||"",e.fansCount=e.fansCount===undefined?0:e.fansCount,e.accountType=e.accountType===undefined?0:e.accountType},refineRecommend:function(e){var t=this;e.list&&e.list.forEach(function(e){t.refinePubAccount(e)})},refineFeed:function(e){var t=this;e.list&&e.list.forEach(function(e){t.refineFeedListItem(e)})},refineFeedListItem:function(e){var t=this;e.coverTile&&t.refineFeedTile(e.coverTile),e.id=e.id===undefined?0:e.id,e.layout=e.layout||"",e.title=e.title||"",e.linkTitle=e.linkTitle||"",e.linkUrl=e.linkUrl||"",e.commentCount=e.commentCount===undefined?0:e.commentCount,e.time=e.time===undefined?0:e.time},refineFeedTile:function(e){var t=this;typeof e.type=="undefined"&&(e.type=""),e.text=e.text||"",e.path=e.path||"",e.item&&t.refineFeedItem(e.item)},refineFeedItem:function(e){e.id=e.id===undefined?0:e.id},refineComment:function(e){e.id=e.id===undefined?0:e.id,e.content=e.content||"",e.createrId=e.createrId===undefined?0:e.createrId,e.createrName=e.createrName||"",e.createrPic=e.createrPic||"",e.time=e.time===undefined?0:e.time},refineAccountFeed:function(e){this.refinePubAccount(e.account),this.refineFeed(e.firstFeed),e.unreadCount=e.unreadCount===undefined?0:e.unreadCount},refinePagination:function(e){e.curPage=e.curPage===undefined?0:e.curPage,e.pageSize=e.pageSize===undefined?0:e.pageSize,e.direction=e.direction===undefined?0:e.direction,e.timestamp=e.timestamp===undefined?0:e.timestamp},refinePaginationResult:function(e,t){e.totalCount=e.totalCount===undefined?0:e.totalCount,e.list.forEach(t),e.timestamp=e.timestamp===undefined?0:e.timestamp},refineOperationResult:function(e){e.id=e.id===undefined?0:e.id,e.isSuccess=!!e.isSuccess,e.errorCode=e.errorCode||""},refineBatOperationResult:function(e){e.isAllSuccess=!!e.isAllSuccess,e.list.forEach(this.refineOperationResult)},refineDetail:function(e){e.title=e.title||"",e.linkUrl=e.linkUrl||"",e.tiles=e.tiles||[],e.time=e.time||""}}});
define("/mw/webapp/transformer/detail/detailView.js",["backbone","zepto","underscore","./detailModel","cdn","h5_base","uriBroker","../ui/loading","../common/favUtils.js","../ui/notification.js"],function(e,t,n){var r=e("backbone"),i=e("zepto"),s=e("underscore"),o=e("./detailModel"),u=e("cdn"),a=e("h5_base"),f=e("uriBroker"),l=e("../ui/loading"),c=e("../common/favUtils.js"),h=e("../ui/notification.js"),p=s.template(i("#detail_header_tpl").html()),d=s.template(i("#detail_accinfo_tpl").html()),v=s.template(i("#detail_content_tpl").html());getBetterImg=u.getBetterImg,getItemDetailUrl=function(e,t){var n=f.getUrl(e,t);return n.indexOf("?")==-1?n=n+"?ap_ref="+encodeURIComponent(window.location.href):n=n+"&ap_ref="+encodeURIComponent(window.location.href),n};var m=r.View.extend({el:"#content",model:new o,events:{"click  .to-comment-list":"commentList","click  .more-content":"more","click #detailPage .brand":"toAccountPage","click #detailPage .favbtn":"favbtn"},initialize:function(){this.$container=i("#detailPage"),this.model.on("change:feed",this.renderDetail,this),this.model.on("change:accInfo",this.renderAccInfo,this),this.model.on("change:prices",this.renderPrices,this),typeof wetao!="undefined"&&wetao.addTimer("detail_init")},favbtn:function(e){var t=this;c.favbtn(i(e.currentTarget),t.feedId,t.snsId)},goDetail:function(e,t,n){this.$container.find(".main").empty(),(!a.isClient()||a.isAndroidClient())&&this.$container.find(".main").html('<div class="loading"><span class="spinner"></span></div>');var r=this;r.snsId=e,r.feedId=t,r.page=n,window.scrollTo(0,1);var s=i("header.navbar"),o=i("#detailPage");s.html(p({href:"#account/"+this.snsId+"/"+this.page})),this.commentModel&&this.commentModel.get("commentCount")&&this.commentModel.trigger("change:commentCount"),s.hasClass("iT")&&s.removeClass("iT").addClass("iC"),Env.isDesktop&&s.hide();var u=i(".view-page.show");(a.isClient()||a.isAndroidClient())&&o.removeClass(" iR iL");var f=i("#commentListPage");f.hasClass("show")?(o.removeClass(" iR iL").addClass("iL"),u.removeClass("show iC").addClass("iR").wAE(function(){u.addClass("hide")})):u.attr("id")!="detailPage"&&u.removeClass("show iC").addClass("iL").wAE(function(){u.addClass("hide")}),o.removeClass("hide"),setTimeout(function(){o.removeClass(" iR iL").addClass("show iC")},0),r.model.getPageData({snsId:e,feedId:t}),this.commentModel&&this.commentModel.getCommentCount({snsId:e,feedId:t})},renderAccInfo:function(){var e=this.$container.find(".account .follow");if(e.length<1||e.attr("snsid")!=this.snsId){var t=i.extend(this.model.get("accInfo"),{snsId:this.snsId}),n=d(t);this.$container.find(".account").html(n)}typeof wetao!="undefined"&&wetao.addTimer("renderAccInfo")},renderDetail:function(){var e=this,t=this.model.get("feed");!a.isClient()||a.isAndroidClient();if(t&&t.fail){var n=t.errMsg||"加载失败，稍后重试！";this.$container.find(".main").html('<br /><center style="color:#999">'+n+"</center>");return}var r=v(t);this.$container.find(".main").html(r);if(a.isClient()||a.isAndroidClient())i("div.favbtn").hide(),i("#detailPage .main h1").css("padding-right","0");var s=parseInt(t.commentCount);s>99&&(s="99+"),i(".comment .btn span").text(s),t.isLiked=="1"?i(".favs").addClass("faved"):i(".favs").removeClass("faved"),window.lazyload.reload(),i("#content")[0].style.minHeight="360px",i("#detailPage")[0].style.minHeight="500px",typeof wetao!="undefined"&&wetao.addTimer("renderDetail")},renderComentCount:function(){var e=this.commentModel.get("commentCount").count;e>99&&(e="99+"),i(".comment .btn span").text(e)},more:function(e){e.preventDefault();var t=this.model.get("feed"),n=t.linkUrl,r=t.linkUrlIsExt;if(a.isClient()){window.location=n;return}r=="true"?h.external(n,function(){window.open(n,"_blank")}):window.location=n},toAccountPage:function(e){a.isClient()?(e.preventDefault(),location.href=location.protocol+"//"+location.hostname+location.pathname+"#account/"+this.snsId+"/"+this.page):Env.isDesktop||window.changeHash("#account/"+this.snsId,"detail")},renderPrices:function(){var e=this.$container.find(".media .item"),t=this.model.get("prices");if(!t)return;for(var n=0;n<e.length;n++){var r=e.eq(n),i=r.attr("data-id");for(var s=0;s<t.length;s++)if(i==t[s].id){r.find(".price").text(t[s].price+"元").show();break}}},commentList:function(){var e="comment/"+this.snsId+"/"+this.feedId+"/1";changeHash(e,"detail")}});return m});
define("/mw/webapp/transformer/detail/detailModel.js",["backbone","underscore","../common/mtopForAllspark.js","../common/cache.js","h5_comm","../common/refine.js"],function(e,t,n){var r=e("backbone"),i=e("underscore"),s=e("../common/mtopForAllspark.js"),o=e("../common/cache.js"),u=e("h5_comm"),a=e("../common/refine.js");return r.Model.extend({linkUrlFormat:function(e){if(e&&e.indexOf("detail.tmall.com")!=-1){var t=e.match(/id=[\d]+/);t=t&&t[0].split("=");if(t&&t.length>1)return"http://a.m.tmall.com/i"+t[1]+".htm"}return e},getPageData:function(e){function n(e){var n=[];e.tiles&&e.tiles.forEach(function(e){e.item&&n.push(e.item.id)}),s.getPrices(i.uniq(n),function(e){e.length&&t.set({prices:e},{silent:!0}),t.trigger("change:prices")})}var t=this,r=o.getAccountById(e.snsId);r?t.set("accInfo",r):s.info({snsId:e.snsId},function(n){a.refinePubAccount(n),t.set("accInfo",n),o.saveAccount(e.snsId,n)});var u=o.getItemById(e.snsId+"_"+e.feedId);if(u&&u.title&&u.tiles&&u.tiles.length>0){t.set("feed",u),t.trigger("change:feed"),n(u,e);return}s.detail(e||{},function(r){i.isEmpty(r)?t.set("feed",{fail:"null",errMsg:"抱歉,该广播已删除或不存在！",t:(new Date).getTime()}):r.fail?t.set("feed",r):(a.refineDetail(r),t.set("feed",r),r.linkUrl=t.linkUrlFormat(r.linkUrl),r&&r.tiles&&r.tiles.length>0&&(o.saveItem(e.snsId+"_"+e.feedId,r),n(r,e)))})}})});
define("/mw/webapp/transformer/accountList/accountListView.js",["backbone","zepto","underscore","./accountListModel","h5_comm","../../../../base/styles/component/pagenav/js/pagenav.js","../ui/notification.js","../ui/loading","../common/mtopForAllspark.js"],function(e,t,n){var r=e("backbone"),i=e("zepto"),s=e("underscore"),o=e("./accountListModel"),u=e("h5_comm"),a=e("../../../../base/styles/component/pagenav/js/pagenav.js"),f=e("../ui/notification.js"),l=e("../ui/loading"),c=e("../common/mtopForAllspark.js"),h=r.View.extend({el:"#content",events:{"click .tab-bar li":"changeTab","click #accountListPage .person-list li .content":"goToAccount","click #accountListPage .followbtn":"follow"},initialize:function(){var e=this;e.pageSize=15,e.accountListModel=new o,e.accountListModel.on("change:myAttention",function(t,n){if(n&&n.fail){i("#accountListPage .person-list").html(""),f.message("服务异常，请稍后再试！");return}var r=Math.ceil(n.totalCount/e.pageSize);r<e.curPage&&e.changePage(r),n.list&&n.list.length>0?(i("#accountListPage .person-list").html(s.template(i("#myList_tpl").html(),n)),window.lazyload.reload(),r>1&&(e.myPageNav=new a({id:"#accountListPageNav",index:e.curPage,pageCount:r,pageSize:e.pageSize,disableHash:"true"}),e.myPageNav.pContainer().on("P:switchPage",function(t,n){e.changePage(n.index)}))):i("#accountListPage .person-list").html('<div class="empty">还没有关注任何帐号哦</div>')}),e.accountListModel.on("change:recommends",function(t,n){if(n&&n.fail){i("#accountListPage .person-list").html(""),f.message("服务异常，请稍后再试！");return}var r=Math.ceil(n.totalCount/e.pageSize);r<e.curPage&&e.changePage(r),n.list&&n.list.length>0?(i("#accountListPage .person-list").html(s.template(i("#personList_tpl").html(),n)),window.lazyload.reload(),i("#accountListPageNav").html(""),r>1&&(e.recPageNav=new a({id:"#accountListPageNav",index:e.curPage,pageCount:r,pagesize:e.pageSize,disableHash:"true"}),e.recPageNav.pContainer().on("P:switchPage",function(t,n){e.changePage(n.index)}))):i("#accountListPage .person-list").html('<div class="empty">您已经关注所有帐号了</div>')}),e.accountListModel.on("change:loaded",function(e,t){l.hide(),e.set("loaded","0")})},render:function(e,t){var n=this;l.show(),n.status=e,n.curPage=parseInt(t),i(".navbar .back").unbind("click");var r=i("header.navbar");r.html(s.template(i("#navBack_tpl").html(),{backUrl:"#index",backTitle:"微淘"})+i("#accountListTabBar_tpl").html()),window.scrollTo(0,1),i(".tab-bar li.cur").removeClass("cur"),i(".tab-bar li").eq(n.status-1).addClass("cur"),i("#accountListPage .person-list").html('<div class="loading"><span class="spinner"></span></div>'),i("#accountListPageNav").html(""),n.accountListModel.getPageData({type:n.status,curPage:n.curPage,pageSize:n.pageSize,order:"lastFeedTime"}),r.hasClass("iT")&&r.removeClass("iT").addClass("iC");var o=i(".view-page.show"),u=i("#accountListPage"),a=i("#indexPage");u.hasClass("show")||o.removeClass("show iC").addClass("iL").wAE(function(){o.addClass("hide")}),u.removeClass("hide"),setTimeout(function(){u.removeClass("iR iL").addClass("show iC")},0)},changePage:function(e){var t=this;i("#accountListPage .person-list").html('<div class="loading"><span class="spinner"></span></div>'),window.location.hash="#accountList/"+t.status+"/"+e},goToAccount:function(e){var t=this;e.stopPropagation();var n=i(e.currentTarget);window.AccountList={hash:"#accountList/"+t.status+"/"+t.curPage,flag:!0},changeHash("#account/"+n.attr("snsid")+"/1","account")},follow:function(e){e.stopPropagation();var t=this,n=i(e.currentTarget),r=n.parent().find(".follows span");u.isLogin()?n.hasClass("followed")||(n.html("关注中..."),n.addClass("min"),c.addAccount(n.attr("pid"),function(e){if(e.data.result)for(var t=e.data.result.length,i=0;i<t;i++)if(n.attr("pid")==e.data.result[i].id)if(e.data.result[i].isSuccess=="true"){n.addClass("followed"),n.html("已关注"),n.removeClass("min");var s=r.text();s.indexOf("万")==-1&&s.indexOf("亿")==-1&&r.text(parseInt(s)+1)}else f.message("关注失败！"),n.removeClass("min"),n.html("关注")},function(){f.message("关注失败！"),n.html("关注"),n.removeClass("min")})):u.goLogin({rediUrl:"h5_allSpark",hideType:"close"})},goBack:function(){window.location.hash="index/"},changeTab:function(e){var t=this,n=i(e.currentTarget);i(".tab-bar li.cur").removeClass("cur"),n.addClass("cur"),t.status==1?window.location.hash="accountList/2/1":window.location.hash="accountList/1/1"}});return h});
define("/mw/webapp/transformer/accountList/accountListModel.js",["backbone","zepto","underscore","../common/mtopForAllspark.js","h5_comm","h5_cache","cookie","../common/refine.js"],function(e,t,n){var r=e("backbone"),i=e("zepto"),s=e("underscore"),o=e("../common/mtopForAllspark.js"),u=e("h5_comm"),a=e("h5_cache"),f=e("cookie"),l=e("../common/refine.js");return r.Model.extend({getPageData:function(e){var t=this;e||(e={});var n=e.type||1,r=s.clone(o.pageParam);s.extend(r,e),delete r.type,2==n?o.my(r,function(e){e.a=(new Date).getTime(),l.refineRecommend(e),t.set("myAttention",e),t.set("loaded","1")}):o.recommends(r,function(e){e.a=(new Date).getTime(),l.refineRecommend(e),t.set("recommends",e),t.set("loaded","1")})}})});
define("/mw/webapp/transformer/search/personCollection.js",["backbone","underscore","../common/mtopForAllspark.js","./person","../common/cache.js"],function(e,t,n){var r=e("backbone"),i=e("underscore"),s=e("../common/mtopForAllspark.js"),o=e("./person"),u=e("../common/cache.js");return r.Collection.extend({initialize:function(){console.log("init collection")},model:o})});
define("/mw/webapp/transformer/search/person.js",["backbone","underscore","../common/cache.js"],function(e,t,n){var r=e("backbone"),i=e("underscore"),s=e("../common/cache.js");return r.Model.extend({defaults:{isMyList:!1},validate:function(e,t){},getPersonInfo:function(){return{id:this.get("id")===undefined?0:this.get("id"),logoUrl:this.get("logoUrl")?getImgUrl(this.get("logoUrl"),100,60):undefined,nick:this.get("nick")||"",description:this.get("description")||"",linkUrlIsExt:this.get("linkUrlIsExt")=="true",url:this.get("url")||"",urlTitle:this.get("urlTitle")||"",wangwang:this.get("wangwang")||"",backgroundImg:this.get("backgroundImg")||"",followed:this.get("followed")=="true",followInfo:this.get("followed")=="true"?{cls:"followed",txt:"已关注",log:"cancelattention"}:{cls:"unfollowed",txt:"关注",log:"attention"},fansCount:this.get("fansCount")?formatFans(this.get("fansCount")):0,accountType:this.get("accountType")||0,isMyList:this.get("isMyList")}}})});
define("/mw/webapp/transformer/search/accountManageView.js",["backbone","zepto","underscore","./person","../../../../base/styles/component/pagenav/js/pagenav.js","h5_comm","../ui/loading","../ui/notification.js","../common/mtopForAllspark.js","./personCollection.js","./personItemView.js","../common/favUtils.js"],function(e,t,n){var r=e("backbone"),i=e("zepto"),s=e("underscore"),o=e("./person"),u=e("../../../../base/styles/component/pagenav/js/pagenav.js"),a=e("h5_comm"),f=e("../ui/loading"),l=e("../ui/notification.js"),c=e("../common/mtopForAllspark.js"),h=e("./personCollection.js"),p=e("./personItemView.js"),d=e("../common/favUtils.js"),v=r.View.extend({el:"#content",events:{"click .content":"goToAccount","click #J-searchListPage #J-searchBtn":"searchPerson","click .add-public-account":"goToRecommend"},attrs:{PAGESIZE:15,curPage:1,isMyListPage:!1,backURL:"",afterTimestamp:"",before:!1},template:i("#J-personTpl").html(),initialize:function(){var e=this;this.Collection=new h,this.Model=new o,this.getAttr=function(t){return e.attrs[t]},this.setAttr=function(t,n){e.attrs[t]=n},this.Collection.on("reset",this.render,this);var t=i("#accountManage .close-btn"),n=i("#accountManage #J-keyword");t.hide();var r=function(e){t.show(),!n.val()&&t.hide()};n.on("input",r).focus(function(){i(this).val()&&t.show()}).bind("blur",function(){i(this).val()==""&&i("#J_searchT").show()}),t.on("click",function(e){e.preventDefault(),n.val(""),t.hide()})},searchPerson:function(e){e.preventDefault();var t=i.trim(i("#J-keyword").val()),n=t.replace(/<[^>].*?>/g,"");n&&(window.location.hash="#search/"+encodeURI(t)+"/p"+1)},queryMyList:function(e){var t=this;e<=0&&(window.location.hash="#accountManage/p1");var e=e||1,n={curPage:e,pageSize:this.getAttr("PAGESIZE")};this.setAttr("curPage",e),this.setAttr("isMyListPage",!0),c.my(n,function(n){if(n&&n.totalCount){t.Collection.reset(n.list);var r=Math.ceil(n.totalCount/t.getAttr("PAGESIZE"));e>r&&(window.location.hash="#accountManage/p"+Math.max(r,1)),i("#J-num").text(n.totalCount),t._renderPager(r)}else i("#J-searchListPageNav").html("")})},_renderPager:function(e){var t=this;e>1?(t.pageNav=new u({id:"#J-searchListPageNav",index:t.curPage,pageCount:e,pageSize:this.getAttr("PAGESIZE"),objId:"p"}),t.pageNav.pContainer().on("P:switchPage",function(e,n){t.backURL=i(".navbar .back a").attr("href")})):(t.pageNav=null,i("#J-searchListPageNav").html(""))},addItem:function(e){var t=e.set("isMyList",this.getAttr("isMyListPage")),n=new p({model:t});i("#J-personList").append(n.render())},render:function(){var e=this,t=i("header.navbar"),n=i("#accountManage");i("#accountManage #J-keyword").val(""),i("#accountManage .close-btn").hide(),t.html(s.template(i("#navBack_tpl").html(),{backUrl:"#index",backTitle:"返回"})+'<div class="title">关注管理</div>'),this.Collection.length?(n.find("#J-personList").html(""),this.Collection.each(function(t){e.addItem(t)})):n.find("#J-personList").html('<p class="tips">你还没有关注任何微淘帐号</p>'),t.hasClass("iT")&&t.removeClass("iT").addClass("iC");var r=i(".view-page.show");n.hasClass("show")||r.removeClass("show iC").addClass("iL").wAE(function(){r.addClass("hide")}),n.removeClass("hide"),setTimeout(function(){n.removeClass(" iR iL").addClass("show iC"),n.removeClass("iC")},0),window.scrollTo(0,1),i("#content")[0].style.minHeight="360px"},goToRecommend:function(e){e.preventDefault(),changeHash("#recommendAccount/1/p1","recommend")},goToAccount:function(e){var t=this;e.stopPropagation();var n=i(e.currentTarget);window.AccountList={hash:"#accountList/"+t.status+"/"+t.curPage,flag:!0},changeHash("#account/"+n.attr("snsid")+"/1","account")},goBackHome:function(){typeof window.AccountList!="undefined"?(window.AccountList.flag=!1,window.location.hash=window.AccountList.hash):window.history.back()}});return v});
define("/mw/webapp/transformer/search/personItemView.js",["backbone","zepto","underscore","h5_comm","../ui/notification.js","../common/mtopForAllspark.js"],function(e,t,n){var r=e("backbone"),i=e("zepto"),s=e("underscore"),o=e("h5_comm"),u=e("../ui/notification.js"),a=e("../common/mtopForAllspark.js"),f=r.View.extend({tagName:"li",template:i("#J-personTpl").html(),events:{"click .followbtn":"toggleFollow"},initialize:function(){this.model.on("change:followed",this.render,this)},toggleFollow:function(e){e.stopPropagation();var t=this.model,n=i(e.currentTarget);o.isLogin()?n.hasClass("followed")||(n.html("关注中..."),n.addClass("min"),a.addAccount(t.get("id"),function(e){var r=e.data.result;if(r){if(r[0].isSuccess=="false"&&r[0].retCode.msgCode.indexOf("FAIL_BIZ_SNS_FOLLOW_CANNOT_SELF")!=-1){u.message("自己不能关注自己"),n.removeClass("min"),n.html("关注");return}for(var i=0;i<r.length;i++)t.get("id")==r[i].id&&r[i].isSuccess=="true"?t.set({followed:"true",fansCount:parseInt(t.get("fansCount"))+1}):(u.message("关注失败！"),n.removeClass("min"),n.html("关注"))}},function(){u.message("关注失败！"),n.html("关注"),n.removeClass("min")})):o.goLogin({rediUrl:"h5_allSpark",hideType:"close"})},render:function(){return this.$el.html(s.template(this.template,this.model.getPersonInfo()))}});return f});
define("/mw/webapp/transformer/search/searchResultView.js",["backbone","zepto","underscore","./person","../../../../base/styles/component/pagenav/js/pagenav.js","h5_comm","../ui/loading","../ui/notification.js","../common/mtopForAllspark.js","./personItemView.js","./personCollection.js","../common/favUtils.js"],function(e,t,n){var r=e("backbone"),i=e("zepto"),s=e("underscore"),o=e("./person"),u=e("../../../../base/styles/component/pagenav/js/pagenav.js"),a=e("h5_comm"),f=e("../ui/loading"),l=e("../ui/notification.js"),c=e("../common/mtopForAllspark.js"),h=e("./personItemView.js"),p=e("./personCollection.js"),d=e("../common/favUtils.js"),v=r.View.extend({el:"#content",events:{"click .content":"goToAccount","click #J-searchResult #J-searchBtn":"searchPerson"},attrs:{PAGESIZE:15,curPage:1,isMyListPage:!1,keywords:"",backURL:"",afterTimestamp:"",before:!1},template:i("#J-personTpl").html(),initialize:function(){var e=this;this.Collection=new p,this.Model=new o,this.getAttr=function(t){return e.attrs[t]},this.setAttr=function(t,n){e.attrs[t]=n},this.Collection.on("reset",this.render,this);var t=i("#searchResult .close-btn"),n=i("#searchResult #J-searchkeyword");t.hide();var r=function(e){t.show(),!n.val()&&t.hide()};n.on("input",r).focus(function(){i(this).val()&&t.show()}).bind("blur",function(){i(this).val()==""&&i("#J_searchT").show()}),t.on("click",function(e){e.preventDefault(),n.val(""),t.hide(),i(".search-no-result").hide()})},search:function(e,t){var n=this;t<=0&&(window.location.hash="#search/"+e+"/p1");var r=decodeURI(e),s={keywords:r,curPage:t,pageSize:this.getAttr("PAGESIZE")};this.setAttr("curPage",t),i("#J-searchkeyword").val(r),i("#J-searchkeyword").val()!==""&&i("#J-searchResult .close-btn").show(),this.setAttr("keywords",r),c.searchAccount(s,function(r){n.Collection.reset(r.list);if(r&&r.totalCount){var s=Math.ceil(r.totalCount/n.getAttr("PAGESIZE"));t>s&&(window.location.hash="#search/"+e+"/p"+Math.max(s,1)),n._renderPager(s)}else i("#J-searchResultPageNav").html("")})},searchPerson:function(e){e.preventDefault();var t=i.trim(i("#J-searchkeyword").val()),n=t.replace(/<[^>].*?>/g,"");n&&(window.location.hash="#search/"+encodeURI(n)+"/p"+1)},_renderPager:function(e){var t=this;e>1?(t.pageNav=new u({id:"#J-searchResultPageNav",index:t.curPage,pageCount:e,pageSize:this.getAttr("PAGESIZE"),objId:"p"}),t.pageNav.pContainer().on("P:switchPage",function(e,n){t.backURL=i(".navbar .back a").attr("href")})):(t.pageNav=null,i("#J-searchResultPageNav").html(""))},addItem:function(e){var t=e.set("isMyList",this.getAttr("isMyListPage")),n=new h({model:t});i("#J-searchResultList").append(n.render())},render:function(){var e=this,t=i("header.navbar"),n=i("#searchResult");n.find("#J-searchResultList").html('<div class="loading"><span class="spinner"></span></div>'),t.html(s.template(i("#navBack_tpl").html(),{backUrl:"#index",backTitle:"返回"})+'<div class="title">帐号搜索</div>'),this.Collection.length?(n.find("#J-searchResultList").html(""),this.Collection.each(function(t){e.addItem(t)})):n.find("#J-searchResultList").html('<p class="search-no-result">没有找到 "'+e.getAttr("keywords")+'" 相关的微淘帐号</p>'),t.hasClass("iT")&&t.removeClass("iT").addClass("iC");var r=i(".view-page.show");n.hasClass("show")||r.removeClass("show iC").addClass("iL").wAE(function(){r.addClass("hide")}),n.removeClass("hide"),setTimeout(function(){n.removeClass(" iR iL").addClass("show iC").wAE(function(){n.removeClass("iC")})},0),window.scrollTo(0,1),i("#content")[0].style.minHeight="360px"},goToAccount:function(e){var t=this;e.stopPropagation();var n=i(e.currentTarget);window.AccountList={hash:"#accountList/"+t.status+"/"+t.curPage,flag:!0},changeHash("#account/"+n.attr("snsid")+"/1","account")},goBackHome:function(){typeof window.AccountList!="undefined"?(window.AccountList.flag=!1,window.location.hash=window.AccountList.hash):window.history.back()}});return v});
define("/mw/webapp/transformer/search/recommendView.js",["backbone","zepto","underscore","./person","../../../../base/styles/component/pagenav/js/pagenav.js","h5_comm","../ui/loading","../ui/notification.js","../common/mtopForAllspark.js","./personCollection.js","./personItemView.js","../common/favUtils.js"],function(e,t,n){var r=e("backbone"),i=e("zepto"),s=e("underscore"),o=e("./person"),u=e("../../../../base/styles/component/pagenav/js/pagenav.js"),a=e("h5_comm"),f=e("../ui/loading"),l=e("../ui/notification.js"),c=e("../common/mtopForAllspark.js"),h=e("./personCollection.js"),p=e("./personItemView.js"),d=e("../common/favUtils.js"),v=r.View.extend({el:"#content",events:{"click .content":"goToAccount"},attrs:{PAGESIZE:15,curPage:1,isMyListPage:!0,backURL:"",afterTimestamp:"",before:!1},template:i("#J-personTpl").html(),initialize:function(){var e=this;this.Collection=new h,this.Model=new o,this.getAttr=function(t){return e.attrs[t]},this.setAttr=function(t,n){e.attrs[t]=n},this.Collection.on("reset",this.render,this)},queryRecommendList:function(e,t){var n=this,r={0:"fans",1:"lastFeedTime"},s={order:r[e],curPage:t,pageSize:this.getAttr("PAGESIZE")};this.setAttr("curPage",t);if(t<=0){window.location.hash="#recommendAccount/1/p1";return}c.recommends(s,function(e){n.Collection.reset(e.list);if(e&&e.totalCount){var r=Math.ceil(e.totalCount/n.getAttr("PAGESIZE"));t>r&&(window.location.hash="#recommendAccount/1/p"+Math.max(r,1)),n._renderPager(r)}else i("#J-searchListPageNav").html("")})},addItem:function(e){var t=new p({model:e});i("#recommendResult #J-recommendList").append(t.render())},_renderPager:function(e){var t=this;e>1?(t.pageNav=new u({id:"#J-recommendPageNav",index:t.curPage,pageCount:e,pageSize:this.getAttr("PAGESIZE"),objId:"p"}),t.pageNav.pContainer().on("P:switchPage",function(e,n){t.backURL=i(".navbar .back a").attr("href")})):(t.pageNav=null,i("#J-searchListPageNav").html(""))},render:function(){var e=this,t=i("header.navbar"),n=i("#recommendResult");n.find("#J-recommendList").html('<div class="loading"><span class="spinner"></span></div>'),t.html(s.template(i("#navBack_tpl").html(),{backUrl:"",backTitle:"返回"})+'<div class="title">推荐关注</div>'),this.Collection.length?(n.find("#J-recommendList").html(""),this.Collection.each(function(t){e.addItem(t)})):n.find("#J-recommendList").html('<p class="tips">你已经关注了所有的推荐帐号</p>'),window.scrollTo(0,1),t.hasClass("iT")&&t.removeClass("iT").addClass("iC");var r=i(".view-page.show");n.hasClass("show")||r.removeClass("show iC").addClass("iL").wAE(function(){r.addClass("hide")}),n.removeClass("hide"),setTimeout(function(){n.removeClass(" iR iL").addClass("show iC")},0),i("#content")[0].style.minHeight="360px"},goToAccount:function(e){var t=this;e.stopPropagation();var n=i(e.currentTarget);window.AccountList={hash:"#accountList/"+t.status+"/"+t.curPage,flag:!0},changeHash("#account/"+n.attr("snsid")+"/1","account")},goBackHome:function(){typeof window.AccountList!="undefined"?(window.AccountList.flag=!1,window.location.hash=window.AccountList.hash):window.history.back()}});return v});
define("/mw/webapp/transformer/comment/commentListView.js",["backbone","zepto","underscore","h5_comm","../ui/loading","../common/mtopForAllspark.js","../../../../base/styles/component/pagenav/js/pagenav.js","../ui/notification.js","./commentModel"],function(e,t,n){var r=e("backbone"),i=e("zepto"),s=e("underscore"),o=e("h5_comm"),u=e("../ui/loading"),a=e("../common/mtopForAllspark.js"),f=e("../../../../base/styles/component/pagenav/js/pagenav.js"),l=e("../ui/notification.js"),c=s.template(i("#comment_list_tpl").html()),h=s.template(i("#comment_list_header_tpl").html()),p=e("./commentModel"),d=r.View.extend({el:"#content",model:new p,events:{"click .comment .send-button":"addComment","click .comment .reply-button":"newComment","keyup #add-comment-area":"typing","focusin #add-comment-area":"expandTextArea","focusout #add-comment-area":"restoreTextArea"},initialize:function(){this.pageSize=10,this.$container=i("#commentListPage .main"),this.$commentArea=i("#add-comment-area"),this.$charCount=i(".add-comment .char-count"),this.model.on("change:commentList",this.renderCommentList,this)},goComment:function(e,t,n){this.$container.html('<div class="loading"><span class="spinner"></span></div>'),this.snsId=e,this.feedId=t,this.page=parseInt(n);var r=i("header.navbar"),s=i("#commentListPage");i("header.navbar").html(h({href:"#detail/"+this.snsId+"/"+this.feedId+"/"+this.page})),window.scrollTo(0,1),r.hasClass("iT")&&r.removeClass("iT").addClass("iC");var o=i(".view-page.show"),u=i("#newCommentPage");u.hasClass("show")?(s.removeClass(" iR iL").addClass("iL"),o.removeClass("show iC").addClass("iR").wAE(function(){o.addClass("hide")})):s.hasClass("show")||o.removeClass("show iC").addClass("iL").wAE(function(){o.addClass("hide")}),s.removeClass("hide"),setTimeout(function(){s.removeClass("iR iL").addClass("show iC")},0),this.getPageData()},getPageData:function(){this.model.getPageData({snsId:this.snsId,feedId:this.feedId,curPage:this.page,pageSize:this.pageSize})},renderCommentList:function(){var e=this,t=this.model.get("commentList");if(t&&t.fail){l.message("请稍后重试"),this.$container.html('<p class="no-comment">加载失败，稍后重试！</p>');return}t.totalCount!=null&&i(".navbar .comment-count").html("("+t.totalCount+")");if(t.totalCount==0)this.$container.html('<p class="no-comment">还没有评论，快抢沙发吧。</p>');else{var n=c(t);this.$container.html(n);var r=Math.ceil(t.totalCount/this.pageSize);r>1&&(this.pageNav=new f({id:"#commentListPageNav",index:this.page,pageCount:r,pageSize:this.pageSize,disableHash:"true"}),this.pageNav.pContainer().on("P:switchPage",function(t,n){e.changePage(n.index)}))}},changePage:function(e){this.$container.html('<div class="loading"><span class="spinner"></span></div>'),location.hash="#comment/"+this.snsId+"/"+this.feedId+"/"+e},newComment:function(e){if(o.isLogin()){window.commentData={from:"commentList",authorId:e.target.getAttribute("authorid"),authorNick:e.target.getAttribute("authornick"),parentId:e.target.getAttribute("parentid")};var t="newComment/"+this.snsId+"/"+this.feedId+"/"+this.page;changeHash(t,"comment_list")}else o.goLogin({rediUrl:"h5_allSpark",hideType:"close"})},typing:function(){var e=this.$commentArea.val().length,t=this.$charCount.find(".counter");t.text(e),e?t.addClass("typing"):t.removeClass("typing"),e>140&&this.$commentArea.val(this.$commentArea.val().substr(0,140));var n=this;setTimeout(function(){n.typing()},200)},expandTextArea:function(){this.$commentArea.attr("rows",3),this.$charCount.show()},restoreTextArea:function(){this.$commentArea.attr("rows",1),this.$charCount.hide()},addComment:function(){if(!o.isLogin()){o.goLogin({rediUrl:"h5_allSpark",hideType:"close"});return}var e=this,t=this.$commentArea.val();if(t.length==0){l.message("写点什么吧 ^_^");return}t.length<=140&&(this.model.addComment({snsId:this.snsId,feedId:this.feedId,content:t},function(t,n){if(t){if(n){l.message(n);return}l.message("发布成功！"),e.$commentArea.val(""),setTimeout(function(){e.page=1,e.getPageData()},1e3)}else l.message("发布失败，请重试")}),l.message("发布中，请稍候...",!0))}});return d});
define("/mw/webapp/transformer/comment/commentModel.js",["backbone","zepto","underscore","../common/mtopForAllspark.js","h5_comm"],function(e,t,n){var r=e("backbone"),i=e("zepto"),s=e("underscore"),o=e("../common/mtopForAllspark.js"),u=e("h5_comm");return r.Model.extend({getPageData:function(e){var t=this;o.commentList(e,function(e){t.set("commentList",e)})},addComment:function(e,t){var n=this;u.isLogin()?(n.set("loginStatus",!0),o.addComment(e,function(e){t&&t(!0,e.fail&&e.fail.split("::")[1])},function(){t&&t(!1)})):n.set("loginStatus",!1)},getReplyList:function(e,t){var n=this;o.recommendsReplyList(e,function(e){if(e.fail){e.errMsg="服务器繁忙，请稍后再试！",n.set("replyList",e);return}e.t=(new Date).getTime(),n.set("replyList",e)})}})});
define("/mw/webapp/transformer/comment/newCommentView.js",["backbone","zepto","underscore","h5_comm","../ui/notification.js","./commentModel"],function(e,t,n){var r=e("backbone"),i=e("zepto"),s=e("underscore"),o=e("h5_comm"),u=e("../ui/notification.js"),a=e("./commentModel"),f=s.template(i("#newComment_header_tpl").html()),l=s.template(i("#newComment_input_tpl").html()),c=r.View.extend({el:"#content",model:new a,events:{"keyup #comment-area":"typing","click .publish-comment":"publish"},initialize:function(){this.$container=i("#newCommentPage"),this.$container.html(l({})),this.$commentArea=i("#comment-area"),this.$replyTo=i(".comment-wrap .reply-to"),this.$charCount=this.$container.find(".char-count")},goNewComment:function(e,t,n){this.snsId=e,this.feedId=t,this.curPage=n;var r=this;setTimeout(function(){window.commentData&&(r.$replyTo.text("回复 "+window.commentData.authorNick+":"),r.$commentArea.css("text-indent",r.$replyTo.width()+3+"px"))},100);var s=i("header.navbar");s.html(f({href:""})),window.scrollTo(0,1),s.hasClass("iT")&&s.removeClass("iT").addClass("iC");var o=i(".view-page.show"),u=i("#newCommentPage"),a=i("#commentListPage");o.removeClass("show iC").addClass("iL").wAE(function(){o.addClass("hide")}),u.removeClass("hide"),setTimeout(function(){u.removeClass(" iR iL").addClass("show iC")},0),i(".view-page.show").removeClass("show iC").addClass("iL"),i("#newCommentPage").removeClass("iL").addClass("show iC")},focus:function(){i(".navbar").hide()},blur:function(){i(".navbar").show(),window.scroll(0,1)},typing:function(){var e=this.$commentArea.val().length;this.$charCount.text(e),e?this.$charCount.addClass("typing"):this.$charCount.removeClass("typing"),e>140&&this.$commentArea.val(this.$commentArea.val().substr(0,140));var t=this;setTimeout(function(){t.typing()},200)},publish:function(){if(!o.isLogin()){o.goLogin("h5_allspark");return}var e=this,t=this.$commentArea.val();if(t.length==0){u.message("写点什么吧 ^_^");return}t.length<=140&&(this.model.addComment({snsId:this.snsId,feedId:this.feedId,content:t,authorId:window.commentData.authorId,parentId:window.commentData.parentId,authorNick:window.commentData.authorNick},function(t,n){if(t){if(n){u.message(n);return}u.message("发布成功！"),e.$commentArea.val(""),setTimeout(function(){G_History.back()},1500)}else u.message("发布失败，请重试")}),u.message("发布中，请稍候...",!0))}});return c});
define("/mw/webapp/transformer/comment/recCommentView.js",["backbone","zepto","underscore","h5_comm","../ui/loading","../common/mtopForAllspark.js","../../../../base/styles/component/pagenav/js/pagenav.js","../ui/notification.js","./commentModel"],function(e,t,n){var r=e("backbone"),i=e("zepto"),s=e("underscore"),o=e("h5_comm"),u=e("../ui/loading"),a=e("../common/mtopForAllspark.js"),f=e("../../../../base/styles/component/pagenav/js/pagenav.js"),l=e("../ui/notification.js"),c=s.template(i("#rec_comment_tpl").html()),h=s.template(i("#recComment_header_tpl").html()),p=e("./commentModel"),d=r.View.extend({el:"#content",model:new p,events:{"click #recCommentPage .reply-button":"newComment","click .fn_btns .refresh.rec-comment":"refresh"},initialize:function(){this.pageSize=10,this.$container=i("#recCommentPage"),this.model.on("change:replyList",this.renderComment,this)},refresh:function(){this.$(".fn_btns .refresh.rec-comment .btn div").addClass("spinner"),this.page==1?this.model.getReplyList({curPage:1,pageSize:this.pageSize,direction:1,timestamp:0}):location.hash="recComment/1"},goRecComment:function(e){this.page=e,this.$(".fn_btns .refresh.rec-comment .btn div").removeClass("spinner"),i("header.navbar").html(h({href:"#index"})),this.model.getReplyList({curPage:this.page,pageSize:this.pageSize,direction:1,timestamp:0})},newComment:function(e){var t=e.target;if(o.isLogin()){window.commentData={from:"replyList",authorId:t.getAttribute("authorid"),authorNick:t.getAttribute("authornick"),parentId:t.getAttribute("parentid")};var n="newComment/"+t.getAttribute("snsid")+"/"+t.getAttribute("feedid")+"/"+this.page;changeHash(n,"rec_comment")}else o.goLogin({rediUrl:"h5_allSpark",hideType:"close"})},renderComment:function(){var e=this;setTimeout(function(){e.$(".fn_btns .refresh.rec-comment .btn div").removeClass("spinner")},2e3);var t=i("header.navbar"),n=i("#recCommentPage"),r=i(".view-page.show");i("#detailPage").hasClass("show")?(n.removeClass(" iR iL").addClass("iL"),r.removeClass("show iC").addClass("iR").wAE(function(){r.addClass("hide")})):n.hasClass("show")||r.removeClass("show iC").addClass("iL").wAE(function(){r.addClass("hide")}),n.removeClass("hide"),setTimeout(function(){n.removeClass(" iR iL").addClass("show iC")},0),window.scrollTo(0,1);var s=this.model.get("replyList");if(s&&s.fail){l.message("请稍后重试"),this.$container.html('<p class="no-comment">加载失败，稍后重试！</p>');return}if(parseInt(s.totalCount)==0)n.html('<p class="no-comment">还没有收到任何评论哦</p>');else{s.userNick=o.isLogin()?o.getNickFromCookie():"",this.$container.html(c(s));var u=Math.ceil(s.totalCount/this.pageSize);u>1&&(this.pageNav=new f({id:"#RecCommentPageNav",index:this.page,pageCount:u,pageSize:this.pageSize,disableHash:"true"}),this.pageNav.pContainer().on("P:switchPage",function(t,n){e.changePage(n.index)}))}},changePage:function(e){this.$container.html('<div class="loading"><span class="spinner"></span></div>'),location.hash="recComment/"+e}});return d});
define("/mw/webapp/transformer/favorite/favoriteView.js",["backbone","zepto","underscore","./favoriteModel","cdn","h5_base","h5_comm","h5_base","../ui/notification.js","../common/mtopForAllspark.js","../../../../base/styles/component/pagenav/js/pagenav.js","../common/favUtils.js","uriBroker"],function(e,t,n){var r=e("backbone"),i=e("zepto"),s=e("underscore"),o=e("./favoriteModel"),u=e("cdn"),a=e("h5_base"),f=e("h5_comm"),l=e("h5_base"),c=e("../ui/notification.js"),h=e("../common/mtopForAllspark.js"),p=e("../../../../base/styles/component/pagenav/js/pagenav.js"),d=e("../common/favUtils.js"),v=e("uriBroker"),m=i("#favorite_header_tpl").html(),g=s.template(i("#favorite_feed_tpl").html());return r.View.extend({el:"#content",model:new o,events:{"click #favoritePage .feed-list .favbtn":"favbtn","click #favoritePage .js_feed":"goToDetail","click .navbar .refresh.favorite":"refresh"},initialize:function(){var e=this;e.params={curPage:1,pageSize:10,direction:1,timestamp:0},this.$feedList=i("#favoritePage .feed-list"),this.model.on("change:feedsList",this.renderFeedsList,this),this.model.on("change:favStatus",this.renderFeedFavStatus,this)},favbtn:function(e){var t=this,n=i(e.currentTarget),r=n.parent().find(".js_feed");d.favbtn(n,r.attr("feedid"),r.attr("snsid"))},goToDetail:function(e){var t=i(e.currentTarget),n=this;changeHash("#detail/"+t.attr("snsid")+"/"+t.attr("feedid")+"/"+n.params.curPage,"detail")},render:function(e){var t=this;t.params.curPage=e,this.params.curPage=e,this.$feedList.html('<div class="loading"><span class="spinner"></span></div>'),i(".feed-list").css("margin-top","");var n=i("header.navbar"),r=i("#favoritePage"),s=i(".view-page.show");n.html(m),i("#detailPage").hasClass("show")?(r.removeClass(" iR iL").addClass("iL"),s.removeClass("show iC").addClass("iR").wAE(function(){s.addClass("hide")})):r.hasClass("show")||s.removeClass("show iC").addClass("iL").wAE(function(){s.addClass("hide")}),r.removeClass("hide"),setTimeout(function(){r.removeClass(" iR iL").addClass("show iC")},0);if(f.isLogin()){i(".navbar").html(m),i("footer .nick").html(f.getNickFromCookie());var o=v.getUrl("login_out");i("footer .loginStatus a.logout").attr("href",o),i("footer .loginStatus a.logout").css("display","inline-block"),i("footer .loginStatus a.login").css("display","none"),i("footer .loginStatus a.reg").css("display","none"),t.model.favoriteFeeds(t.params)}else f.goLogin({rediUrl:"h5_allSpark"});window.scrollTo(0,1)},renderFeedsList:function(){var e=this,t=e.model.get("feedsList");setTimeout(function(){i(".navbar .refresh div").removeClass("spinner")},2e3);if(t.fail){c.message(t.errMsg);return}if(t.list.length>0){var n=g(t);e.$feedList.html(n),e.$feedList.attr("len",t.list.length)}else parseInt(t.totalCount)>0?e.changePage(e.params.curPage-1):e.$feedList.html('<li class="nofavs">还没有收藏任何广播！</li>');var r=Math.ceil(parseInt(t.totalCount)/e.params.pageSize);r>1&&(e.recommentPage=new p({id:"#favoritePageNav",index:e.params.curPage,pageCount:r,pageSize:e.params.pageSize,disableHash:"true"}),e.recommentPage.pContainer().on("P:switchPage",function(t,n){e.changePage(n.index)})),window.lazyload.reload()},changePage:function(e){var t=this;i("#favoritePageNav").html(""),t.$feedList.html('<div class="loading"><span class="spinner"></span></div>'),t.params.curPage>e?t.params.direction=0:t.params.direction=1,t.isChangePage=!0,window.scrollTo(0,1),window.location.hash="#fav/"+e},refresh:function(){var e=this;e.allFeedCount=parseInt(e.model.get("feedsList").totalCount),i("#favoritePageNav").html(""),e.isRefresh=!0;var t=i(".navbar .refresh .btn div");t.hasClass("spinner")||t.addClass("spinner"),e.params.curPage=="1"?e.model.favoriteFeeds(e.params):window.location.hash="#fav/1"},renderFeedFavStatus:function(){var e=this;console.log(e.model.get("favStatus"));var t={curPage:1,pageSize:24,direction:1,timestamp:0};e.model.favoriteFeeds(t)}})});
define("/mw/webapp/transformer/favorite/favoriteModel.js",["backbone","zepto","underscore","../common/mtopForAllspark.js"],function(e,t,n){var r=e("backbone"),i=e("zepto"),s=e("underscore"),o=e("../common/mtopForAllspark.js"),u=r.Model.extend({favoriteFeeds:function(e){var t=this;o.favoriteFeeds(e,function(e){e.t=(new Date).getTime();if(e.fail){e.errMsg="服务器繁忙，请稍后再试！",e.t=(new Date).getTime(),t.set("feedsList",e);return}t.set("feedsList",e)})},addFeed:function(e){var t=this;o.favoriteAddFeed(e,function(e){e.t=(new Date).getTime();if(e.fail){e.fail.indexOf("FAIL_BIZ_SNS_FAVORITE_ALREADY_FAVORITE")>-1?e.errMsg="对不起，该广播您已经收藏过！":e.fail.indexOf("FAIL_BIZ_SNS_FAVORITE_NOT_EXSIT")>-1?e.errMsg="对不起，该广播不存在！":e.errMsg="服务器繁忙，请稍后再试！",t.set("favStatus",e);return}t.set("favStatus",e)})},removeFeed:function(e){var t=this;o.favoriteRemoveFeed(e,function(e){e.t=(new Date).getTime();if(e.fail){e.errMsg="服务器繁忙，请稍后再试！",t.set("favStatus",e);return}t.set("favStatus",e)})}});return u});
define("/mw/webapp/transformer/common/background.js",["./log.js","backbone","h5_comm","h5_base","../../../../base/modules/history/history.js"],function(e,t,n){var r=e("./log.js"),i=e("backbone"),s=e("h5_comm"),o=e("h5_base"),u=e("../../../../base/modules/history/history.js"),a=new u({defaultPage:"http://m.taobao.com",defaultHash:"#index",defaultSeparator:"/",fromBack:function(){return s.isLogin()&&0==document.getRefer().indexOf("http://login")},setItem:function(e,t){o.set(e,t)},getItem:function(e){return o.get(e)},validate:function(){return location.hash.indexOf("&")==-1},changeHash:function(e){console.log("12222"),window.changeHash(e,location.hash.split("/")[0].replace("#",""))}}),f=i.View.extend({el:"#content",events:{"click .log[data-log]":function(e){var t=location.hash?location.hash.split("/")[0].replace("#",""):"",n=$(e.currentTarget),i=n.data("log");i&&r.logClick(i,t)},"click header .back":function(){return a.back(),!1}}});new f,window.G_History=a});
define("/base/modules/history/history.js",["zepto"],function(e,t,n){function s(e){return e&&0!=e.indexOf(location.protocol+"//"+location.hostname+location.pathname)}function a(e,t){var n=location.hash.split(t)[0]||e,r=[],i=0,s=u.stack;while(i<s.length){if(s[i].hash==n)break;r.push(s[i]),i++}u.stack=r;var s=u.stack;s.push({hash:n,hisLen:++u.index,originHash:location.hash})}function f(e){r.extend(e,{getLastStack:function(){if(this.stack.length)return e.stack[e.stack.length-1]},outerBack:function(){if(this.exit&&document.getRefer().indexOf(this.exit.split("#")[0])>=0)return!0;var e=this.getLastStack();return e&&e.originHash===location.hash},innerBack:function(e){return this.index-e.hisLen===1}})}function l(e){e&&r.extend(this.constructor.prototype,e);var t=this;r(window).on("unload",function(){t.store&&t.store()}),r(window).on("hashchange",function(){(!t.validate||!!t.validate())&&a(t.defaultHash,t.defaultSeparator)});var n=this.restore&&this.restore(),i=n&&n.entrance;u=n||o,f(u);if(u.outerBack()||this.fromBack&&this.fromBack()){var s=u.getLastStack();s&&s.originHash&&t.changeHash(s.originHash)}else u=o,f(u),(!t.validate||!!t.validate())&&a(t.defaultHash,t.defaultSeparator);this.filterEntrance&&(u.entrance=this.filterEntrance(i))}var r=e("zepto"),i="hisTrace"+function(e){return e&&e.lastIndexOf("/")>0?e.substr(0,e.lastIndexOf("/")):""}(location.pathname);s(document.referrer)||(document.lastRefer=function(){var e=localStorage?localStorage.getItem("f_l"):"";return e&&localStorage.removeItem("f_l"),s(e)?e:undefined}()),document.getRefer=function(){return document.lastRefer||document.referrer||""};var o={entrance:document.getRefer(),stack:[],index:-1},u;return r.extend(l.prototype,{_originalHistory:window.history,defaultHash:"#index",defaultSeparator:"-",backAppIndexFirst:!0,back:function(){var e=u.stack,t=null;e.length>1&&(t=e[e.length-2]),t?this.changeHash(t&&t.originHash?t.originHash:this.defaultHash):this.backAppIndexFirst&&window.location.hash&&-1===window.location.hash.indexOf(this.defaultHash)?(u.stack=[],this.changeHash(this.defaultHash)):window.location.href=u.entrance||this.defaultPage},addExit:function(e){u.exit=e},store:function(){(this.setItem?this:localStorage).setItem(i,JSON.stringify(u))},restore:function(){try{return JSON.parse((this.getItem?this:localStorage).getItem(i))}catch(e){return null}},changeHash:function(e){window.location.href=e},getHisStack:function(){return u.stack}}),l});
(function(e){if(window["define"]==undefined){var t={},n=t.exports={};e(null,n,t),window.lazyload=t.exports}else define("/base/modules/lazyload/js/lazyload.js",["zepto"],e)})(function(e,t,n){function i(e,t){var n=t.right>e.left&&t.left<e.right,r=t.bottom>e.top&&t.top<e.bottom;return n&&r}function s(e,t){if(!e)return;var n,i,s,u,a;if(e!=r)a=e.offset?e:o(e),a=a.offset(),n=a.width,i=a.height,s=a.left,u=a.top;else{var f=t&&t.x||0,l=t&&t.y||0;n=e.innerWidth+l,i=e.innerHeight+f,s=e.pageXOffset,u=e.pageYOffset}return{left:s,top:u,right:s+n,bottom:u+i}}var r=window,o=e?e("zepto"):window.$,u={init:function(e){this.img.init(e)},img:{init:function(e){var t=this;if(t.isload){t.trigger();return}var n={lazyHeight:400,lazyWidth:0,definition:!1,size:null},e=e||{};o.extend(t,n,e);var i=t.definition,s=r.devicePixelRatio;t.definition=i&&s&&s>1||!1,t.DPR=s;var u=5,a=200,f=t.isPhone=t.fetchVersion();if(f){var l,c;o(r).on("touchstart",function(e){l={sy:r.pageYOffset,time:Date.now()},c&&clearTimeout(c)}).on("touchend",function(e){if(e&&e.changedTouches){var n=Math.abs(r.pageYOffset-l.sy);if(n>u){var i=Date.now()-l.time;c=setTimeout(function(){t.changeimg(),l={},clearTimeout(c),c=null},i>a?0:200)}}else t.changeimg()}).on("touchcancel",function(){c&&clearTimeout(c),l=null})}else o(r).on("scroll",function(){t.changeimg()});t.trigger(),t.isload=!0},trigger:function(e){var t=this,n=t.isPhone,r=n&&"touchend"||"scroll";t.imglist&&t.imglist.each(function(e,t){t&&(t.onerror=t.onload=null)}),e&&(t.size=e),t.imglist=o("img.lazy"),o(window).trigger(r)},fetchVersion:function(){var e=navigator.appVersion.match(/(iPhone\sOS)\s([\d_]+)/),t=e&&!0||!1,n=t&&e[2].split("_");return n=n&&parseFloat(n.length>1?n.splice(0,2).join("."):n[0],10),t&&n<6},setImgSrc:function(e,t){if(!e)return;t=t||this.size,t=t&&(typeof t=="string"?t:t[this.DPR])||null,t&&(t=["_",t,".jpg"].join(""));var n=e.lastIndexOf("_."),r=n!=-1?e.slice(n+2):null,i=r&&r.toLowerCase()=="webp"?!0:!1,s=i?e.slice(0,n):e,o=s.replace(/_\d+x\d+\.jpg?/g,"");return o+=t,i&&o+"_.webp"||o},getCoord:s,changeimg:function(){function u(t,n){var i=t.attr("dataimg"),s=t.attr("datasize");if(!i)return;r&&(i=e.setImgSrc(i,s)),t.attr("src",i),t[0].onload||(t[0].onload=t[0].onerror=function(){o(this).removeClass("lazy").removeAttr("dataimg"),e.imglist[n]=null,this.onerror=this.onload=null})}var e=this,t=window,n={x:e.lazyWidth,y:e.lazyHeight},r=e.definition;e.imglist.each(function(e,r){if(!r)return;var a=o(r);if(!i(s(t,n),s(a)))return;u(a,e)})}}};n.exports=u});